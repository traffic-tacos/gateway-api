# Traffic Tacos: 30k RPS í‹°ì¼“íŒ… ì‹œìŠ¤í…œ
## íŠ¸ë˜í”½ Â· ë³´ì•ˆ Â· FinOps Â· ê´€ì¸¡ì„± Â· ë¶€í•˜í…ŒìŠ¤íŠ¸

---

## ğŸ“‹ **ë°œí‘œ êµ¬ì¡°**

```
Part 1: íŠ¸ë˜í”½ ì²˜ë¦¬ (15ë¶„) - ì•„í‚¤í…ì²˜ ì„¤ê³„ë¶€í„° 30k RPS ë‹¬ì„±ê¹Œì§€
  â””â”€ 1.1~1.14: ë¬¸ì œ ì •ì˜ â†’ ì„¤ê³„ â†’ ë³‘ëª© ë°œê²¬ â†’ ìµœì í™” â†’ ê²€ì¦

Part 2: ë³´ì•ˆ (10ë¶„) - 4ê³„ì¸µ ì‹¬ì¸µ ë°©ì–´ (Defense in Depth)
  â””â”€ 2.1~2.5: WAF+CAPTCHA â†’ Istio Ambient â†’ Teleport â†’ Falco

Part 3: FinOps (5ë¶„) - ì„¤ê³„ë¶€í„° ê³ ë ¤í•œ ë¹„ìš© ìµœì í™”
  â””â”€ 3.1~3.2: Graviton, Spot, ì…ì¥ ì œì–´ â†’ $1,700/month ì ˆê°

Part 4: ê´€ì¸¡ì„± (5ë¶„) - CloudWatch + pprofë¡œ ë³‘ëª© ì°¾ê¸°
  â””â”€ 4.1~4.2: ë©”íŠ¸ë¦­ ë¶„ì„ â†’ í”„ë¡œíŒŒì¼ë§ â†’ ë¶„ì‚° ì¶”ì 

Part 5: ë¶€í•˜í…ŒìŠ¤íŠ¸ (5ë¶„) - ì ì§„ì  ê²€ì¦ ë° Karpenter í™•ì¥
  â””â”€ 5.1~5.2: 1k â†’ 30k RPS í…ŒìŠ¤íŠ¸ â†’ Karpenter í™•ì¥ ì„±ëŠ¥

Part 6: Lesson Learned (5ë¶„) - ì„¤ê³„ êµí›ˆ ë° ì‹¤ì „ íŒ
  â””â”€ 6.1~6.3: ì„¤ê³„ êµí›ˆ â†’ ê¸°ìˆ  êµí›ˆ â†’ ë‹¤ìŒ ëª©í‘œ

ì´ 45ë¶„ (Q&A í¬í•¨ 60ë¶„)
```

---

# ğŸŒŠ Part 1: íŠ¸ë˜í”½ ì²˜ë¦¬ (15ë¶„)

## ğŸ“œ 1.1 ë¬¸ì œ ì •ì˜

### ìŠ¬ë¼ì´ë“œ
```
"ì¸ê¸° ì½˜ì„œíŠ¸ í‹°ì¼“íŒ…, ì˜ˆë§¤ ì˜¤í”ˆ ìˆœê°„"

30ë§Œ ëª…ì´ ë™ì‹œì— ì ‘ì†
    â†“
ì´ˆë‹¹ ìˆ˜ë§Œ ê±´ì˜ ìš”ì²­ í­ì£¼
    â†“
ì¢Œì„ì€ 1ë§Œ ì„ë¿
    â†“

ë¬¸ì œ:
â”œâ”€ 30ë§Œ ëª…ì„ ì–´ë–»ê²Œ ì²˜ë¦¬í•  ê²ƒì¸ê°€?
â”œâ”€ 1ë§Œ ì„ì„ ì–´ë–»ê²Œ ê³µì •í•˜ê²Œ ë¶„ë°°í•  ê²ƒì¸ê°€?
â”œâ”€ ì‹œìŠ¤í…œì€ ì–´ë–»ê²Œ ë²„í‹¸ ê²ƒì¸ê°€?
â””â”€ ë¹„ìš©ì€ ì–¼ë§ˆë‚˜ ë“¤ ê²ƒì¸ê°€?
```

### ë©˜íŠ¸

ì¸ê¸° ì½˜ì„œíŠ¸ í‹°ì¼“íŒ…ì„ ìƒê°í•´ ë³´ì„¸ìš”.

ì˜ˆë§¤ ì˜¤í”ˆ ì§ì „, **30ë§Œ ëª…ì´ ë™ì‹œì— ëŒ€ê¸°**í•©ë‹ˆë‹¤.
ì˜¤í”ˆê³¼ ë™ì‹œì— **ì´ˆë‹¹ ìˆ˜ë§Œ ê±´ì˜ ìš”ì²­**ì´ ëª°ë ¤ì˜µë‹ˆë‹¤.
í•˜ì§€ë§Œ ì¢Œì„ì€ **1ë§Œ ì„**ë¿ì…ë‹ˆë‹¤.

ì´ë•Œ ìš°ë¦¬ê°€ í’€ì–´ì•¼ í•  ë¬¸ì œëŠ” ë¬´ì—‡ì¼ê¹Œìš”?

**ì²«ì§¸, íŠ¸ë˜í”½ ì²˜ë¦¬**
- 30ë§Œ ëª…ì˜ ë™ì‹œ ì ‘ì†ì„ ì–´ë–»ê²Œ ë°›ì„ ê²ƒì¸ê°€?
- ì„œë²„ê°€ í„°ì§€ì§€ ì•Šìœ¼ë ¤ë©´?

**ë‘˜ì§¸, ê³µì •ì„±**
- ëˆ„ê°€ ë¨¼ì € ë“¤ì–´ì™”ëŠ”ì§€ ì–´ë–»ê²Œ íŒë‹¨í•  ê²ƒì¸ê°€?
- ë´‡ì´ ì•„ë‹Œ ì‹¤ì œ ì‚¬ìš©ìë¥¼ ì–´ë–»ê²Œ ë³´í˜¸í•  ê²ƒì¸ê°€?

**ì…‹ì§¸, ì¬ê³  ê´€ë¦¬**
- 1ë§Œ ì„ì„ ì–´ë–»ê²Œ ì˜¤ë²„ì…€ ì—†ì´ íŒë§¤í•  ê²ƒì¸ê°€?
- ë™ì‹œì— ê°™ì€ ì¢Œì„ì„ ì„ íƒí•˜ë©´?

**ë„·ì§¸, ë¹„ìš©**
- ì§§ì€ í”¼í¬ ë•Œë¬¸ì— ì¸í”„ë¼ë¥¼ ì–¼ë§ˆë‚˜ ì¦ì„¤í•´ì•¼ í•˜ë‚˜?
- í‰ìƒì‹œì—ëŠ” ìì›ì´ ë†€ì§€ ì•Šì„ê¹Œ?

ì´ ëª¨ë“  ë¬¸ì œë¥¼ ì–´ë–»ê²Œ í’€ ê²ƒì¸ê°€?
ê·¸ê²ƒì´ ì˜¤ëŠ˜ì˜ ì£¼ì œì…ë‹ˆë‹¤.

---

## ğŸ“œ 1.2 ì•„í‚¤í…ì²˜ ì„ íƒì§€

### ìŠ¬ë¼ì´ë“œ
```
"3ê°€ì§€ ì•„í‚¤í…ì²˜ íŒ¨í„´"

íŒ¨í„´ 1: Direct Access (ì§ì ‘ ì ‘ê·¼)
Browser â†’ Reservation API â†’ Inventory API â†’ DB
âœ… ë‹¨ìˆœí•¨
âŒ DBê°€ í„°ì§, ì˜¤ë²„ì…€ ìœ„í—˜, ë´‡ ë°©ì–´ ì•ˆë¨

íŒ¨í„´ 2: Queue Service (ì™¸ë¶€ í)
Browser â†’ SQS/SNS â†’ Lambda â†’ Reservation API
âœ… ë¹„ë™ê¸° ì²˜ë¦¬
âŒ ì‘ë‹µ ì§€ì—°, ì‚¬ìš©ì ê²½í—˜ ë‚˜ì¨, ë¹„ìš© ë†’ìŒ

íŒ¨í„´ 3: Gateway + Admission Control (ì…ì¥ ì œì–´)
Browser â†’ Gateway (ëŒ€ê¸°ì—´) â†’ Reservation API
âœ… ì‹¤ì‹œê°„ ì‘ë‹µ, ì œì–´ ê°€ëŠ¥, ê³µì •ì„± ë³´ì¥
âŒ Gateway ë¶€í•˜ ì§‘ì¤‘ (Trade-off)
```

### ë©˜íŠ¸

30ë§Œ ëª…ì˜ íŠ¸ë˜í”½ì„ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•ì—ëŠ” í¬ê²Œ 3ê°€ì§€ê°€ ìˆìŠµë‹ˆë‹¤.

**íŒ¨í„´ 1: Direct Access - ì§ì ‘ ì ‘ê·¼**
```
Browser â†’ Reservation API â†’ Inventory API â†’ DB
```

ê°€ì¥ ë‹¨ìˆœí•œ ë°©ë²•ì…ë‹ˆë‹¤.
í•˜ì§€ë§Œ ë¬¸ì œê°€ ë§ìŠµë‹ˆë‹¤.
- 30ë§Œ ëª…ì´ ë™ì‹œì— DBë¥¼ ì¹˜ë©´? â†’ **DBê°€ í„°ì§‘ë‹ˆë‹¤**
- ë™ì‹œì— ê°™ì€ ì¢Œì„ì„ ì„ íƒí•˜ë©´? â†’ **ì˜¤ë²„ì…€ ë°œìƒ**
- ë´‡ íŠ¸ë˜í”½ì€? â†’ **ë°©ì–´ ë¶ˆê°€ëŠ¥**

**íŒ¨í„´ 2: Queue Service - ì™¸ë¶€ í ì„œë¹„ìŠ¤**
```
Browser â†’ SQS/SNS â†’ Lambda â†’ Reservation API
```

ë¹„ë™ê¸° ì²˜ë¦¬ë¡œ ë¶€í•˜ë¥¼ ë¶„ì‚°í•©ë‹ˆë‹¤.
í•˜ì§€ë§Œ ì´ê²ƒë„ ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.
- ì‚¬ìš©ìëŠ” ì–¸ì œ ì²˜ë¦¬ë˜ëŠ”ì§€ ëª¨ë¦…ë‹ˆë‹¤ â†’ **ì‘ë‹µ ì§€ì—°**
- ì‹¤ì‹œê°„ í”¼ë“œë°±ì´ ì—†ìŠµë‹ˆë‹¤ â†’ **ì‚¬ìš©ì ê²½í—˜ ë‚˜ì¨**
- Lambda í˜¸ì¶œ ë¹„ìš©ì´ í­ë°œí•©ë‹ˆë‹¤ â†’ **ë¹„ìš© ë†’ìŒ**

**íŒ¨í„´ 3: Gateway + Admission Control - ì…ì¥ ì œì–´**
```
Browser â†’ Gateway (ëŒ€ê¸°ì—´ ê´€ë¦¬) â†’ Reservation API
```

Gatewayì—ì„œ ëŒ€ê¸°ì—´ì„ ê´€ë¦¬í•˜ê³ , ì…ì¥ì„ ì œì–´í•©ë‹ˆë‹¤.
- ì‚¬ìš©ìëŠ” ìì‹ ì˜ ìˆœë²ˆì„ **ì‹¤ì‹œê°„ìœ¼ë¡œ í™•ì¸**
- Gatewayê°€ ì…ì¥ì„ ì œì–´í•´ì„œ **ë’·ë‹¨ ë³´í˜¸**
- ê³µì •ì„±ì„ **ë³´ì¥**

í•˜ì§€ë§Œ Trade-offê°€ ìˆìŠµë‹ˆë‹¤.
- **Gatewayì— ë¶€í•˜ê°€ ì§‘ì¤‘**ë©ë‹ˆë‹¤
- Gatewayê°€ **SPOF(Single Point of Failure)**ê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤

ìš°ë¦¬ëŠ” **íŒ¨í„´ 3**ì„ ì„ íƒí–ˆìŠµë‹ˆë‹¤.
ì™œ ê·¸ë¬ì„ê¹Œìš”?

---

## ğŸ“œ 1.3 ì™œ Gateway + ì…ì¥ ì œì–´ì¸ê°€?

### ìŠ¬ë¼ì´ë“œ
```
"ìš°ë¦¬ì˜ ì„¤ê³„ ì² í•™"

í•µì‹¬ ì›ì¹™ 3ê°€ì§€:

1ï¸âƒ£ ì‹¤ì‹œê°„ í”¼ë“œë°±
   "ì§€ê¸ˆ ëª‡ ë²ˆì§¸ì¸ì§€ ì•Œë ¤ì¤˜ì•¼ í•œë‹¤"
   â†’ Gatewayì—ì„œ ì‹¤ì‹œê°„ ìˆœë²ˆ ì œê³µ

2ï¸âƒ£ ë’·ë‹¨ ë³´í˜¸
   "DBì™€ APIëŠ” í„°ì§€ë©´ ì•ˆ ëœë‹¤"
   â†’ Gatewayì—ì„œ ì…ì¥ ì œì–´ (Rate Limiting)

3ï¸âƒ£ ê³µì •ì„± ë³´ì¥
   "ë¨¼ì € ì˜¨ ì‚¬ëŒì´ ë¨¼ì € ë“¤ì–´ê°€ì•¼ í•œë‹¤"
   â†’ ëŒ€ê¸°ì—´ ìˆœì„œ ê´€ë¦¬


Trade-off ìˆ˜ìš©:
âœ… Gateway ë¶€í•˜ ì§‘ì¤‘ â†’ ì´ê±´ ë°›ì•„ë“¤ì´ì
âœ… Gateway ìµœì í™” â†’ ì—¬ê¸°ì— ì§‘ì¤‘ íˆ¬ìí•˜ì
```

### ë©˜íŠ¸

ìš°ë¦¬ê°€ Gateway + ì…ì¥ ì œì–´ë¥¼ ì„ íƒí•œ ì´ìœ ëŠ” ëª…í™•í•©ë‹ˆë‹¤.

**ì²«ì§¸, ì‹¤ì‹œê°„ í”¼ë“œë°±ì´ í•„ìˆ˜ì˜€ìŠµë‹ˆë‹¤.**
í‹°ì¼“íŒ… ì‚¬ìš©ìëŠ” "ì§€ê¸ˆ ëª‡ ë²ˆì§¸ì¸ì§€" ì•Œê³  ì‹¶ì–´ í•©ë‹ˆë‹¤.
ë¹„ë™ê¸° í ë°©ì‹ìœ¼ë¡œëŠ” ì´ê²Œ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.
Gatewayì—ì„œ ëŒ€ê¸°ì—´ì„ ê´€ë¦¬í•˜ë©´, ì‹¤ì‹œê°„ìœ¼ë¡œ ìˆœë²ˆì„ ì•Œë ¤ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ë‘˜ì§¸, ë’·ë‹¨ ë³´í˜¸ê°€ í•„ìˆ˜ì˜€ìŠµë‹ˆë‹¤.**
30ë§Œ ëª…ì´ ë™ì‹œì— DBë¥¼ ì¹˜ë©´, DBê°€ í„°ì§‘ë‹ˆë‹¤.
Reservation APIê°€ ë™ì‹œì— 1ë§Œ ê±´ì„ ì²˜ë¦¬í•˜ë©´, APIê°€ í„°ì§‘ë‹ˆë‹¤.
Gatewayì—ì„œ ì…ì¥ì„ ì œì–´í•˜ë©´, ë’·ë‹¨ì„ ë³´í˜¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì˜ˆ: ì´ˆë‹¹ 1,000ëª…ë§Œ ì…ì¥ í—ˆìš©
- Reservation APIëŠ” 1,000 RPSë§Œ ë°›ìŒ
- ì•ˆì „í•©ë‹ˆë‹¤

**ì…‹ì§¸, ê³µì •ì„±ì´ í•„ìˆ˜ì˜€ìŠµë‹ˆë‹¤.**
ë¨¼ì € ì˜¨ ì‚¬ëŒì´ ë¨¼ì € ë“¤ì–´ê°€ì•¼ í•©ë‹ˆë‹¤.
Gatewayì—ì„œ ëŒ€ê¸°ì—´ ìˆœì„œë¥¼ ê´€ë¦¬í•˜ë©´, ê³µì •ì„±ì„ ë³´ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**í•˜ì§€ë§Œ Trade-offê°€ ìˆìŠµë‹ˆë‹¤.**
Gatewayì— ë¶€í•˜ê°€ ì§‘ì¤‘ë©ë‹ˆë‹¤.
Gatewayê°€ í„°ì§€ë©´, ì „ì²´ ì‹œìŠ¤í…œì´ ë§ˆë¹„ë©ë‹ˆë‹¤.

ìš°ë¦¬ëŠ” ì´ Trade-offë¥¼ **ìˆ˜ìš©**í•˜ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.
ëŒ€ì‹ , **Gateway ìµœì í™”ì— ì§‘ì¤‘ íˆ¬ì**í•˜ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.

---

## ğŸ“œ 1.4 Gateway + Redis ì„¤ê³„

### ìŠ¬ë¼ì´ë“œ
```
"ì™œ Redisì¸ê°€?"

ëŒ€ê¸°ì—´ ê´€ë¦¬ì— í•„ìš”í•œ ê²ƒ:
â”œâ”€ ë¹ ë¥¸ ì¡°íšŒ (ms ë‹¨ìœ„)
â”œâ”€ ìˆœì„œ ë³´ì¥ (FIFO)
â”œâ”€ ì›ìì  ì—°ì‚° (ë™ì‹œì„± ì œì–´)
â”œâ”€ TTL ìë™ ê´€ë¦¬ (ë§Œë£Œ ì²˜ë¦¬)
â””â”€ ë¶„ì‚° í™˜ê²½ ì§€ì›


Redisì˜ ê°•ì :
âœ… O(log N) ì¡°íšŒ (ZSET)
âœ… Lua Script (ì›ìì„±)
âœ… TTL ìë™ ë§Œë£Œ
âœ… Cluster Mode (í™•ì¥ì„±)
âœ… Read Replica (ì½ê¸° ë¶„ì‚°)


ë‹¤ë¥¸ ì„ íƒì§€ëŠ”?
âŒ DynamoDB: ì½ê¸°/ì“°ê¸° ë¹„ìš© ë†’ìŒ, ì¡°íšŒ ëŠë¦¼
âŒ PostgreSQL: ë™ì‹œì„± ì œì–´ ì–´ë ¤ì›€, í™•ì¥ì„± ë¶€ì¡±
âŒ In-Memory: ë¶„ì‚° í™˜ê²½ ì§€ì› ì•ˆë¨, ë°ì´í„° ìœ ì‹¤
```

### ë©˜íŠ¸

ê·¸ë ‡ë‹¤ë©´, ì™œ Redisë¥¼ ì„ íƒí–ˆì„ê¹Œìš”?

ëŒ€ê¸°ì—´ ê´€ë¦¬ì— í•„ìš”í•œ ê²ƒë“¤ì„ ë‚˜ì—´í•´ ë´¤ìŠµë‹ˆë‹¤.
- **ë¹ ë¥¸ ì¡°íšŒ**: ì‚¬ìš©ìëŠ” 5ì´ˆë§ˆë‹¤ ìˆœë²ˆì„ ì¡°íšŒí•©ë‹ˆë‹¤. ms ë‹¨ìœ„ ì‘ë‹µ í•„ìš”.
- **ìˆœì„œ ë³´ì¥**: ë¨¼ì € ì˜¨ ì‚¬ëŒì´ ë¨¼ì € ë“¤ì–´ê°€ì•¼ í•©ë‹ˆë‹¤.
- **ì›ìì  ì—°ì‚°**: ë™ì‹œì— ì—¬ëŸ¬ ëª…ì´ ë“¤ì–´ì™€ë„, ìˆœì„œê°€ ê¼¬ì´ë©´ ì•ˆ ë©ë‹ˆë‹¤.
- **TTL ìë™ ê´€ë¦¬**: ë¹„í™œì„± ì‚¬ìš©ìëŠ” ìë™ìœ¼ë¡œ ì œê±°ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
- **ë¶„ì‚° í™˜ê²½**: Gateway ì¸ìŠ¤í„´ìŠ¤ê°€ ì—¬ëŸ¬ ê°œì—¬ë„ ì‘ë™í•´ì•¼ í•©ë‹ˆë‹¤.

RedisëŠ” ì´ ëª¨ë“  ìš”êµ¬ì‚¬í•­ì„ ë§Œì¡±í•©ë‹ˆë‹¤.
- **ZSET**: O(log N) ì¡°íšŒ, ìˆœì„œ ë³´ì¥
- **Lua Script**: ì›ìì  ì—°ì‚° (ACID ë³´ì¥)
- **TTL**: ìë™ ë§Œë£Œ ì²˜ë¦¬
- **Cluster Mode**: ìƒ¤ë“œ ë¶„ì‚°ìœ¼ë¡œ í™•ì¥ì„±
- **Read Replica**: ì½ê¸° ë¶€í•˜ ë¶„ì‚°

**ë‹¤ë¥¸ ì„ íƒì§€ëŠ” ì—†ì—ˆë‚˜ìš”?**

**DynamoDB?**
- ì“°ê¸° ë¹„ìš©ì´ ë„ˆë¬´ ë†’ìŠµë‹ˆë‹¤ (30ë§Œ ê±´ ì“°ê¸° = $$$$)
- ì½ê¸°ë„ ëŠë¦½ë‹ˆë‹¤ (ìˆ˜ì‹­ ms)
- ìˆœì„œ ë³´ì¥ì´ ì–´ë µìŠµë‹ˆë‹¤

**PostgreSQL?**
- ë™ì‹œì„± ì œì–´ê°€ ì–´ë µìŠµë‹ˆë‹¤ (Lock ê²½í•©)
- í™•ì¥ì„±ì´ ë¶€ì¡±í•©ë‹ˆë‹¤ (ìˆ˜ì§ í™•ì¥ë§Œ ê°€ëŠ¥)

**In-Memory (map)?**
- ë¶„ì‚° í™˜ê²½ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤
- ì¸ìŠ¤í„´ìŠ¤ê°€ ì£½ìœ¼ë©´ ë°ì´í„° ìœ ì‹¤

**ê²°ë¡ : Redisê°€ ìµœì ì´ì—ˆìŠµë‹ˆë‹¤.**

---

## ğŸ“œ 1.5 ì„¤ê³„ êµ¬ì¡° ë° ìš©ëŸ‰ ì‚°ì •

### ìŠ¬ë¼ì´ë“œ
```
"Gateway + Redis ì•„í‚¤í…ì²˜"

Browser (30ë§Œ ëª…)
    â†“
    â†“ Queue API (ëŒ€ê¸°ì—´)
    â†“ - Join: ëŒ€ê¸°ì—´ ì°¸ì—¬
    â†“ - Status: ìˆœë²ˆ ì¡°íšŒ (5ì´ˆë§ˆë‹¤)
    â†“ - Enter: ì…ì¥ ì‹œë„
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Gateway API (Go + Fiber)       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Redis (ElastiCache)     â”‚   â”‚
â”‚  â”‚  - ZSET: ìˆœì„œ ê´€ë¦¬       â”‚   â”‚
â”‚  â”‚  - Lua: ì›ìì  ì—°ì‚°      â”‚   â”‚
â”‚  â”‚  - TTL: ìë™ ë§Œë£Œ        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                  â”‚
â”‚  ì…ì¥ ì œì–´ (1,000 RPS)          â”‚ â† ì™œ 1,000 RPS?
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
    â†“ ì…ì¥ í—ˆìš©ëœ ì‚¬ìš©ìë§Œ í†µê³¼
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend Services               â”‚
â”‚  - Reservation API (ì˜ˆì•½)       â”‚
â”‚  - Inventory API (ì¬ê³ )         â”‚
â”‚  - Payment API (ê²°ì œ)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
DynamoDB (ì˜êµ¬ ì €ì¥)
```

### ë©˜íŠ¸

ìš°ë¦¬ê°€ ì„¤ê³„í•œ ì•„í‚¤í…ì²˜ì…ë‹ˆë‹¤.

**Browser (30ë§Œ ëª…)**
- í‹°ì¼“íŒ… ì˜¤í”ˆ ì‹œ ëŒ€ê¸°
- 5ì´ˆë§ˆë‹¤ ìì‹ ì˜ ìˆœë²ˆ ì¡°íšŒ (Polling)
- ìˆœë²ˆì´ ë˜ë©´ ì…ì¥ ì‹œë„

**Gateway API (Go + Fiber)**
- Queue API ì œê³µ:
  - `POST /queue/join`: ëŒ€ê¸°ì—´ ì°¸ì—¬
  - `GET /queue/status`: ìˆœë²ˆ ì¡°íšŒ
  - `POST /queue/enter`: ì…ì¥ ì‹œë„
- Redisë¡œ ëŒ€ê¸°ì—´ ê´€ë¦¬
- ì…ì¥ ì œì–´: ì´ˆë‹¹ 1,000ëª…ë§Œ í—ˆìš©

**Redis (ElastiCache)**
- **ZSET**: ëŒ€ê¸°ì—´ ìˆœì„œ ê´€ë¦¬ (timestamp ê¸°ë°˜)
- **Lua Script**: ì›ìì  Enqueue/Dequeue
- **TTL**: ë¹„í™œì„± ì‚¬ìš©ì ìë™ ì œê±° (Heartbeat ê¸°ë°˜)

**Backend Services**
- ì…ì¥ í—ˆìš©ëœ ì‚¬ìš©ìë§Œ ì ‘ê·¼ ê°€ëŠ¥
- Reservation API: ì˜ˆì•½ ìƒì„± ë° ê´€ë¦¬
- Inventory API: ì¬ê³  ì°¨ê° (ì˜¤ë²„ì…€ ë°©ì§€)
- Payment API: ê²°ì œ ì²˜ë¦¬

**DynamoDB**
- ì˜ˆì•½/ì£¼ë¬¸ ë°ì´í„° ì˜êµ¬ ì €ì¥
- ì“°ê¸°ëŠ” ì´ˆë‹¹ 1,000ê±´ë§Œ (Gateway ì œì–´ ë•ë¶„)

**í•µì‹¬ ì•„ì´ë””ì–´:**
Gateway + Redisê°€ **ë°©íŒŒì œ** ì—­í• ì„ í•©ë‹ˆë‹¤.
30ë§Œ ëª…ì˜ íŠ¸ë˜í”½ì„ ë°›ì•„ë‚´ê³ ,
ë’·ë‹¨ì€ ì•ˆì „í•˜ê²Œ ë³´í˜¸ë©ë‹ˆë‹¤.

---

## ğŸ“œ 1.6 ì™œ 1,000 RPSë¡œ ì…ì¥ ì œì–´ë¥¼ í–ˆëŠ”ê°€?

### ìŠ¬ë¼ì´ë“œ
```
"ì…ì¥ ì œì–´ ìš©ëŸ‰ ì‚°ì •"

ì§ˆë¬¸: "ì™œ í•˜í•„ 1,000 RPSì¸ê°€?"

ìš©ëŸ‰ ì‚°ì • ê³¼ì •:

1ï¸âƒ£ ì¢Œì„ ìˆ˜ ê¸°ì¤€
   - í‹°ì¼“: 10,000ì„
   - íŒë§¤ ì‹œê°„: 30ë¶„ ì´ë‚´ ëª©í‘œ
   - í•„ìš” ì²˜ë¦¬ëŸ‰: 10,000ì„ Ã· 1,800ì´ˆ = 5.5 RPS
   â†’ ë„ˆë¬´ ëŠë¦¼ âŒ

2ï¸âƒ£ ì‚¬ìš©ì ê²½í—˜ ê¸°ì¤€
   - 30ë§Œ ëª… ëŒ€ê¸°
   - í‰ê·  ëŒ€ê¸° ì‹œê°„: 5ë¶„ ì´ë‚´ ëª©í‘œ
   - í•„ìš” ì²˜ë¦¬ëŸ‰: 300,000ëª… Ã· 300ì´ˆ = 1,000 RPS
   â†’ ì ì ˆí•¨ âœ…

3ï¸âƒ£ Backend ì²˜ë¦¬ ëŠ¥ë ¥ ê²€ì¦
   - Reservation API: 3,000 RPS ê°€ëŠ¥ (ë¶€í•˜ í…ŒìŠ¤íŠ¸ ê²°ê³¼)
   - Inventory API: 5,000 RPS ê°€ëŠ¥ (gRPC ê³ ì„±ëŠ¥)
   - DynamoDB: On-demand ëª¨ë“œ (ë¬´ì œí•œ)
   â†’ 1,000 RPSëŠ” ì—¬ìœ ë¡œì›€ âœ…

4ï¸âƒ£ ë¹„ìš© ê³ ë ¤
   - DynamoDB ì“°ê¸°: $1.25 per 1M writes
   - 1,000 RPS = 3,600,000 writes/hour
   - 30ë¶„ = 1,800,000 writes = $2.25
   â†’ ê°ë‹¹ ê°€ëŠ¥ âœ…

ê²°ë¡ : 1,000 RPSê°€ ìµœì !
```

### ë©˜íŠ¸

ì—¬ê¸°ì„œ ì¤‘ìš”í•œ ì§ˆë¬¸ì´ í•˜ë‚˜ ìˆìŠµë‹ˆë‹¤.
**"ì™œ í•˜í•„ 1,000 RPSë¡œ ì…ì¥ ì œì–´ë¥¼ í–ˆëŠ”ê°€?"**

ì´ ìˆ«ìëŠ” ì•„ë¬´ë ‡ê²Œë‚˜ ì •í•œ ê²Œ ì•„ë‹™ë‹ˆë‹¤.
ìš©ëŸ‰ ì‚°ì • ê³¼ì •ì„ ê±°ì³¤ìŠµë‹ˆë‹¤.

**ì²«ì§¸, ì¢Œì„ ìˆ˜ ê¸°ì¤€ìœ¼ë¡œ ê³„ì‚°í–ˆìŠµë‹ˆë‹¤.**
- í‹°ì¼“: 10,000ì„
- íŒë§¤ ì‹œê°„: 30ë¶„ ì´ë‚´ ëª©í‘œ
- í•„ìš” ì²˜ë¦¬ëŸ‰: 10,000ì„ Ã· 1,800ì´ˆ = **5.5 RPS**

í•˜ì§€ë§Œ ì´ê±´ ë„ˆë¬´ ëŠë¦½ë‹ˆë‹¤.
30ë§Œ ëª…ì´ 5ë¶„ ë„˜ê²Œ ê¸°ë‹¤ë ¤ì•¼ í•©ë‹ˆë‹¤.
ì‚¬ìš©ì ê²½í—˜ì´ ë‚˜ì©ë‹ˆë‹¤.

**ë‘˜ì§¸, ì‚¬ìš©ì ê²½í—˜ ê¸°ì¤€ìœ¼ë¡œ ê³„ì‚°í–ˆìŠµë‹ˆë‹¤.**
- 30ë§Œ ëª…ì´ ëŒ€ê¸° ì¤‘
- í‰ê·  ëŒ€ê¸° ì‹œê°„: 5ë¶„ ì´ë‚´ ëª©í‘œ
- í•„ìš” ì²˜ë¦¬ëŸ‰: 300,000ëª… Ã· 300ì´ˆ = **1,000 RPS**

ì´ê²Œ ë” í•©ë¦¬ì ì…ë‹ˆë‹¤.
5ë¶„ì´ë©´ ì‚¬ìš©ìê°€ ê²¬ë”œ ë§Œí•œ ì‹œê°„ì…ë‹ˆë‹¤.

**ì…‹ì§¸, Backendê°€ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ”ì§€ ê²€ì¦í–ˆìŠµë‹ˆë‹¤.**
- **Reservation API**: ì‚¬ì „ ë¶€í•˜ í…ŒìŠ¤íŠ¸ ê²°ê³¼ 3,000 RPS ê°€ëŠ¥
- **Inventory API**: gRPC ê³ ì„±ëŠ¥ìœ¼ë¡œ 5,000 RPS ê°€ëŠ¥
- **DynamoDB**: On-demand ëª¨ë“œë¡œ ë¬´ì œí•œ í™•ì¥ ê°€ëŠ¥

1,000 RPSëŠ” Backend ì…ì¥ì—ì„œ ë§¤ìš° ì—¬ìœ ë¡­ìŠµë‹ˆë‹¤.
30% ìˆ˜ì¤€ì˜ ë¶€í•˜ì…ë‹ˆë‹¤.

**ë„·ì§¸, ë¹„ìš©ì„ ê³ ë ¤í–ˆìŠµë‹ˆë‹¤.**
- DynamoDB ì“°ê¸° ë¹„ìš©: $1.25 per 1M writes
- 1,000 RPS = 3,600,000 writes/hour
- 30ë¶„ í‹°ì¼“íŒ… = 1,800,000 writes = **$2.25**

ê°ë‹¹ ê°€ëŠ¥í•œ ë¹„ìš©ì…ë‹ˆë‹¤.

**ê²°ë¡ :**
1,000 RPSê°€ **ì‚¬ìš©ì ê²½í—˜, Backend ìš©ëŸ‰, ë¹„ìš©** ì¸¡ë©´ì—ì„œ ìµœì ì˜ ê· í˜•ì ì´ì—ˆìŠµë‹ˆë‹¤.

ì´ ìˆ«ì í•˜ë‚˜ë¥¼ ì •í•˜ëŠ” ë°ë„,
ì´ë ‡ê²Œ ë§ì€ ê³ ë¯¼ì´ ë“¤ì–´ê°‘ë‹ˆë‹¤.

---

## ğŸ“œ 1.7 Redis ì¸ìŠ¤í„´ìŠ¤ ì„ ì •

### ìŠ¬ë¼ì´ë“œ
```
"ElastiCache ì¸ìŠ¤í„´ìŠ¤ í¬ê¸° ê²°ì •"

ì§ˆë¬¸: "ì–´ë–¤ Redis ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì¨ì•¼ í•˜ë‚˜?"

ê³ ë ¤ ì‚¬í•­:

1ï¸âƒ£ ë©”ëª¨ë¦¬ ìš”êµ¬ëŸ‰
   - ëŒ€ê¸°ì—´ ë°ì´í„°: 30ë§Œ ëª… Ã— 1KB = 300MB
   - ì¸ë±ìŠ¤ ë°ì´í„°: ZSET Ã— 5 = 150MB
   - ë²„í¼: 2ë°° ì—¬ìœ  = 900MB
   â†’ ìµœì†Œ 2GB ì´ìƒ í•„ìš”

2ï¸âƒ£ ë„¤íŠ¸ì›Œí¬ ì²˜ë¦¬ëŸ‰
   - Status API: 30ë§Œ ëª… Ã— 0.2 RPS = 60k RPS
   - ê° ìš”ì²­: 1KB ì‘ë‹µ
   - í•„ìš” ëŒ€ì—­í­: 60MB/s
   â†’ ë„¤íŠ¸ì›Œí¬ ì„±ëŠ¥ ì¤‘ìš”

3ï¸âƒ£ CPU ì²˜ë¦¬ ëŠ¥ë ¥
   - ZRANK ì—°ì‚°: O(log N)
   - 60k RPS Ã— 0.01ms = 600ms CPU
   â†’ ë©€í‹° ì½”ì–´ í•„ìš”

4ï¸âƒ£ ê°€ìš©ì„± ë° í™•ì¥ì„±
   - Cluster Mode: 5 shards (ë°ì´í„° ë¶„ì‚°)
   - Read Replica: ê° ìƒ¤ë“œë‹¹ 1ê°œ (ì½ê¸° ë¶„ì‚°)
   - ì´ 10 nodes
   â†’ ê³ ê°€ìš©ì„± + ì„±ëŠ¥

ì„ íƒ: cache.m7g.xlarge (4 vCPU, 13GB RAM)
       Ã— 5 shards Ã— 2 (replica) = 10 nodes
```

### ë©˜íŠ¸

ì•„í‚¤í…ì²˜ë¥¼ ì„¤ê³„í–ˆìœ¼ë‹ˆ, ì´ì œ ì‹¤ì œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤.

**"ì–´ë–¤ Redis ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì¨ì•¼ í•˜ë‚˜?"**

**ì²«ì§¸, ë©”ëª¨ë¦¬ ìš”êµ¬ëŸ‰ì„ ê³„ì‚°í–ˆìŠµë‹ˆë‹¤.**
- ëŒ€ê¸°ì—´ ë°ì´í„°: 30ë§Œ ëª… Ã— 1KB (í† í° + ë©”íƒ€ë°ì´í„°) = 300MB
- Position Index: ZSET êµ¬ì¡° Ã— 5ê°œ ì´ë²¤íŠ¸ = 150MB
- ë²„í¼ ë° ê¸°íƒ€: 2ë°° ì—¬ìœ ë¶„ = 450MB
- ì´í•©: ì•½ 900MB

ìµœì†Œ 2GB ì´ìƒì˜ ë©”ëª¨ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.

**ë‘˜ì§¸, ë„¤íŠ¸ì›Œí¬ ì²˜ë¦¬ëŸ‰ì„ ê³„ì‚°í–ˆìŠµë‹ˆë‹¤.**
- Status API: 30ë§Œ ëª…ì´ 5ì´ˆë§ˆë‹¤ ì¡°íšŒ = 60k RPS
- ê° ìš”ì²­ë‹¹ ì‘ë‹µ: ì•½ 1KB (ìˆœë²ˆ + ë©”íƒ€ë°ì´í„°)
- í•„ìš” ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­í­: 60MB/s

ë„¤íŠ¸ì›Œí¬ ì„±ëŠ¥ì´ ì¤‘ìš”í•©ë‹ˆë‹¤.

**ì…‹ì§¸, CPU ì²˜ë¦¬ ëŠ¥ë ¥ì„ ì˜ˆì¸¡í–ˆìŠµë‹ˆë‹¤.**
- ZRANK ì—°ì‚°: O(log N) = log(300,000) â‰ˆ 18 ë¹„êµ
- 60k RPS Ã— 0.01ms = 600ms CPU ì‹œê°„/ì´ˆ
- ë©€í‹° ì½”ì–´ê°€ í•„ìš”í•©ë‹ˆë‹¤

**ë„·ì§¸, ê°€ìš©ì„±ê³¼ í™•ì¥ì„±ì„ ê³ ë ¤í–ˆìŠµë‹ˆë‹¤.**
- **Cluster Mode**: 5ê°œ ìƒ¤ë“œë¡œ ë°ì´í„° ë¶„ì‚°
  - ê° ìƒ¤ë“œ: 60MB ë©”ëª¨ë¦¬, 12k RPS ì²˜ë¦¬
- **Read Replica**: ê° ìƒ¤ë“œë‹¹ 1ê°œ ë³µì œë³¸
  - ì½ê¸° ë¶€í•˜ ë¶„ì‚°
  - ì¥ì•  ëŒ€ì‘ (ìë™ failover)
- **ì´ 10 nodes**: 5 primary + 5 replica

**ì„ íƒ: cache.m7g.xlarge**
- vCPU: 4 (ì¶©ë¶„í•œ ì²˜ë¦¬ ëŠ¥ë ¥)
- ë©”ëª¨ë¦¬: 13GB (ì—¬ìœ ë¡­ê²Œ)
- ë„¤íŠ¸ì›Œí¬: ìµœëŒ€ 12.5 Gbps (125MB/s)
- ARM64 Graviton: ë¹„ìš© íš¨ìœ¨ì 

**êµ¬ì„±: 5 shards Ã— 2 (primary + replica) = 10 nodes**

ì´ êµ¬ì„±ìœ¼ë¡œ 60k RPS Status APIë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ê·¸ë¦¬ê³  ì‹¤ì œë¡œëŠ”... 30k RPSë„ ì¶©ë¶„í•©ë‹ˆë‹¤.

---

## ğŸ“œ 1.8 ì´ˆê¸° êµ¬í˜„ ë° í…ŒìŠ¤íŠ¸

### ìŠ¬ë¼ì´ë“œ
```
"1ì°¨ ë¶€í•˜ í…ŒìŠ¤íŠ¸: 1,000 RPS"

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Component       â”‚ CPU  â”‚ Result â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Gateway API     â”‚ 5%   â”‚ âœ…      â”‚
â”‚ Redis           â”‚ 10%  â”‚ âœ…      â”‚
â”‚ Reservation API â”‚ 3%   â”‚ âœ…      â”‚
â”‚ DynamoDB        â”‚ 5%   â”‚ âœ…      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ëª¨ë“  ì»´í¬ë„ŒíŠ¸: ì—¬ìœ ë¡œì›€
ê²°ë¡ : ì•„í‚¤í…ì²˜ê°€ ì‘ë™í•œë‹¤! ğŸ‰

ë‹¤ìŒ ëª©í‘œ: 10,000 RPS
```

### ë©˜íŠ¸

ì´ˆê¸° êµ¬í˜„ì„ ë§ˆì¹˜ê³ , ì²« ë¶€í•˜ í…ŒìŠ¤íŠ¸ë¥¼ ëŒë ¸ìŠµë‹ˆë‹¤.
**1,000 RPS**ë¡œ ì‹œì‘í–ˆìŠµë‹ˆë‹¤.

ê²°ê³¼ëŠ” ì™„ë²½í–ˆìŠµë‹ˆë‹¤.
- Gateway API: CPU 5%
- Redis: CPU 10%
- Reservation API: CPU 3%
- DynamoDB: ì“°ê¸° 5%

ëª¨ë“  ì»´í¬ë„ŒíŠ¸ê°€ ì—¬ìœ ë¡œì› ìŠµë‹ˆë‹¤.

"**ì¢‹ì•„, ì•„í‚¤í…ì²˜ê°€ ì‘ë™í•œë‹¤!**"

ì´ì œ ëª©í‘œëŠ” **10,000 RPS**ì…ë‹ˆë‹¤.
ì ì§„ì ìœ¼ë¡œ ë¶€í•˜ë¥¼ ì˜¬ë ¤ë³´ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.

---

## ğŸ“œ 1.9 10k RPSì—ì„œ ë³‘ëª© ë°œê²¬

### ìŠ¬ë¼ì´ë“œ
```
"10,000 RPS ë¶€í•˜ í…ŒìŠ¤íŠ¸ ê²°ê³¼"

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Component          â”‚ CPU    â”‚ Status   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Gateway API        â”‚ 15%    â”‚ âœ… OK     â”‚
â”‚ Reservation API    â”‚ 5%     â”‚ âœ… OK     â”‚
â”‚ Inventory API      â”‚ 3%     â”‚ âœ… OK     â”‚
â”‚ Payment API        â”‚ 2%     â”‚ âœ… OK     â”‚
â”‚ DynamoDB          â”‚ 10%    â”‚ âœ… OK     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ElastiCache Redis  â”‚ 100%   â”‚ ğŸ”´ ë³‘ëª©!  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì˜ˆìƒ: "Gatewayê°€ í„°ì§ˆ ì¤„ ì•Œì•˜ëŠ”ë°..."
ì‹¤ì œ: "Redisê°€ í„°ì¡Œë„¤?"


ì™œ? ğŸ¤”
```

### ë©˜íŠ¸

ë¶€í•˜ë¥¼ 10,000 RPSë¡œ ì˜¬ë ¸ìŠµë‹ˆë‹¤.

ê·¸ë¦¬ê³  ëª¨ë‹ˆí„°ë§ì„ í™•ì¸í•˜ëŠ” ìˆœê°„,
ì˜ˆìƒê³¼ ë‹¤ë¥¸ ê²°ê³¼ë¥¼ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.

**Gateway API**: CPU 15% - ì—¬ì „íˆ ì—¬ìœ ë¡­ìŠµë‹ˆë‹¤.
**Reservation API**: CPU 5% - ë†€ê³  ìˆìŠµë‹ˆë‹¤.
**Inventory API**: CPU 3% - ë” ë†€ê³  ìˆìŠµë‹ˆë‹¤.
**DynamoDB**: 10% - ë¬¸ì œì—†ìŠµë‹ˆë‹¤.

ê·¸ëŸ°ë° ë”± í•˜ë‚˜,
**ElastiCache Redis: CPU 100%** ğŸ”´

ì˜ˆìƒí–ˆë˜ ê²ƒê³¼ ë‹¬ëìŠµë‹ˆë‹¤.
ìš°ë¦¬ëŠ” "Gatewayê°€ í„°ì§ˆ ì¤„" ì•Œì•˜ìŠµë‹ˆë‹¤.
í•˜ì§€ë§Œ í„°ì§„ ê±´ Redisì˜€ìŠµë‹ˆë‹¤.

**ì™œ ì´ëŸ° ì¼ì´ ë²Œì–´ì§„ ê±¸ê¹Œìš”?**

Gatewayì— ë¶€í•˜ë¥¼ ì§‘ì¤‘ì‹œí‚¤ëŠ” ì„¤ê³„ì˜€ìœ¼ë‹ˆ,
Redisì— ë¶€í•˜ê°€ ì§‘ì¤‘ë˜ëŠ” ê±´ ì–´ì©Œë©´ ë‹¹ì—°í•œ ê²°ê³¼ì˜€ìŠµë‹ˆë‹¤.

í•˜ì§€ë§Œ **10,000 RPSì—ì„œ ì´ë¯¸ í•œê³„**ë¼ë‹ˆ,
30,000 RPS ëª©í‘œëŠ” ìš”ì›í•´ ë³´ì˜€ìŠµë‹ˆë‹¤.

**ë¬¸ì œë¥¼ ì°¾ì•„ì•¼ í–ˆìŠµë‹ˆë‹¤.**

---

## ğŸ“œ 1.10 ë³‘ëª©ì˜ ê·¼ë³¸ ì›ì¸ (ê´€ì¸¡ì„±)

### ìŠ¬ë¼ì´ë“œ
```
"Redis CPU 100%, ì™œ?"

CloudWatch ë©”íŠ¸ë¦­ ë¶„ì„:
â”œâ”€ CommandsProcessed: ì´ˆë‹¹ 10ë§Œ+ ê±´
â”œâ”€ NetworkBytesIn: ë¹„ì •ìƒì ìœ¼ë¡œ ë†’ìŒ
â””â”€ EngineCPUUtilization: ì§€ì†ì  100%

pprof í”„ë¡œíŒŒì¼ë§:
â”œâ”€ calculateGlobalPosition() í•¨ìˆ˜
â”œâ”€ Redis KEYS ëª…ë ¹ì–´ í˜¸ì¶œ
â””â”€ ì´ˆë‹¹ 10,000ë²ˆ ì‹¤í–‰!


Redis KEYS ëª…ë ¹ì–´:
âŒ O(N) ì‹œê°„ ë³µì¡ë„ (ëª¨ë“  í‚¤ ìŠ¤ìº”)
âŒ Blocking operation (ë‹¤ë¥¸ ëª…ë ¹ì–´ ëŒ€ê¸°)
âŒ Cluster Modeì—ì„œ ëª¨ë“  ìƒ¤ë“œ ìŠ¤ìº”
âŒ 10k RPS = ì´ˆë‹¹ 1ë§Œë²ˆ KEYS ì‹¤í–‰!


ë²”ì¸: Status API
```

### ë©˜íŠ¸

Redis CPU 100%ì˜ ì›ì¸ì„ ì°¾ì•„ì•¼ í–ˆìŠµë‹ˆë‹¤.

**ì²« ë²ˆì§¸ ë‹¨ê³„: CloudWatch ë©”íŠ¸ë¦­ ë¶„ì„**

AWS ì½˜ì†”ì—ì„œ ë‹¤ìŒê³¼ ê°™ì´ í™•ì¸í–ˆìŠµë‹ˆë‹¤:

```
AWS Console â†’ ElastiCache â†’ Redis Clusters
â†’ traffic-tacos-redis í´ë¦­
â†’ CloudWatch Metrics íƒ­
```

í™•ì¸í•œ ì£¼ìš” ë©”íŠ¸ë¦­:
- `EngineCPUUtilization`: **ì§€ì†ì ìœ¼ë¡œ 100%** ğŸ”´
  - ì •ìƒ: 60% ì´í•˜
  - í˜„ì¬: 100% ìœ ì§€ (ìœ„í—˜!)

- `CommandsProcessed`: **ì´ˆë‹¹ 10ë§Œ+ ê±´**
  - ì •ìƒ: 3-5ë§Œ ê±´
  - í˜„ì¬: 10ë§Œ ê±´ ì´ìƒ (ë¹„ì •ìƒì ìœ¼ë¡œ ë§ìŒ)

- `NetworkBytesIn`: **ë¹„ì •ìƒì ìœ¼ë¡œ ë†’ìŒ**
  - ì •ìƒ: ìˆ˜ MB/s
  - í˜„ì¬: ìˆ˜ì‹­ MB/s (ë°ì´í„° ì „ì†¡ ê³¼ë‹¤)

ì´ ë©”íŠ¸ë¦­ë“¤ì´ ë§í•´ì£¼ëŠ” ê²ƒ:
"Redisê°€ ë„ˆë¬´ ë§ì€ ëª…ë ¹ì–´ë¥¼ ì²˜ë¦¬í•˜ê³  ìˆë‹¤"
"íŠ¹ì • ëª…ë ¹ì–´ê°€ ê³¼ë„í•˜ê²Œ ì‹¤í–‰ë˜ê³  ìˆë‹¤"

**ë‘ ë²ˆì§¸ ë‹¨ê³„: pprof í”„ë¡œíŒŒì¼ë§**

CloudWatchëŠ” "ë¬´ì—‡ì´ ë¬¸ì œì¸ì§€"ëŠ” ì•Œë ¤ì£¼ì§€ ì•ŠìŠµë‹ˆë‹¤.
"ì–´ë””ì„œ ë¬¸ì œê°€ ë°œìƒí•˜ëŠ”ì§€" ì°¾ì•„ì•¼ í–ˆìŠµë‹ˆë‹¤.

Go ì• í”Œë¦¬ì¼€ì´ì…˜ì—ëŠ” `pprof`ë¼ëŠ” ê°•ë ¥í•œ í”„ë¡œíŒŒì¼ë§ ë„êµ¬ê°€ ë‚´ì¥ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

```go
// cmd/gateway/main.go
import "github.com/gofiber/fiber/v2/middleware/pprof"

app.Use(pprof.New())
```

ì´ë ‡ê²Œ ì„¤ì •í•˜ë©´, `/debug/pprof/` ì—”ë“œí¬ì¸íŠ¸ë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**í”„ë¡œíŒŒì¼ë§ ì‹¤í–‰:**
```bash
# CPU í”„ë¡œíŒŒì¼ 30ì´ˆê°„ ìˆ˜ì§‘
curl http://gateway-api:8000/debug/pprof/profile?seconds=30 > cpu.prof

# í”„ë¡œíŒŒì¼ ë¶„ì„ (top í•¨ìˆ˜ë“¤)
go tool pprof -top cpu.prof

# ì›¹ UIë¡œ ë³´ê¸°
go tool pprof -http=:8080 cpu.prof
```

**ë¶„ì„ ê²°ê³¼:**
```
Showing nodes accounting for 3.5s, 85% of 4.1s total
      flat  flat%   sum%        cum   cum%
     2.1s 51.22% 51.22%      2.5s 60.98%  calculateGlobalPosition
     0.8s 19.51% 70.73%      0.9s 21.95%  redis.Keys
     0.3s  7.32% 78.05%      0.4s  9.76%  redis.XLen
     ...
```

ë²”ì¸ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤!
```go
// internal/queue/streams.go
func (sq *StreamQueue) calculateGlobalPosition(...) int {
    pattern := fmt.Sprintf("stream:event:{%s}:user:*", eventID)
    keys, err := sq.redis.Keys(ctx, pattern).Result() // ğŸ”´ ë²”ì¸!
    // ...
}
```

**`calculateGlobalPosition()` í•¨ìˆ˜ê°€ CPUì˜ 51%ë¥¼ ì°¨ì§€**í•˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤.
ê·¸ë¦¬ê³  ê·¸ ì•ˆì—ì„œ `redis.Keys()` í˜¸ì¶œì´ ëŒ€ë¶€ë¶„ì˜ ì‹œê°„ì„ ì†Œë¹„í–ˆìŠµë‹ˆë‹¤.

ì´ í•¨ìˆ˜ëŠ” **Status API**ì—ì„œ í˜¸ì¶œë©ë‹ˆë‹¤.

**Status API**ëŠ” ì‚¬ìš©ìê°€ ìì‹ ì˜ ìˆœë²ˆì„ ì¡°íšŒí•˜ëŠ” APIì…ë‹ˆë‹¤.
- ì‚¬ìš©ìëŠ” 5ì´ˆë§ˆë‹¤ í´ë§í•©ë‹ˆë‹¤
- 1ë§Œ ëª…ì´ ëŒ€ê¸° ì¤‘ì´ë©´? â†’ ì´ˆë‹¹ 2,000ê±´ì˜ Status API í˜¸ì¶œ
- 10ë§Œ ëª…ì´ ëŒ€ê¸° ì¤‘ì´ë©´? â†’ ì´ˆë‹¹ 20,000ê±´!

ê·¸ë¦¬ê³  ì´ í•¨ìˆ˜ê°€ **`KEYS` ëª…ë ¹ì–´**ë¥¼ ì‚¬ìš©í•˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤.

**`KEYS` ëª…ë ¹ì–´ì˜ ë¬¸ì œì :**
- **O(N) ì‹œê°„ ë³µì¡ë„**: ëª¨ë“  í‚¤ë¥¼ ìŠ¤ìº”í•©ë‹ˆë‹¤
- **Blocking operation**: ì‹¤í–‰ ì¤‘ ë‹¤ë¥¸ ëª…ë ¹ì–´ë¥¼ ë§‰ìŠµë‹ˆë‹¤
- **Cluster Mode**: ëª¨ë“  ìƒ¤ë“œë¥¼ ìŠ¤ìº”í•©ë‹ˆë‹¤
- **í”„ë¡œë•ì…˜ ê¸ˆì§€**: Redis ê³µì‹ ë¬¸ì„œì—ì„œë„ ì‚¬ìš© ê¸ˆì§€

10,000 RPS Status APIë©´,
**ì´ˆë‹¹ 10,000ë²ˆì˜ KEYS ëª…ë ¹ì–´**ê°€ ì‹¤í–‰ë˜ëŠ” ê²ë‹ˆë‹¤.

Redisê°€ ë²„í‹¸ ìˆ˜ ì—†ì—ˆì£ .

**ì™œ ì´ëŸ° ì½”ë“œë¥¼ ì§°ì„ê¹Œìš”?**
ì´ˆê¸°ì—ëŠ” "ë¹¨ë¦¬ ë§Œë“¤ì"ì— ì§‘ì¤‘í–ˆê³ ,
ì„±ëŠ¥ ìµœì í™”ëŠ” ë‚˜ì¤‘ì— í•˜ë ¤ê³  í–ˆìŠµë‹ˆë‹¤.
í•˜ì§€ë§Œ 10k RPSì—ì„œ ì´ë¯¸ í•œê³„ì— ë„ë‹¬í–ˆìŠµë‹ˆë‹¤.

---

## ğŸ“œ 1.11 í•´ê²° ë°©ë²• - Position Index

### ìŠ¬ë¼ì´ë“œ
```
"KEYS ì œê±°, Index ë„ì…"

Before (KEYS scan):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Status API í˜¸ì¶œ                 â”‚
â”‚   â†“                             â”‚
â”‚ calculateGlobalPosition()       â”‚
â”‚   â†“                             â”‚
â”‚ KEYS stream:event:{evt}:user:*  â”‚
â”‚   â†“ O(N) = 10,000+ keys         â”‚
â”‚   â†“ ~100ms (blocking)           â”‚
â”‚   â†“ CPU 100% ğŸ’¥                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

After (Position Index):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Status API í˜¸ì¶œ                 â”‚
â”‚   â†“                             â”‚
â”‚ CalculateApproximatePosition()  â”‚
â”‚   â†“                             â”‚
â”‚ ZRANK queue:event:{evt}:positionâ”‚
â”‚   â†“ O(log N) = ~14 comparisons  â”‚
â”‚   â†“ <1ms (non-blocking)         â”‚
â”‚   â†“ CPU 40% âœ…                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì„±ëŠ¥ ê°œì„ : ~100ë°°!
```

### ë©˜íŠ¸

í•´ê²° ë°©ë²•ì€ ëª…í™•í–ˆìŠµë‹ˆë‹¤.
**KEYSë¥¼ ì—†ì• ê³ , ì¸ë±ìŠ¤ë¥¼ ë§Œë“¤ì.**

**Position Index**ë¼ëŠ” ê°œë…ì„ ë„ì…í–ˆìŠµë‹ˆë‹¤.
ZSET ê¸°ë°˜ì˜ ì¸ë±ìŠ¤ì…ë‹ˆë‹¤.

**ì‘ë™ ë°©ì‹:**

1. **Join ì‹œ (ëŒ€ê¸°ì—´ ì°¸ì—¬):**
   ```go
   // Position Indexì— ì¶”ê°€
   indexKey := "queue:event:{evt}:position"
   score := time.Now().UnixNano() // timestamp
   redis.ZAdd(ctx, indexKey, redis.Z{Score: score, Member: token})
   ```

2. **Status ì‹œ (ìˆœë²ˆ ì¡°íšŒ):**
   ```go
   // Position Indexì—ì„œ rank ì¡°íšŒ
   rank, err := redis.ZRank(ctx, indexKey, token).Result()
   position := int(rank) + 1 // 0-based â†’ 1-based
   ```

**ì‹œê°„ ë³µì¡ë„ ë¹„êµ:**
- `KEYS`: O(N) - 10,000 keysë©´ ~100ms
- `ZRANK`: O(log N) - 10,000 keysë©´ ~14 comparisons, <1ms

**100ë°° ë¹ ë¦…ë‹ˆë‹¤!**

ê·¸ë¦¬ê³  ë¬´ì—‡ë³´ë‹¤,
`ZRANK`ëŠ” **non-blocking**ì…ë‹ˆë‹¤.
ë‹¤ë¥¸ ëª…ë ¹ì–´ë¥¼ ë°©í•´í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

**êµ¬í˜„ í›„ í…ŒìŠ¤íŠ¸:**
- Redis CPU: 100% â†’ 40%
- Status API ì‘ë‹µ ì‹œê°„: 100ms â†’ <5ms
- ì²˜ë¦¬ëŸ‰: 10k RPS â†’ ì—¬ìœ ë¡œì›€

**ë“œë””ì–´ ë³‘ëª©ì„ í•´ê²°í–ˆìŠµë‹ˆë‹¤!**

---

## ğŸ“œ 1.12 ì¶”ê°€ ìµœì í™”ë“¤

### ìŠ¬ë¼ì´ë“œ
```
"ì„¸ë¶€ íŠœë‹"

3ê°€ì§€ ì¶”ê°€ ìµœì í™”:

1ï¸âƒ£ Redis Connection Pool
   PoolSize: 100 â†’ 1000
   PoolTimeout: 4s â†’ 10s
   â†’ ê³ ë¶€í•˜ì—ì„œ connection pool timeout ì œê±°

2ï¸âƒ£ Go ë©”ëª¨ë¦¬ ìµœì í™”
   GOMEMLIMIT=450MiB
   GOGC=75
   â†’ GC ì ê·¹ ì‹¤í–‰, HPA scale-down ì •ìƒí™”

3ï¸âƒ£ Readiness Probe ì¡°ì •
   initialDelaySeconds: 5 â†’ 15ì´ˆ
   â†’ Redis Cluster ì—°ê²° ëŒ€ê¸°
   â†’ Pod ì‹œì‘ ì•ˆì •í™”
```

### ë©˜íŠ¸

Position Indexë¡œ í° ë³‘ëª©ì„ í•´ê²°í–ˆì§€ë§Œ,
ì„¸ë¶€ íŠœë‹ì´ ë” í•„ìš”í–ˆìŠµë‹ˆë‹¤.

**ì²«ì§¸, Redis Connection Pool**

ê³ ë¶€í•˜ì—ì„œ `redis: connection pool timeout` ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.
- ê¸°ë³¸ Pool Sizeê°€ 100ìœ¼ë¡œ ë¶€ì¡±
- Timeoutì´ 4ì´ˆë¡œ ì§§ìŒ

**í•´ê²°:**
- `PoolSize: 1000` (10ë°° ì¦ê°€)
- `PoolTimeout: 10s` (2.5ë°° ì¦ê°€)
- `MinIdleConns: 100` (warm pool)

**ë‘˜ì§¸, Go ë©”ëª¨ë¦¬ ìµœì í™”**

í…ŒìŠ¤íŠ¸ í›„ì—ë„ ë©”ëª¨ë¦¬ê°€ í•´ì œë˜ì§€ ì•Šì•„,
HPAê°€ scale-downì„ ëª» í•˜ëŠ” ë¬¸ì œê°€ ìˆì—ˆìŠµë‹ˆë‹¤.

**í•´ê²°:**
- `GOMEMLIMIT=450MiB`: Go GCê°€ ë©”ëª¨ë¦¬ í•œê³„ ì¸ì‹
- `GOGC=75`: ë” ìì£¼ GC ì‹¤í–‰ (ê¸°ë³¸ê°’ 100)
- `GODEBUG=madvdontneed=1`: ë©”ëª¨ë¦¬ ì¦‰ì‹œ ë°˜í™˜

ê²°ê³¼: í…ŒìŠ¤íŠ¸ í›„ ë©”ëª¨ë¦¬ 200Mi â†’ 80Mi

**ì…‹ì§¸, Readiness Probe**

Pod ì‹œì‘ ì‹œ Redis Cluster ì—°ê²°ì— 10ì´ˆ ì •ë„ ê±¸ë¦¬ëŠ”ë°,
Readiness Probeê°€ 5ì´ˆë§Œ ê¸°ë‹¤ë¦¬ê³  NotReady íŒì •.

**í•´ê²°:**
- `initialDelaySeconds: 15ì´ˆ` (ì¶©ë¶„í•œ ëŒ€ê¸°)
- `periodSeconds: 5ì´ˆ` (ì²´í¬ ê°„ê²© ì™„í™”)
- `failureThreshold: 3` (ì‹¤íŒ¨ í—ˆìš© ì¦ê°€)

ê²°ê³¼: Rolling updateê°€ ë¶€ë“œëŸ½ê²Œ ì§„í–‰

---

## ğŸ“œ 1.13 ìµœì¢… ê²°ê³¼

### ìŠ¬ë¼ì´ë“œ
```
"30,000 RPS ë‹¬ì„±!"

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RPS     â”‚ Redis CPU â”‚ Result          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Before  (KEYS ì‚¬ìš©)                    â”‚
â”‚ 10k     â”‚ 100%      â”‚ âŒ í•œê³„ ë„ë‹¬     â”‚
â”‚ 15k+    â”‚ N/A       â”‚ âŒ ë¶ˆê°€ëŠ¥        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ After   (Position Index)               â”‚
â”‚ 10k     â”‚ 40%       â”‚ âœ… ì—¬ìœ           â”‚
â”‚ 20k     â”‚ 70%       â”‚ âœ… ì•ˆì •          â”‚
â”‚ 30k     â”‚ 90%       â”‚ âœ… ëª©í‘œ ë‹¬ì„±!    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì¶”ê°€ ë¹„ìš©: 0ì› (ì½”ë“œ ìµœì í™”ë§Œ)
ë…¸ë“œ ì¦ì„¤: ë¶ˆí•„ìš”
ElastiCache: cache.m7g.xlarge Ã— 10 nodes ìœ ì§€
```

### ë©˜íŠ¸

ìµœì¢… ë¶€í•˜ í…ŒìŠ¤íŠ¸ ê²°ê³¼ì…ë‹ˆë‹¤.

**ìµœì í™” ì „ (KEYS ì‚¬ìš©):**
- 10k RPS: Redis CPU 100% - í•œê³„ ë„ë‹¬
- 15k RPS ì´ìƒ: ë¶ˆê°€ëŠ¥

**ìµœì í™” í›„ (Position Index):**
- **10k RPS**: Redis CPU 40% - ì—¬ìœ ë¡­ìŠµë‹ˆë‹¤
- **20k RPS**: Redis CPU 70% - ì•ˆì •ì ì…ë‹ˆë‹¤
- **30k RPS**: Redis CPU 90% - **ëª©í‘œ ë‹¬ì„±!** ğŸ‰

ê·¸ë¦¬ê³  ë¬´ì—‡ë³´ë‹¤,
**ì¶”ê°€ ë¹„ìš©ì´ ë“¤ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.**

- Redis ë…¸ë“œ ì¦ì„¤? â†’ ë¶ˆí•„ìš”
- EKS ë…¸ë“œ ì¦ì„¤? â†’ ë¶ˆí•„ìš”
- ì½”ë“œ ìµœì í™”ë§Œìœ¼ë¡œ ë‹¬ì„±

**cache.m7g.xlarge Ã— 10 nodes** ê·¸ëŒ€ë¡œ
30k RPSë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

---

## ğŸ“œ 1.14 ì„¤ê³„ ê²€ì¦

### ìŠ¬ë¼ì´ë“œ
```
"ì•„í‚¤í…ì²˜ ì„¤ê³„ê°€ ë§ì•˜ë‹¤"

ìš°ë¦¬ì˜ ê°€ì„¤:
"Gateway + Redisê°€ ë°©íŒŒì œ ì—­í• ì„ í•  ê²ƒì´ë‹¤"

ê²€ì¦ ê²°ê³¼:
âœ… Gateway + Redisê°€ 30ë§Œ ëª… íŠ¸ë˜í”½ ë°›ì•„ëƒ„
âœ… ì…ì¥ ì œì–´ë¡œ ë’·ë‹¨ ë³´í˜¸ (1,000 RPSë¡œ ì œí•œ)
âœ… Backend CPU < 5% (ë§¤ìš° ì—¬ìœ ë¡œì›€)
âœ… DynamoDB 10% ì‚¬ìš© (ì“°ê¸° ë¹„ìš© ì ˆê°)
âœ… ë¹„ìš© ì¦ê°€ ì—†ì´ 30k RPS ë‹¬ì„±


Trade-off ìˆ˜ìš©:
"Gateway ë¶€í•˜ ì§‘ì¤‘" â†’ ìµœì í™”ë¡œ í•´ê²°
"Redis ë³‘ëª©" â†’ Position Indexë¡œ í•´ê²°


ì„¤ê³„ ì² í•™ ê²€ì¦:
âœ… ì‹¤ì‹œê°„ í”¼ë“œë°± (ìˆœë²ˆ ì¡°íšŒ)
âœ… ë’·ë‹¨ ë³´í˜¸ (ì…ì¥ ì œì–´)
âœ… ê³µì •ì„± ë³´ì¥ (ëŒ€ê¸°ì—´ ê´€ë¦¬)
âœ… ë¹„ìš© íš¨ìœ¨ì„± (ì½”ë“œ ìµœì í™”)
```

### ë©˜íŠ¸

ê°€ì¥ ì¤‘ìš”í•œ êµí›ˆì€,
**ìš°ë¦¬ì˜ ì•„í‚¤í…ì²˜ ì„¤ê³„ê°€ ë§ì•˜ë‹¤**ëŠ” ê²ë‹ˆë‹¤.

**ì²˜ìŒ ì„¤ê³„ ë‹¨ê³„ì—ì„œ ì„¸ìš´ ê°€ì„¤:**
"Gateway + Redisê°€ ë°©íŒŒì œ ì—­í• ì„ í•  ê²ƒì´ë‹¤"

**ê²€ì¦ ê²°ê³¼:**
- Gateway + Redisê°€ 30ë§Œ ëª…ì˜ íŠ¸ë˜í”½ì„ ë°›ì•„ëƒˆìŠµë‹ˆë‹¤
- ì…ì¥ ì œì–´ë¡œ ë’·ë‹¨ì„ ë³´í˜¸í–ˆìŠµë‹ˆë‹¤ (1,000 RPSë¡œ ì œí•œ)
- Backend ì„œë¹„ìŠ¤ë“¤ì€ CPU 5% ë¯¸ë§Œìœ¼ë¡œ ì—¬ìœ ë¡œì› ìŠµë‹ˆë‹¤
- DynamoDBëŠ” 10%ë§Œ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤ (ì“°ê¸° ë¹„ìš© ì ˆê°)
- ë¹„ìš© ì¦ê°€ ì—†ì´ 30k RPSë¥¼ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤

**Trade-off ìˆ˜ìš©:**
ìš°ë¦¬ëŠ” "Gatewayì— ë¶€í•˜ê°€ ì§‘ì¤‘ë  ê²ƒ"ì„ ì•Œê³  ìˆì—ˆìŠµë‹ˆë‹¤.
í•˜ì§€ë§Œ ì´ Trade-offë¥¼ ìˆ˜ìš©í•˜ê³ , ìµœì í™”ì— ì§‘ì¤‘í–ˆìŠµë‹ˆë‹¤.
- Position Index ë„ì…
- Connection Pool íŠœë‹
- Go ë©”ëª¨ë¦¬ ìµœì í™”

**ì„¤ê³„ ì² í•™ ê²€ì¦:**
1. **ì‹¤ì‹œê°„ í”¼ë“œë°±**: ì‚¬ìš©ìëŠ” 5ì´ˆë§ˆë‹¤ ìˆœë²ˆ í™•ì¸ âœ…
2. **ë’·ë‹¨ ë³´í˜¸**: Backend CPU < 5% âœ…
3. **ê³µì •ì„± ë³´ì¥**: ëŒ€ê¸°ì—´ ìˆœì„œ ê´€ë¦¬ âœ…
4. **ë¹„ìš© íš¨ìœ¨ì„±**: ì¶”ê°€ ë¹„ìš© 0ì› âœ…

ë§Œì•½ ë‹¤ë¥¸ ì•„í‚¤í…ì²˜ë¥¼ ì„ íƒí–ˆë‹¤ë©´?
- Direct Access: DBê°€ í„°ì¡Œì„ ê²ë‹ˆë‹¤
- Queue Service: ì‚¬ìš©ì ê²½í—˜ì´ ë‚˜ë¹´ì„ ê²ë‹ˆë‹¤

**Gateway + ì…ì¥ ì œì–´ê°€ ì •ë‹µì´ì—ˆìŠµë‹ˆë‹¤.**

---

# ğŸ”’ Part 2: ë³´ì•ˆ (Security) - 10ë¶„

## ğŸ“œ 2.1 ì™¸ë¶€ íŠ¸ë˜í”½ ë³´ì•ˆ: WAF + CAPTCHA

### ìŠ¬ë¼ì´ë“œ
```
"ì²« ë²ˆì§¸ ë°©ì–´ì„ : Edge Security"

ì„¤ê³„ ê³ ë¯¼:
â”œâ”€ ë¬¸ì œ: í‹°ì¼“íŒ… ì˜¤í”ˆ ì‹œ ë´‡ íŠ¸ë˜í”½ í­ì¦ (ì‹¤ì œ ì‚¬ìš©ì vs ë´‡ êµ¬ë¶„ í•„ìš”)
â”œâ”€ ìš”êµ¬ì‚¬í•­: 
â”‚   â””â”€ ì •ìƒ ì‚¬ìš©ì ì˜í–¥ ìµœì†Œí™”
â”‚   â””â”€ ë´‡ íŠ¸ë˜í”½ ì‚¬ì „ ì°¨ë‹¨
â”‚   â””â”€ DDoS ê³µê²© ë°©ì–´
â””â”€ ê³ ë¯¼: CloudFront WAF vs ALB WAF?

ì„ íƒ: CloudFront + AWS WAF + CAPTCHA
â”œâ”€ CloudFront: Edge ë ˆë²¨ ë°©ì–´ (ì „ ì„¸ê³„ 216ê°œ PoP)
â”œâ”€ AWS WAF: Managed Rules + Custom Rules
â”œâ”€ CAPTCHA: AWS WAF CAPTCHA (JavaScript Challenge)
â””â”€ AWS Shield Standard: ìë™ DDoS ë°©ì–´

êµ¬í˜„ ê²°ê³¼:
â”œâ”€ Rate-based Rule: 100 req/5min per IP
â”œâ”€ Geo-blocking: íŠ¹ì • êµ­ê°€ ì°¨ë‹¨ (ì„¤ì • ê°€ëŠ¥)
â”œâ”€ Known Bot Blocking: AWS Managed Bot Control
â””â”€ CAPTCHA Challenge: ì˜ì‹¬ IP ìë™ ê²€ì¦
```

### ë©˜íŠ¸

**ì„¤ê³„ ë‹¨ê³„ ê³ ë¯¼:**

í‹°ì¼“íŒ… ì‹œìŠ¤í…œ ì„¤ê³„ ì´ˆê¸°, ê°€ì¥ í° ê³ ë¯¼ì€ **ë´‡ íŠ¸ë˜í”½**ì´ì—ˆìŠµë‹ˆë‹¤.
- ì‹¤ì œ ì‚¬ë¡€: í•œ ì´ë²¤íŠ¸ì—ì„œ 30ë§Œ ëª… ëŒ€ê¸° ì¤‘ **20%ê°€ ë´‡**ìœ¼ë¡œ ì¶”ì •
- ë´‡ì´ ë¨¼ì € í‹°ì¼“ì„ ì„ ì í•˜ë©´, ì‹¤ì œ ê³ ê° ë¶ˆë§Œ í­ë°œ
- í•˜ì§€ë§Œ ê³¼ë„í•œ ë³´ì•ˆì€ ì •ìƒ ì‚¬ìš©ì ê²½í—˜ ì €í•˜

**ê³ ë¯¼í•œ ì„ íƒì§€:**
1. **ALB WAF**: ë¹„ìš© ì €ë ´, í•˜ì§€ë§Œ ëª¨ë“  íŠ¸ë˜í”½ì´ EKSê¹Œì§€ ë„ë‹¬
2. **CloudFront WAF**: ë¹„ìš© ë†’ìŒ, í•˜ì§€ë§Œ Edgeì—ì„œ ì°¨ë‹¨ (ëŒ€ì—­í­ ì ˆê°)
3. **Third-party (Cloudflare)**: ê°•ë ¥, í•˜ì§€ë§Œ AWS ìƒíƒœê³„ ì´íƒˆ

**ìš°ë¦¬ì˜ ì„ íƒ: CloudFront + AWS WAF**

ì´ìœ :
- **Edgeì—ì„œ ì°¨ë‹¨**: ì•…ì„± íŠ¸ë˜í”½ì´ EKSì— ë„ë‹¬í•˜ê¸° ì „ì— ì°¨ë‹¨
- **ëŒ€ì—­í­ ì ˆê°**: ì°¨ë‹¨ëœ íŠ¸ë˜í”½ì€ AWS ìš”ê¸ˆ ë¶€ê³¼ ì•ˆë¨
- **Managed Rules**: AWSê°€ ê´€ë¦¬í•˜ëŠ” ë´‡ ì°¨ë‹¨ ê·œì¹™ (ìë™ ì—…ë°ì´íŠ¸)

**ì‹¤ì œ êµ¬í˜„:**
```hcl
# AWS WAF Web ACL
resource "aws_wafv2_web_acl" "main" {
  name  = "traffic-tacos-waf"
  scope = "CLOUDFRONT"

  # Rule 1: Rate Limiting (100 req/5min per IP)
  rate_based_statement {
    limit              = 100
    aggregate_key_type = "IP"
  }

  # Rule 2: AWS Managed Bot Control
  managed_rule_group_statement {
    vendor_name = "AWS"
    name        = "AWSManagedRulesBotControlRuleSet"
  }

  # Rule 3: CAPTCHA Challenge
  captcha_config {
    immunity_time_property {
      immunity_time = 300  # 5ë¶„ê°„ CAPTCHA ë©´ì œ
    }
  }
}
```

**ìš´ì˜ ê²½í—˜ (ì‹¤ì œ ë°ì´í„°):**

**1ì°¨ í‹°ì¼“íŒ… (WAF ì ìš© ì „):**
- ì´ ìš”ì²­: 50ë§Œ ê±´
- ë´‡ íŠ¸ë˜í”½: ì•½ 10ë§Œ ê±´ (ì¶”ì •)
- ì„œë²„ ë¶€í•˜: Gateway API CPU 85%
- ê³ ê° ë¶ˆë§Œ: ë†’ìŒ (ë´‡ì´ ë¨¼ì € ì„ ì )

**2ì°¨ í‹°ì¼“íŒ… (WAF + CAPTCHA ì ìš© í›„):**
- ì´ ìš”ì²­: 60ë§Œ ê±´
- WAF ì°¨ë‹¨: 15ë§Œ ê±´ (25%)
- CAPTCHA í†µê³¼: 45ë§Œ ê±´
- ì„œë²„ ë¶€í•˜: Gateway API CPU 45% (40% ê°ì†Œ)
- ëŒ€ì—­í­ ì ˆê°: ì•½ 30% (ì°¨ë‹¨ëœ íŠ¸ë˜í”½)
- ê³ ê° ë§Œì¡±ë„: ìƒìŠ¹ (ì •ìƒ ì‚¬ìš©ì ê²½í—˜ ê°œì„ )

**WAF ì°¨ë‹¨ ìœ í˜• ë¶„ì„:**
- Rate-based Rule: 60% (IPë‹¹ ì´ˆê³¼ ìš”ì²­)
- Bot Control: 30% (Known Bot íŒ¨í„´)
- Geo-blocking: 10% (íŠ¹ì • êµ­ê°€)

**CAPTCHA íš¨ê³¼:**
- False Positive: < 2% (ì •ìƒ ì‚¬ìš©ìê°€ CAPTCHA ë³¸ ë¹„ìœ¨)
- í‰ê·  í•´ê²° ì‹œê°„: 3ì´ˆ
- ì‚¬ìš©ì ë¶ˆë§Œ: ê±°ì˜ ì—†ìŒ (ë´‡ ì°¨ë‹¨ íš¨ê³¼ê°€ ë” í¼)

**êµí›ˆ:**
- Edge ë³´ì•ˆì€ í•„ìˆ˜ (ì„œë²„ ë¦¬ì†ŒìŠ¤ ì ˆê° + ëŒ€ì—­í­ ì ˆê°)
- CAPTCHAëŠ” ì‹ ì¤‘í•˜ê²Œ (False Positive ìµœì†Œí™”)
- Managed Rules í™œìš© (AWSê°€ ìë™ìœ¼ë¡œ ë´‡ íŒ¨í„´ ì—…ë°ì´íŠ¸)
- ëª¨ë‹ˆí„°ë§ ì¤‘ìš” (WAF ë¡œê·¸ â†’ CloudWatch â†’ ì•ŒëŒ)

---

## ğŸ“œ 2.2 ë‚´ë¶€ íŠ¸ë˜í”½ ë³´ì•ˆ: Istio Ambient Mode

### ìŠ¬ë¼ì´ë“œ
```
"ë‘ ë²ˆì§¸ ë°©ì–´ì„ : Service Mesh Security"

ì„¤ê³„ ê³ ë¯¼:
â”œâ”€ ë¬¸ì œ: MSA í™˜ê²½ì—ì„œ ì„œë¹„ìŠ¤ ê°„ í†µì‹  ë³´ì•ˆ
â”‚   â”œâ”€ Gateway â†’ Reservation â†’ Inventory â†’ Payment
â”‚   â”œâ”€ í‰ë¬¸ í†µì‹ ? mTLS í•„ìš”? 
â”‚   â””â”€ ì„œë¹„ìŠ¤ ê°„ ì¸ì¦/ì¸ê°€?
â”‚
â”œâ”€ ìš”êµ¬ì‚¬í•­:
â”‚   â”œâ”€ ì„œë¹„ìŠ¤ ê°„ ì•”í˜¸í™” (mTLS)
â”‚   â”œâ”€ ì„œë¹„ìŠ¤ ê°„ ì¸ê°€ (Authorization Policy)
â”‚   â”œâ”€ íŠ¸ë˜í”½ ê°€ì‹œì„± (Observability)
â”‚   â””â”€ ì„±ëŠ¥ ì˜¤ë²„í—¤ë“œ ìµœì†Œí™”
â”‚
â””â”€ ê³ ë¯¼: Istio Sidecar vs Ambient vs Linkerd vs Cilium?

ì„ íƒ: Istio Ambient Mode
â”œâ”€ No Sidecar: ì»¨í…Œì´ë„ˆ ì—†ì´ ztunnel (node-level proxy)
â”œâ”€ mTLS ìë™í™”: ì¸ì¦ì„œ ìë™ ê°±ì‹ 
â”œâ”€ Layer 4 ë³´ì•ˆ: TCP/UDP ìˆ˜ì¤€ ì•”í˜¸í™”
â”œâ”€ ì„±ëŠ¥: Sidecar ëŒ€ë¹„ CPU/Memory 50% ì ˆê°
â””â”€ Layer 7: Waypoint proxy (ì„ íƒì )

êµ¬í˜„ ê²°ê³¼:
â”œâ”€ ëª¨ë“  ì„œë¹„ìŠ¤ ê°„ mTLS ìë™ ì ìš©
â”œâ”€ AuthorizationPolicy: í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ê¸°ë°˜
â”œâ”€ CPU ì˜¤ë²„í—¤ë“œ: < 5% (Sidecar 15% ëŒ€ë¹„)
â””â”€ ì•”í˜¸í™” ì„±ëŠ¥: ê±°ì˜ ì˜í–¥ ì—†ìŒ (ztunnel ìµœì í™”)
```

### ë©˜íŠ¸

**ì„¤ê³„ ë‹¨ê³„ ê³ ë¯¼:**

MSA í™˜ê²½ì—ì„œ ì„œë¹„ìŠ¤ ê°„ í†µì‹ ì€ ê¸°ë³¸ì ìœ¼ë¡œ í‰ë¬¸ì…ë‹ˆë‹¤.
- Gateway â†’ Reservation: gRPC (í‰ë¬¸)
- Reservation â†’ Inventory: gRPC (í‰ë¬¸)
- Inventory â†’ DynamoDB: TLS (ì•”í˜¸í™”)

**ë¬¸ì œì :**
- í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ê°€ ì¹¨í•´ë˜ë©´? â†’ ëª¨ë“  íŠ¸ë˜í”½ ë„ì²­ ê°€ëŠ¥
- ì„œë¹„ìŠ¤ ê°„ ì¸ì¦ ì—†ìŒ â†’ ì•…ì˜ì  Podê°€ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ í˜¸ì¶œ ê°€ëŠ¥
- Zero Trust ìœ„ë°˜ â†’ "ë‚´ë¶€ëŠ” ì•ˆì „í•˜ë‹¤"ëŠ” ê°€ì •

**ê³ ë¯¼í•œ ì„ íƒì§€:**

**1. Istio Sidecar Mode:**
- âœ… ì„±ìˆ™í•œ ê¸°ìˆ , í’ë¶€í•œ ê¸°ëŠ¥
- âŒ Sidecar ì»¨í…Œì´ë„ˆ ì˜¤ë²„í—¤ë“œ (CPU +15%, Memory +50MB/pod)
- âŒ ë°°í¬ ë³µì¡ë„ ì¦ê°€

**2. Linkerd:**
- âœ… ê²½ëŸ‰í™”, ì„±ëŠ¥ ìš°ìˆ˜
- âŒ ìƒíƒœê³„ ì‘ìŒ, AWS EKS ìµœì í™” ë¶€ì¡±

**3. Cilium Service Mesh:**
- âœ… eBPF ê¸°ë°˜, ì´ˆê³ ì„±ëŠ¥
- âŒ Learning curve ë†’ìŒ, ìš´ì˜ ë³µì¡

**4. Istio Ambient Mode:**
- âœ… Sidecar ì—†ìŒ (ztunnel node-level proxy)
- âœ… CPU/Memory 50% ì ˆê°
- âœ… Istio ìƒíƒœê³„ í™œìš© ê°€ëŠ¥
- âš ï¸ ì‹ ê¸°ìˆ  (2023ë…„ Beta)

**ìš°ë¦¬ì˜ ì„ íƒ: Istio Ambient Mode**

ì´ìœ :
- **ì„±ëŠ¥**: Sidecar ëŒ€ë¹„ CPU 50% ì ˆê° (30k RPS í™˜ê²½ì—ì„œ ì¤‘ìš”)
- **ê°„í¸í•¨**: ê¸°ì¡´ Pod ìˆ˜ì • ë¶ˆí•„ìš” (Namespace labelë§Œ ì¶”ê°€)
- **Zero Trust**: ëª¨ë“  íŠ¸ë˜í”½ ìë™ mTLS ì•”í˜¸í™”
- **ë‹¨ê³„ì  ë„ì…**: Layer 4 â†’ Layer 7 (Waypoint) ì„ íƒì  ì ìš©

**ì‹¤ì œ êµ¬í˜„:**
```yaml
# Istio Ambient í™œì„±í™” (Namespace label)
apiVersion: v1
kind: Namespace
metadata:
  name: tickets-api
  labels:
    istio.io/dataplane-mode: ambient  # Ambient ëª¨ë“œ í™œì„±í™”
```

```yaml
# AuthorizationPolicy: Gatewayë§Œ Reservation í˜¸ì¶œ í—ˆìš©
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: reservation-access-policy
spec:
  selector:
    matchLabels:
      app: reservation-api
  action: ALLOW
  rules:
  - from:
    - source:
        principals: ["cluster.local/ns/tickets-api/sa/gateway-api"]  # Gateway SAë§Œ í—ˆìš©
```

**ìš´ì˜ ê²½í—˜ (ì‹¤ì œ ë°ì´í„°):**

**ì ìš© ì „ (í‰ë¬¸ í†µì‹ ):**
- íŠ¸ë˜í”½: í‰ë¬¸
- ë³´ì•ˆ: ì—†ìŒ (ë‚´ë¶€ ì‹ ë¢°)
- CPU ì˜¤ë²„í—¤ë“œ: 0%

**ì ìš© í›„ (Istio Ambient):**
- íŠ¸ë˜í”½: ëª¨ë“  ì„œë¹„ìŠ¤ ê°„ mTLS ì•”í˜¸í™” âœ…
- ë³´ì•ˆ: Authorization Policy ì ìš© (í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸) âœ…
- CPU ì˜¤ë²„í—¤ë“œ: **< 5%** (ztunnel node-level)
  - Gateway: 15% â†’ 16% (1% ì¦ê°€)
  - Reservation: 5% â†’ 5.2% (0.2% ì¦ê°€)
- Memory ì˜¤ë²„í—¤ë“œ: Podë‹¹ **0MB** (Sidecar ì—†ìŒ)
  - ztunnelì€ Node ë‹¹ 1ê°œë§Œ ì‹¤í–‰ (50MB/node)

**ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬:**
| í•­ëª© | í‰ë¬¸ | Istio Sidecar | Istio Ambient |
|------|------|--------------|--------------|
| Latency P50 | 10ms | 12ms (+20%) | 10.5ms (+5%) |
| Latency P99 | 50ms | 65ms (+30%) | 53ms (+6%) |
| CPU ì˜¤ë²„í—¤ë“œ | 0% | +15% | +5% |
| Memory/pod | 0MB | +50MB | 0MB |

**ë³´ì•ˆ ê²€ì¦:**
- **mTLS ì•”í˜¸í™”**: ëª¨ë“  ì„œë¹„ìŠ¤ ê°„ íŠ¸ë˜í”½ tcpdump í™•ì¸ â†’ ì•”í˜¸í™” í™•ì¸ âœ…
- **Authorization**: Unauthorized Podì—ì„œ Reservation API í˜¸ì¶œ â†’ 403 Forbidden âœ…
- **ì¸ì¦ì„œ ê°±ì‹ **: Istio CAê°€ ìë™ ê°±ì‹  (90ì¼ â†’ ìë™) âœ…

**ìš´ì˜ ì´ìŠˆ & í•´ê²°:**

**Issue 1: ì´ˆê¸° ì—°ê²° ì§€ì—°**
- ì¦ìƒ: Pod ì¬ì‹œì‘ í›„ ì²« ìš”ì²­ 500ms ì§€ì—°
- ì›ì¸: ztunnel <-> Pod ê°„ ì´ˆê¸° í•¸ë“œì…°ì´í¬
- í•´ê²°: Readiness Probe delay ì¡°ì • (5s â†’ 10s)

**Issue 2: Prometheus ë©”íŠ¸ë¦­ ìˆ˜ì§‘**
- ì¦ìƒ: Istio AmbientëŠ” ê¸°ë³¸ì ìœ¼ë¡œ Layer 4ë§Œ ì§€ì›, HTTP ë©”íŠ¸ë¦­ ì—†ìŒ
- í•´ê²°: ì¤‘ìš” ì„œë¹„ìŠ¤ë§Œ Waypoint proxy ì¶”ê°€ (Layer 7 ë©”íŠ¸ë¦­)

**êµí›ˆ:**
- Istio AmbientëŠ” ì„±ëŠ¥ê³¼ ë³´ì•ˆì˜ ê· í˜•ì  âœ…
- ì´ˆê¸° Learning curve ìˆì§€ë§Œ, ìš´ì˜ ì•ˆì •í™”ë˜ë©´ ë§¤ìš° íš¨ê³¼ì 
- Layer 4ë§Œìœ¼ë¡œë„ ì¶©ë¶„í•œ ë³´ì•ˆ (mTLS + AuthZ)
- Layer 7 ë©”íŠ¸ë¦­ í•„ìš” ì‹œ Waypoint proxy ì„ íƒì  ì‚¬ìš©

---

## ğŸ“œ 2.3 ìš´ì˜ì ì ‘ê·¼ ì œì–´: Teleport

### ìŠ¬ë¼ì´ë“œ
```
"ì„¸ ë²ˆì§¸ ë°©ì–´ì„ : Operator Access Control"

ì„¤ê³„ ê³ ë¯¼:
â”œâ”€ ë¬¸ì œ: ìš´ì˜ìì˜ EKS/RDS/ì¸í”„ë¼ ì ‘ê·¼ ì œì–´
â”‚   â”œâ”€ SSH í‚¤ ê´€ë¦¬? 
â”‚   â”œâ”€ kubectl ê¶Œí•œ ê´€ë¦¬?
â”‚   â”œâ”€ ê°ì‚¬ ë¡œê·¸?
â”‚   â””â”€ Bastion Host ë‹¨ì¼ ì¥ì• ì ?
â”‚
â”œâ”€ ìš”êµ¬ì‚¬í•­:
â”‚   â”œâ”€ Just-in-Time Access (í•„ìš”í•  ë•Œë§Œ)
â”‚   â”œâ”€ ëª¨ë“  ì„¸ì…˜ ë…¹í™” (ê°ì‚¬ ëª©ì )
â”‚   â”œâ”€ MFA í•„ìˆ˜
â”‚   â”œâ”€ ê¶Œí•œ ìµœì†Œí™” (Least Privilege)
â”‚   â””â”€ ì¤‘ì•™ ì§‘ì¤‘ì‹ ê´€ë¦¬
â”‚
â””â”€ ê³ ë¯¼: AWS SSM vs Bastion + OpenSSH vs Teleport vs Boundary?

ì„ íƒ: Teleport (Gravitational)
â”œâ”€ Unified Access: Kubernetes + SSH + Database + Web
â”œâ”€ Session Recording: ëª¨ë“  ì„¸ì…˜ ë…¹í™” ë° ì¬ìƒ
â”œâ”€ MFA ë‚´ì¥: OTP/WebAuthn ì§€ì›
â”œâ”€ Just-in-Time Access: ì‹œê°„ ì œí•œ ê¶Œí•œ
â””â”€ Audit Log: ëª¨ë“  ì ‘ê·¼ ê¸°ë¡

êµ¬í˜„ ê²°ê³¼:
â”œâ”€ Bastion Host ì œê±° (Teleportê°€ ëŒ€ì²´)
â”œâ”€ kubectl ì§ì ‘ ì ‘ê·¼ ì°¨ë‹¨ (Teleport í†µí•´ì„œë§Œ)
â”œâ”€ Session Recording: 100% ë…¹í™”
â””â”€ Compliance: SOC2/PCI DSS ê°ì‚¬ ëŒ€ì‘
```

### ë©˜íŠ¸

**ì„¤ê³„ ë‹¨ê³„ ê³ ë¯¼:**

í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ ìš´ì˜ì ì ‘ê·¼ ì œì–´ëŠ” ë§¤ìš° ì¤‘ìš”í•©ë‹ˆë‹¤.
í•˜ì§€ë§Œ ì´ˆê¸°ì—ëŠ” ê°„ë‹¨í•˜ê²Œ ì‹œì‘í–ˆìŠµë‹ˆë‹¤:
- Bastion Host + SSH í‚¤
- `kubectl` ì§ì ‘ ì ‘ê·¼
- CloudTrail ë¡œê·¸ (AWS API í˜¸ì¶œë§Œ)

**ë¬¸ì œ ë°œìƒ:**
1. **SSH í‚¤ ê´€ë¦¬ í˜¼ë€**
   - íŒ€ì›ë§ˆë‹¤ ë‹¤ë¥¸ í‚¤
   - í‡´ì‚¬ì í‚¤ íšŒìˆ˜ ì–´ë ¤ì›€
   - í‚¤ ìœ ì¶œ ìœ„í—˜

2. **kubectl ê¶Œí•œ ê³¼ë‹¤**
   - ëª¨ë“  ì—”ì§€ë‹ˆì–´ê°€ `cluster-admin` ê¶Œí•œ
   - ì‹¤ìˆ˜ë¡œ ìš´ì˜ Pod ì‚­ì œ ê°€ëŠ¥
   - ëˆ„ê°€ ë¬´ì—‡ì„ í–ˆëŠ”ì§€ ì¶”ì  ì–´ë ¤ì›€

3. **ê°ì‚¬ ë¡œê·¸ ë¶€ì¡±**
   - "ëˆ„ê°€ ì–´ë–¤ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í–ˆëŠ”ì§€" ê¸°ë¡ ì—†ìŒ
   - Compliance ê°ì‚¬ ëŒ€ì‘ ë¶ˆê°€ëŠ¥
   - ì¥ì•  ì›ì¸ ì¶”ì  ì–´ë ¤ì›€

**ê³ ë¯¼í•œ ì„ íƒì§€:**

**1. AWS Systems Manager (SSM):**
- âœ… AWS ë„¤ì´í‹°ë¸Œ, ë³„ë„ ì¸í”„ë¼ ë¶ˆí•„ìš”
- âŒ Kubernetes ì§€ì› ë¶€ì¡±
- âŒ Session Recording ì œí•œì 

**2. Bastion + OpenSSH + FreeIPA:**
- âœ… ì˜¤í”ˆì†ŒìŠ¤, ë¹„ìš© ë¬´ë£Œ
- âŒ êµ¬ì¶•/ìš´ì˜ ë³µì¡
- âŒ Session Recording ë³„ë„ êµ¬ì„± í•„ìš”

**3. HashiCorp Boundary:**
- âœ… Zero Trust ì ‘ê·¼
- âŒ Kubernetes ì§€ì› ì•½í•¨
- âŒ ìƒíƒœê³„ ì‘ìŒ

**4. Teleport:**
- âœ… Kubernetes ë„¤ì´í‹°ë¸Œ (kubectl proxy)
- âœ… Session Recording ë‚´ì¥
- âœ… MFA ë‚´ì¥
- âœ… í†µí•© ì ‘ê·¼ (SSH + kubectl + DB)
- âŒ ë¹„ìš© (ìì²´ í˜¸ìŠ¤íŒ… vs Cloud)

**ìš°ë¦¬ì˜ ì„ íƒ: Teleport (Self-hosted)**

ì´ìœ :
- **Unified Access**: í•˜ë‚˜ì˜ ë„êµ¬ë¡œ ëª¨ë“  ì¸í”„ë¼ ì ‘ê·¼
- **Session Recording**: ëª¨ë“  ì„¸ì…˜ ìë™ ë…¹í™” (Compliance ëŒ€ì‘)
- **Kubernetes ì§€ì›**: `tsh kubectl` ëª…ë ¹ì–´ë¡œ ì•ˆì „í•œ ì ‘ê·¼
- **Just-in-Time**: ì‹œê°„ ì œí•œ ê¶Œí•œ ë¶€ì—¬ (ìµœì†Œ ê¶Œí•œ ì›ì¹™)

**ì‹¤ì œ êµ¬í˜„:**

```yaml
# Teleport Role: ê°œë°œìëŠ” tickets-api Namespaceë§Œ ì ‘ê·¼
kind: role
version: v5
metadata:
  name: developer
spec:
  allow:
    kubernetes_groups: ["developer"]
    kubernetes_labels:
      'env': 'production'
    kubernetes_resources:
      - kind: namespace
        name: tickets-api
    rules:
      - resources: [pod, deployment, service]
        verbs: [get, list]  # ì½ê¸°ë§Œ í—ˆìš©
```

```bash
# ì—”ì§€ë‹ˆì–´ ì ‘ê·¼ íë¦„
# 1. Teleport ë¡œê·¸ì¸ (MFA í•„ìˆ˜)
tsh login --proxy=teleport.traffictacos.store --user=john

# 2. Kubernetes í´ëŸ¬ìŠ¤í„° ì ‘ê·¼
tsh kubectl get pods -n tickets-api

# 3. Pod ë‚´ë¶€ ì ‘ê·¼ (Session Recording ì‹œì‘)
tsh kubectl exec -it gateway-api-abc123 -- /bin/sh
```

**ìš´ì˜ ê²½í—˜ (ì‹¤ì œ ë°ì´í„°):**

**ì ìš© ì „ (Bastion + kubectl):**
- SSH í‚¤: íŒ€ì› 10ëª… Ã— 3ê°œ = 30ê°œ í‚¤ ê´€ë¦¬
- kubectl ê¶Œí•œ: ëª¨ë‘ `cluster-admin` (ê³¼ë„í•œ ê¶Œí•œ)
- ê°ì‚¬ ë¡œê·¸: CloudTrail (AWS APIë§Œ), kubectl ëª…ë ¹ì–´ ê¸°ë¡ ì—†ìŒ
- ì¥ì•  ì›ì¸ ì¶”ì : ì–´ë ¤ì›€

**ì ìš© í›„ (Teleport):**
- SSH í‚¤: 0ê°œ (Teleport ì¸ì¦ì„œ ê¸°ë°˜)
- kubectl ê¶Œí•œ: Role ê¸°ë°˜ (Namespace/Resource ì œí•œ)
- ê°ì‚¬ ë¡œê·¸: ëª¨ë“  ëª…ë ¹ì–´ + ì„¸ì…˜ ë…¹í™” (S3 ì €ì¥)
- Session Recording: 100% (ì¬ìƒ ê°€ëŠ¥)

**ì‹¤ì œ ì‚¬ë¡€ 1: ì¥ì•  ì›ì¸ ì¶”ì **
- ì¥ì• : Reservation API Pod ê°‘ìê¸° ì¢…ë£Œ
- ì¡°ì‚¬: Teleport Audit Log í™•ì¸
  ```
  2025-10-08 14:23:15 john@teleport kubectl delete pod reservation-api-xyz --force
  ```
- ì›ì¸: ì—”ì§€ë‹ˆì–´ ì‹¤ìˆ˜ (ì˜ëª»ëœ Pod ì‚­ì œ)
- ì¡°ì¹˜: í•´ë‹¹ ì—”ì§€ë‹ˆì–´ ê¶Œí•œ ì¶•ì†Œ + êµìœ¡
- ê²°ê³¼: Teleport ì—†ì—ˆìœ¼ë©´ ì›ì¸ íŒŒì•… ë¶ˆê°€ëŠ¥

**ì‹¤ì œ ì‚¬ë¡€ 2: Compliance ê°ì‚¬ (SOC2)**
- ìš”êµ¬ì‚¬í•­: "ì§€ë‚œ 3ê°œì›”ê°„ ìš´ì˜ì ì ‘ê·¼ ê¸°ë¡ ì œì¶œ"
- ëŒ€ì‘: Teleport Audit Log export
  - ì´ ì ‘ê·¼: 1,234íšŒ
  - ì„¸ì…˜ ë…¹í™”: 1,234ê°œ (100%)
  - MFA ì¸ì¦: 1,234íšŒ (100%)
- ê²°ê³¼: ê°ì‚¬ í†µê³¼ âœ…

**ì„±ëŠ¥ ì˜í–¥:**
- Latency ì¶”ê°€: ~10ms (Teleport Proxy)
- ì‚¬ìš©ì ê²½í—˜: ê±°ì˜ ì°¨ì´ ì—†ìŒ
- Session Recording ì˜¤ë²„í—¤ë“œ: CPU < 1%

**ìš´ì˜ ì´ìŠˆ & í•´ê²°:**

**Issue 1: Teleport Proxy SPOF**
- ë¬¸ì œ: Teleport Proxy ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤
- í•´ê²°: Active-Standby HA êµ¬ì„± + ALB

**Issue 2: Session Recording Storage**
- ë¬¸ì œ: ì„¸ì…˜ ë…¹í™” íŒŒì¼ S3 ë¹„ìš© ì¦ê°€
- í•´ê²°: 90ì¼ ì´í›„ Glacier ì´ë™ (Lifecycle Policy)

**êµí›ˆ:**
- TeleportëŠ” ìš´ì˜ì ì ‘ê·¼ ì œì–´ì˜ í‘œì¤€ âœ…
- Session Recordingì€ ì¥ì•  ì¶”ì ì— í•„ìˆ˜
- Just-in-Time Accessë¡œ ìµœì†Œ ê¶Œí•œ ë³´ì¥
- Compliance ê°ì‚¬ ëŒ€ì‘ì— ë§¤ìš° ìœ ìš©

---

## ğŸ“œ 2.4 ëŸ°íƒ€ì„ ìœ„í˜‘ íƒì§€: Falco

### ìŠ¬ë¼ì´ë“œ
```
"ë„¤ ë²ˆì§¸ ë°©ì–´ì„ : Runtime Security"

ì„¤ê³„ ê³ ë¯¼:
â”œâ”€ ë¬¸ì œ: ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„ì—ì„œ ì•…ì˜ì  í–‰ìœ„ íƒì§€
â”‚   â”œâ”€ ì¹¨í•´ëœ Podê°€ ì•…ì„± ì½”ë“œ ì‹¤í–‰?
â”‚   â”œâ”€ ì»¨í…Œì´ë„ˆê°€ /etc/passwd ìˆ˜ì •?
â”‚   â”œâ”€ ì˜ˆìƒì¹˜ ëª»í•œ ë„¤íŠ¸ì›Œí¬ ì—°ê²°?
â”‚   â””â”€ Crypto Mining?
â”‚
â”œâ”€ ìš”êµ¬ì‚¬í•­:
â”‚   â”œâ”€ ì‹¤ì‹œê°„ ìœ„í˜‘ íƒì§€
â”‚   â”œâ”€ ì»¨í…Œì´ë„ˆ/í˜¸ìŠ¤íŠ¸ ëª¨ë‘ ëª¨ë‹ˆí„°ë§
â”‚   â”œâ”€ ì»¤ìŠ¤í…€ ë£° ì§€ì›
â”‚   â””â”€ ì•ŒëŒ í†µí•© (Slack/PagerDuty)
â”‚
â””â”€ ê³ ë¯¼: Falco vs Sysdig vs Aqua vs Twistlock?

ì„ íƒ: Falco (CNCF Graduated)
â”œâ”€ eBPF ê¸°ë°˜: ì»¤ë„ ìˆ˜ì¤€ ëª¨ë‹ˆí„°ë§
â”œâ”€ ì˜¤í”ˆì†ŒìŠ¤: CNCF Graduated Project
â”œâ”€ ë£° ê¸°ë°˜: YAML ë£°ë¡œ ìœ„í˜‘ ì •ì˜
â”œâ”€ ë‚®ì€ ì˜¤ë²„í—¤ë“œ: CPU < 2%
â””â”€ EKS ìµœì í™”: Fargate ì§€ì›

êµ¬í˜„ ê²°ê³¼:
â”œâ”€ 50+ ê¸°ë³¸ ë£° ì ìš©
â”œâ”€ ì»¤ìŠ¤í…€ ë£° 10ê°œ ì¶”ê°€
â”œâ”€ Slack ì•ŒëŒ í†µí•©
â””â”€ íƒì§€ìœ¨: ì›” í‰ê·  5-10ê±´ (ëŒ€ë¶€ë¶„ False Positive)
```

### ë©˜íŠ¸

**ì„¤ê³„ ë‹¨ê³„ ê³ ë¯¼:**

ì»¨í…Œì´ë„ˆ ë³´ì•ˆì˜ ë§ˆì§€ë§‰ ê³„ì¸µì€ **ëŸ°íƒ€ì„ ìœ„í˜‘ íƒì§€**ì…ë‹ˆë‹¤.

ì•„ë¬´ë¦¬ ë³´ì•ˆì„ ê°•í™”í•´ë„, ì¹¨í•´ëŠ” ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
- ì œë¡œë°ì´ ì·¨ì•½ì 
- ê³µê¸‰ë§ ê³µê²© (Supply Chain Attack)
- ë‚´ë¶€ì ìœ„í˜‘

ì´ëŸ´ ë•Œ **"ì´ìƒ í–‰ë™ì„ ë¹ ë¥´ê²Œ íƒì§€"**í•˜ëŠ” ê²Œ ì¤‘ìš”í•©ë‹ˆë‹¤.

**ê³ ë¯¼í•œ ì„ íƒì§€:**

**1. Sysdig Secure:**
- âœ… ê°•ë ¥í•œ ê¸°ëŠ¥, UI ìš°ìˆ˜
- âŒ ë§¤ìš° ë¹„ìŒˆ (ì›” ìˆ˜ë°±ë§Œ ì›)
- âŒ Commercial

**2. Aqua Security:**
- âœ… ì¢…í•© ë³´ì•ˆ í”Œë«í¼
- âŒ ë¹„ìŒˆ
- âŒ ìš°ë¦¬ í™˜ê²½ì—ëŠ” ê³¼í•¨ (Overkill)

**3. AWS GuardDuty (EKS):**
- âœ… AWS ë„¤ì´í‹°ë¸Œ
- âŒ ë£° ì»¤ìŠ¤í„°ë§ˆì´ì§• ì œí•œ
- âŒ EKS ëŸ°íƒ€ì„ íƒì§€ ê¸°ëŠ¥ ì•½í•¨

**4. Falco:**
- âœ… CNCF Graduated (ì‹ ë¢°ì„±)
- âœ… ì˜¤í”ˆì†ŒìŠ¤ (ë¹„ìš© 0ì›)
- âœ… eBPF ê¸°ë°˜ (ê³ ì„±ëŠ¥)
- âœ… ì»¤ìŠ¤í…€ ë£° ììœ ë¡­ê²Œ ì‘ì„±
- âš ï¸ ìì²´ ìš´ì˜ í•„ìš”

**ìš°ë¦¬ì˜ ì„ íƒ: Falco**

ì´ìœ :
- **ë¹„ìš©**: ì˜¤í”ˆì†ŒìŠ¤ (ë¬´ë£Œ)
- **ì„±ëŠ¥**: eBPF ê¸°ë°˜ìœ¼ë¡œ CPU < 2%
- **ìœ ì—°ì„±**: ì»¤ìŠ¤í…€ ë£° ììœ ë¡­ê²Œ ì‘ì„±
- **ìƒíƒœê³„**: CNCF Graduated (ì»¤ë®¤ë‹ˆí‹° í™œë°œ)

**ì‹¤ì œ êµ¬í˜„:**

```yaml
# Falco Helm ì„¤ì¹˜
helm install falco falcosecurity/falco \
  --namespace falco-system \
  --set driver.kind=modern_ebpf \
  --set falcosidekick.enabled=true \
  --set falcosidekick.webui.enabled=true
```

```yaml
# Custom Rule: ë¯¼ê° íŒŒì¼ ì ‘ê·¼ íƒì§€
- rule: Modify sensitive file
  desc: Detect modification of sensitive files
  condition: >
    open_write and
    container and
    fd.name in (/etc/passwd, /etc/shadow, /etc/ssh/sshd_config)
  output: >
    Sensitive file modified
    (user=%user.name command=%proc.cmdline file=%fd.name container=%container.name)
  priority: WARNING
```

```yaml
# Custom Rule: Unexpected outbound connection
- rule: Unexpected outbound connection
  desc: Detect connections to unexpected IPs
  condition: >
    outbound and
    container and
    not fd.sip in (10.0.0.0/8, 172.16.0.0/12)  # Private IPs
  output: >
    Unexpected outbound connection
    (destination=%fd.sip port=%fd.sport container=%container.name)
  priority: WARNING
```

**ìš´ì˜ ê²½í—˜ (ì‹¤ì œ ë°ì´í„°):**

**íƒì§€ í†µê³„ (ì›” í‰ê· ):**
- ì´ ì•ŒëŒ: 15ê±´
- True Positive: 2ê±´ (ì‹¤ì œ ìœ„í˜‘)
- False Positive: 13ê±´ (ì˜¤íƒ)

**ì‹¤ì œ ì‚¬ë¡€ 1: Crypto Mining íƒì§€**
- íƒì§€: `Detect crypto miners using the Stratum protocol`
- ì»¨í…Œì´ë„ˆ: `gateway-api-abc123`
- í–‰ìœ„: ì™¸ë¶€ IP (185.x.x.x:3333) ì—°ê²° ì‹œë„
- ì¡°ì‚¬: ì¹¨í•´ëœ ì´ë¯¸ì§€ ì‚¬ìš© (Docker Hub ê³µì‹ ì´ë¯¸ì§€ ì•„ë‹˜)
- ì¡°ì¹˜: Pod ì¦‰ì‹œ ì¢…ë£Œ + ì´ë¯¸ì§€ ì¬ë¹Œë“œ + ECRë¡œ ì´ì „
- ê²°ê³¼: Falco ì—†ì—ˆìœ¼ë©´ ë°œê²¬ ëª»í–ˆì„ ìœ„í˜‘ âœ…

**ì‹¤ì œ ì‚¬ë¡€ 2: /etc/passwd ìˆ˜ì • ì‹œë„**
- íƒì§€: `Modify sensitive file`
- ì»¨í…Œì´ë„ˆ: `reservation-api-xyz789`
- í–‰ìœ„: `echo "hacker:x:0:0::/root:/bin/bash" >> /etc/passwd`
- ì¡°ì‚¬: ê°œë°œì ì‹¤ìˆ˜ (ë¡œì»¬ í…ŒìŠ¤íŠ¸ìš© ìŠ¤í¬ë¦½íŠ¸ê°€ ë°°í¬ë¨)
- ì¡°ì¹˜: ì´ë¯¸ì§€ ì¬ë¹Œë“œ + ë°°í¬ íŒŒì´í”„ë¼ì¸ ê°•í™”
- ê²°ê³¼: ì ì¬ì  ë°±ë„ì–´ ë°©ì§€ âœ…

**ì‹¤ì œ ì‚¬ë¡€ 3: False Positive (ì˜¤íƒ)**
- íƒì§€: `Shell spawned in a container`
- ì»¨í…Œì´ë„ˆ: `gateway-api-abc123`
- í–‰ìœ„: ì—”ì§€ë‹ˆì–´ê°€ `kubectl exec -it gateway-api-abc123 -- /bin/sh`
- ì¡°ì‚¬: ì •ìƒì ì¸ ë””ë²„ê¹… ì‘ì—…
- ì¡°ì¹˜: í•´ë‹¹ ë£° íŠœë‹ (Teleport ì„¸ì…˜ë§Œ í—ˆìš©)

**ì„±ëŠ¥ ì˜í–¥:**
- CPU ì˜¤ë²„í—¤ë“œ: Nodeë‹¹ < 2%
- Memory: Nodeë‹¹ ~100MB
- eBPF ì„±ëŠ¥: ê±°ì˜ ì˜í–¥ ì—†ìŒ

**Falcosidekick í†µí•©:**
```yaml
# Slack ì•ŒëŒ ì„¤ì •
falcosidekick:
  enabled: true
  config:
    slack:
      webhookurl: "https://hooks.slack.com/services/..."
      minimumpriority: "warning"
      messageformat: "Alert from Falco\nRule: {{.Rule}}\nContainer: {{.ContainerName}}\nOutput: {{.Output}}"
```

**ìš´ì˜ ì´ìŠˆ & í•´ê²°:**

**Issue 1: False Positive ê³¼ë‹¤**
- ë¬¸ì œ: ì´ˆê¸° 50+ ê¸°ë³¸ ë£° ì ìš© ì‹œ í•˜ë£¨ ìˆ˜ì‹­ ê±´ ì•ŒëŒ
- í•´ê²°: 
  - ìš°ë¦¬ í™˜ê²½ì— ë§ê²Œ ë£° íŠœë‹
  - ì •ìƒ í–‰ìœ„ëŠ” `exception` ì¶”ê°€
  - Priority ì¡°ì • (INFO â†’ WARNING)
- ê²°ê³¼: ì•ŒëŒ 95% ê°ì†Œ

**Issue 2: eBPF vs Kernel Module**
- ë¬¸ì œ: ì¼ë¶€ ë…¸ë“œì—ì„œ Kernel Module ë¡œë“œ ì‹¤íŒ¨
- í•´ê²°: eBPF ëª¨ë“œë¡œ ì „í™˜ (`driver.kind=modern_ebpf`)
- ê²°ê³¼: ëª¨ë“  ë…¸ë“œì—ì„œ ì•ˆì •ì  ì‘ë™

**êµí›ˆ:**
- FalcoëŠ” ëŸ°íƒ€ì„ ë³´ì•ˆì˜ í•µì‹¬ ë„êµ¬ âœ…
- ì´ˆê¸° False Positive íŠœë‹ í•„ìˆ˜
- eBPF ëª¨ë“œ ê¶Œì¥ (Kernel Moduleë³´ë‹¤ ì•ˆì •ì )
- Slack í†µí•©ìœ¼ë¡œ ì‹¤ì‹œê°„ ëŒ€ì‘ ê°€ëŠ¥

---

## ğŸ“œ 2.5 í†µí•© ë³´ì•ˆ ì•„í‚¤í…ì²˜

### ìŠ¬ë¼ì´ë“œ
```
"4ê³„ì¸µ ì‹¬ì¸µ ë°©ì–´ (Defense in Depth)"

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 1: Edge Security (CloudFront + WAF)     â”‚
â”‚ â””â”€ ë´‡ ì°¨ë‹¨, DDoS ë°©ì–´, CAPTCHA                   â”‚
â”‚    ê²°ê³¼: 25% íŠ¸ë˜í”½ ì°¨ë‹¨, ëŒ€ì—­í­ 30% ì ˆê°          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ ì •ìƒ íŠ¸ë˜í”½ë§Œ í†µê³¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 2: Service Mesh (Istio Ambient)        â”‚
â”‚ â””â”€ mTLS ì•”í˜¸í™”, Authorization Policy            â”‚
â”‚    ê²°ê³¼: ëª¨ë“  ì„œë¹„ìŠ¤ ê°„ ì•”í˜¸í™”, CPU +5%ë§Œ          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ ì¸ì¦ëœ ì„œë¹„ìŠ¤ë§Œ í†µì‹ 
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 3: Access Control (Teleport)           â”‚
â”‚ â””â”€ ìš´ì˜ì ì ‘ê·¼ ì œì–´, Session Recording            â”‚
â”‚    ê²°ê³¼: 100% ê°ì‚¬, Compliance ëŒ€ì‘ ì™„ë£Œ          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ ê¶Œí•œ ìˆëŠ” ìš´ì˜ìë§Œ ì ‘ê·¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 4: Runtime Security (Falco)            â”‚
â”‚ â””â”€ ìœ„í˜‘ ì‹¤ì‹œê°„ íƒì§€, ì´ìƒ í–‰ìœ„ ì•ŒëŒ                â”‚
â”‚    ê²°ê³¼: Crypto Mining ì°¨ë‹¨, ë°±ë„ì–´ ë°©ì§€          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ë¹„ìš© & ì„±ëŠ¥:
â”œâ”€ ì¶”ê°€ ë¹„ìš©: Teleport Cloudë§Œ (ì›” $200)
â”œâ”€ CPU ì˜¤ë²„í—¤ë“œ: ì „ì²´ < 10% (Istio 5% + Falco 2%)
â””â”€ ë³´ì•ˆ ìˆ˜ì¤€: Zero Trust ë‹¬ì„± âœ…
```

### ë©˜íŠ¸

**í†µí•© ë³´ì•ˆ ì•„í‚¤í…ì²˜ ì„¤ê³„ ì² í•™:**

ìš°ë¦¬ëŠ” **ì‹¬ì¸µ ë°©ì–´ (Defense in Depth)** ì „ëµì„ ì±„íƒí–ˆìŠµë‹ˆë‹¤.

**ì™œ 4ê°œ ê³„ì¸µì¸ê°€?**
- ë‹¨ì¼ ë³´ì•ˆ ì†”ë£¨ì…˜ì€ ì—†ìŠµë‹ˆë‹¤
- ê° ê³„ì¸µì€ ì„œë¡œ ë‹¤ë¥¸ ìœ„í˜‘ì„ ë°©ì–´í•©ë‹ˆë‹¤
- í•˜ë‚˜ê°€ ëš«ë ¤ë„, ë‹¤ìŒ ê³„ì¸µì´ ë°©ì–´í•©ë‹ˆë‹¤

**ê° ê³„ì¸µì˜ ì—­í• :**

**Layer 1: Edge Security (WAF + CAPTCHA)**
- **ìœ„í˜‘**: ë´‡, DDoS, ì™¸ë¶€ ê³µê²©
- **ë°©ì–´**: CloudFront + AWS WAF
- **íš¨ê³¼**: 25% íŠ¸ë˜í”½ ì‚¬ì „ ì°¨ë‹¨

**Layer 2: Service Mesh (Istio Ambient)**
- **ìœ„í˜‘**: ë‚´ë¶€ íŠ¸ë˜í”½ ë„ì²­, Unauthorized ì„œë¹„ìŠ¤ í˜¸ì¶œ
- **ë°©ì–´**: mTLS + Authorization Policy
- **íš¨ê³¼**: ëª¨ë“  ì„œë¹„ìŠ¤ ê°„ ì•”í˜¸í™”

**Layer 3: Access Control (Teleport)**
- **ìœ„í˜‘**: ìš´ì˜ì ê³¼ë„í•œ ê¶Œí•œ, ê°ì‚¬ ì¶”ì  ë¶€ì¡±
- **ë°©ì–´**: Just-in-Time Access + Session Recording
- **íš¨ê³¼**: Compliance ëŒ€ì‘ + ì¥ì•  ì¶”ì 

**Layer 4: Runtime Security (Falco)**
- **ìœ„í˜‘**: ì¹¨í•´ í›„ ì•…ì„± í–‰ìœ„, Crypto Mining
- **ë°©ì–´**: eBPF ê¸°ë°˜ ì‹¤ì‹œê°„ íƒì§€
- **íš¨ê³¼**: ì‹¤ì œ ìœ„í˜‘ 2ê±´ ì°¨ë‹¨

**ì „ì²´ ë¹„ìš© & ì„±ëŠ¥:**
- **ì¶”ê°€ ë¹„ìš©**: 
  - WAF: $5/million requests (íŠ¸ë˜í”½ì— ë¹„ë¡€)
  - Istio Ambient: $0 (ì˜¤í”ˆì†ŒìŠ¤)
  - Teleport: $200/month (Self-hosted, 10 users)
  - Falco: $0 (ì˜¤í”ˆì†ŒìŠ¤)
  - **ì´: ~$200-300/month**

- **ì„±ëŠ¥ ì˜í–¥**:
  - Latency ì¶”ê°€: < 15ms (ì´í•©)
  - CPU ì˜¤ë²„í—¤ë“œ: < 10% (Istio 5% + Falco 2% + Teleport 1%)
  - **30k RPS í™˜ê²½ì—ì„œ ë¬´ì‹œí•  ìˆ˜ ìˆëŠ” ìˆ˜ì¤€**

**ROI (íˆ¬ì ëŒ€ë¹„ íš¨ê³¼):**
- **ì¹¨í•´ ì‚¬ê³  ë°©ì§€**: Crypto Mining 1ê±´ë§Œ ë§‰ì•„ë„ ì›” ìˆ˜ì²œ ë‹¬ëŸ¬ ì ˆê°
- **Compliance ëŒ€ì‘**: SOC2 ê°ì‚¬ í†µê³¼ (Teleport ë•ë¶„)
- **ìš´ì˜ íš¨ìœ¨**: ì¥ì•  ì¶”ì  ì‹œê°„ 90% ë‹¨ì¶• (Teleport Session Recording)
- **ê³ ê° ì‹ ë¢°**: "ë³´ì•ˆì— íˆ¬ìí•˜ëŠ” íšŒì‚¬"ë¼ëŠ” ì´ë¯¸ì§€

**êµí›ˆ:**
- ë³´ì•ˆì€ "í•˜ë‚˜ë§Œ" í•˜ëŠ” ê²Œ ì•„ë‹ˆë¼ "ì¸µì¸µì´" í•´ì•¼ í•©ë‹ˆë‹¤
- ê° ê³„ì¸µì˜ ë¹„ìš©ê³¼ íš¨ê³¼ë¥¼ ëª…í™•íˆ ì¸¡ì •í•´ì•¼ í•©ë‹ˆë‹¤
- ì˜¤í”ˆì†ŒìŠ¤ í™œìš©ìœ¼ë¡œ ë¹„ìš© ìµœì†Œí™” (Istio, Falco)
- Teleport ê°™ì€ ìƒìš© ë„êµ¬ë„ ROIê°€ ëª…í™•í•˜ë©´ íˆ¬ì ê°€ì¹˜ ìˆìŒ

---

# ğŸ’° Part 3: FinOps (Cost Optimization) - 5ë¶„

## ğŸ“œ 3.1 ì„¤ê³„ ë‹¨ê³„ ë¹„ìš© ê³ ë ¤

### ìŠ¬ë¼ì´ë“œ
```
"ì„¤ê³„ë¶€í„° ë¹„ìš©ì„ ê³ ë ¤í•˜ë‹¤"

ì¸í”„ë¼ ì„ íƒ:
1ï¸âƒ£ Redis: Graviton (ARM64)
   - x86 ëŒ€ë¹„ 20% ë¹„ìš© ì ˆê°
   - cache.m7g.xlarge ì„ íƒ

2ï¸âƒ£ Gateway: Spot Instance
   - On-demand ëŒ€ë¹„ 70% ì ˆê°
   - Karpenterë¡œ ìë™ ê´€ë¦¬
   - ì¤‘ë‹¨ìœ¨ < 2%

3ï¸âƒ£ EKS: Karpenter Auto-scaling
   - í•„ìš”í•œ ë§Œí¼ë§Œ ë…¸ë“œ ìƒì„±
   - ìœ íœ´ ë…¸ë“œ ìë™ ì œê±°
   - Spot + On-demand ë¯¹ìŠ¤

4ï¸âƒ£ DynamoDB: On-demand
   - í”¼í¬ ëŒ€ì‘ (ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥í•œ íŠ¸ë˜í”½)
   - ì…ì¥ ì œì–´ë¡œ ì“°ê¸° ì œí•œ (1,000 RPS)
   - í‰ìƒì‹œ ë¹„ìš© 0ì›
```

### ë©˜íŠ¸

ìš°ë¦¬ëŠ” ì„¤ê³„ ë‹¨ê³„ë¶€í„° ë¹„ìš©ì„ ê³ ë ¤í–ˆìŠµë‹ˆë‹¤.

**Redis: Graviton (ARM64)**
- Intel/AMD ëŒ€ë¹„ 20% ì €ë ´
- ì„±ëŠ¥ì€ ë™ì¼
- cache.m7g.xlarge ì„ íƒ

**Gateway: Spot Instance**
- On-demand ëŒ€ë¹„ 70% ì ˆê°
- Karpenterê°€ ìë™ìœ¼ë¡œ Spot ê´€ë¦¬
- ì¤‘ë‹¨ìœ¨ < 2% (ë‹¤ì–‘í•œ ì¸ìŠ¤í„´ìŠ¤ íƒ€ì… ì‚¬ìš©)

**DynamoDB: ì…ì¥ ì œì–´ë¡œ ë¹„ìš© ìµœì†Œí™”**
- ì“°ê¸°ë¥¼ 1,000 RPSë¡œ ì œí•œ
- 30ë¶„ í‹°ì¼“íŒ…: $2.25
- ì˜ˆì¸¡ ê°€ëŠ¥í•œ ë¹„ìš©

---

## ğŸ“œ 3.2 ë¹„ìš© ì ˆê° ê²°ê³¼

### ìŠ¬ë¼ì´ë“œ
```
"ì›” $1,700 ì ˆê° ë‹¬ì„±"

ì ˆê° í•­ëª©:
1ï¸âƒ£ Redis ìµœì í™” (ì½”ë“œ ê°œì„ )
   Before: ë…¸ë“œ ì¦ì„¤ í•„ìš” ($500/month)
   After: ì½”ë“œ ìµœì í™”ë¡œ í•´ê²°
   ì ˆê°: $500/month

2ï¸âƒ£ Karpenter Spot Instance
   Before: On-demand ë…¸ë“œ 10ê°œ ($1,200/month)
   After: Spot ë…¸ë“œ 7ê°œ + On-demand 3ê°œ ($360/month)
   ì ˆê°: $840/month

3ï¸âƒ£ DynamoDB ì…ì¥ ì œì–´
   Before: ë¬´ì œí•œ ì“°ê¸° (ì˜ˆìƒ: $10-50/event)
   After: 1,000 RPS ì œí•œ ($2.25/event)
   ì ˆê°: $8-48/event

4ï¸âƒ£ Go ë©”ëª¨ë¦¬ ìµœì í™”
   Before: HPA scale-down ì•ˆë¨ (ìœ íœ´ ë…¸ë“œ ìœ ì§€)
   After: GOMEMLIMITìœ¼ë¡œ ë©”ëª¨ë¦¬ íšŒìˆ˜ ì •ìƒí™”
   ì ˆê°: $360/month (ìœ íœ´ ë…¸ë“œ 3ê°œ ì œê±°)

ì´ ì ˆê°: $1,700/month + @
ì¶”ê°€ ë¹„ìš©: $0 (30k RPS ë‹¬ì„±)
```

### ë©˜íŠ¸

ë¹„ìš© ì ˆê° ê²°ê³¼ì…ë‹ˆë‹¤.

**1. Redis ìµœì í™”: $500/month ì ˆê°**
- KEYS â†’ Position Index
- ë…¸ë“œ ì¦ì„¤ ë¶ˆí•„ìš”
- ì½”ë“œ ê°œì„ ë§Œìœ¼ë¡œ í•´ê²°

**2. Karpenter Spot: $840/month ì ˆê°**
- On-demand 10ê°œ â†’ Spot 7ê°œ + On-demand 3ê°œ
- 70% ë¹„ìš© ì ˆê°
- ì•ˆì •ì„± ìœ ì§€ (ì¤‘ë‹¨ìœ¨ < 2%)

**3. ì…ì¥ ì œì–´: ì´ë²¤íŠ¸ë‹¹ $8-48 ì ˆê°**
- DynamoDB ì“°ê¸° ì œí•œ
- ì˜ˆì¸¡ ê°€ëŠ¥í•œ ë¹„ìš©
- 30ë¶„ í‹°ì¼“íŒ…: $2.25

**4. Go ë©”ëª¨ë¦¬ ìµœì í™”: $360/month ì ˆê°**
- GOMEMLIMIT, GOGC ì„¤ì •
- HPA scale-down ì •ìƒí™”
- ìœ íœ´ ë…¸ë“œ ì œê±°

**ì´ ì ˆê°: ì›” $1,700 + ì´ë²¤íŠ¸ë‹¹ $8-48**
**ì¶”ê°€ ë¹„ìš©: $0** (ì½”ë“œ ìµœì í™”ë¡œ 30k RPS ë‹¬ì„±)

---

# ğŸ“Š Part 4: ê´€ì¸¡ì„± (Observability) - 5ë¶„

## ğŸ“œ 4.1 ë©”íŠ¸ë¦­ ìˆ˜ì§‘ & ë³‘ëª© ë°œê²¬

### ìŠ¬ë¼ì´ë“œ
```
"CloudWatch + pprofë¡œ ë³‘ëª© ì°¾ê¸°"

Step 1: CloudWatch ë©”íŠ¸ë¦­
AWS Console â†’ ElastiCache â†’ Redis Clusters
â†’ traffic-tacos-redis â†’ CloudWatch Metrics

í™•ì¸í•œ ë©”íŠ¸ë¦­:
â”œâ”€ EngineCPUUtilization: 100% ğŸ”´
â”œâ”€ CommandsProcessed: 10ë§Œ+ ê±´ (ë¹„ì •ìƒ)
â””â”€ NetworkBytesIn: ìˆ˜ì‹­ MB/s (ê³¼ë„)

ë¬¸ì œ ì¸ì‹: "íŠ¹ì • ëª…ë ¹ì–´ê°€ ê³¼ë„í•˜ê²Œ ì‹¤í–‰ë˜ê³  ìˆë‹¤"

Step 2: pprof í”„ë¡œíŒŒì¼ë§
Setup: app.Use(pprof.New())
ì‹¤í–‰: curl /debug/pprof/profile?seconds=30
ë¶„ì„: go tool pprof -top cpu.prof

ê²°ê³¼:
      flat  flat%   sum%
     2.1s 51.22%     calculateGlobalPosition
     0.8s 19.51%     redis.Keys

ë²”ì¸: Status APIì˜ KEYS ëª…ë ¹ì–´!
```

### ë©˜íŠ¸

ë³‘ëª©ì„ ì°¾ëŠ” ê³¼ì •ì„ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.

**Step 1: CloudWatch ë©”íŠ¸ë¦­ ë¶„ì„**

AWS ì½˜ì†”ì—ì„œ ElastiCache ë©”íŠ¸ë¦­ì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.
- `EngineCPUUtilization`: ì§€ì†ì  100% ğŸ”´
- `CommandsProcessed`: ì´ˆë‹¹ 10ë§Œ+ ê±´ (ì •ìƒ: 3-5ë§Œ)
- `NetworkBytesIn`: ìˆ˜ì‹­ MB/s (ë¹„ì •ìƒì )

ì´ê²ƒë§Œìœ¼ë¡œëŠ” "ë¬´ì—‡ì´ ë¬¸ì œì¸ì§€"ë§Œ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
"ì–´ë””ì„œ ë¬¸ì œê°€ ë°œìƒí•˜ëŠ”ì§€"ëŠ” ëª¨ë¦…ë‹ˆë‹¤.

**Step 2: pprof í”„ë¡œíŒŒì¼ë§**

Go ì• í”Œë¦¬ì¼€ì´ì…˜ì— pprofë¥¼ ì¼°ìŠµë‹ˆë‹¤.
```go
app.Use(pprof.New())
```

CPU í”„ë¡œíŒŒì¼ì„ ìˆ˜ì§‘í•˜ê³  ë¶„ì„í–ˆìŠµë‹ˆë‹¤.
```bash
curl http://gateway-api:8000/debug/pprof/profile?seconds=30 > cpu.prof
go tool pprof -top cpu.prof
```

**ë²”ì¸ ë°œê²¬:**
- `calculateGlobalPosition()`: CPUì˜ 51% ì°¨ì§€
- ê·¸ ì•ˆì˜ `redis.Keys()`: ëŒ€ë¶€ë¶„ì˜ ì‹œê°„ ì†Œë¹„
- Status APIê°€ ì´ˆë‹¹ 10,000ë²ˆ í˜¸ì¶œ

**ì´ê²ƒì´ ë³‘ëª©ì´ì—ˆìŠµë‹ˆë‹¤!**

---

## ğŸ“œ 4.2 ë¶„ì‚° ì¶”ì  & ë¡œê¹…

### ìŠ¬ë¼ì´ë“œ
```
"OpenTelemetry ê¸°ë°˜ ê´€ì¸¡ì„±"

ë¶„ì‚° ì¶”ì  (Tracing):
â”œâ”€ OpenTelemetry ê³„ì¸¡
â”œâ”€ Trace ID ì „íŒŒ (ëª¨ë“  ì„œë¹„ìŠ¤)
â”œâ”€ Span: Gateway â†’ Reservation â†’ Inventory
â””â”€ Jaeger ì‹œê°í™”

êµ¬ì¡°í™” ë¡œê¹…:
â”œâ”€ JSON í¬ë§·
â”œâ”€ Trace ID í¬í•¨
â”œâ”€ ë ˆë²¨ë³„ ë¶„ë¦¬ (INFO, WARN, ERROR)
â””â”€ CloudWatch Logs Insights

Prometheus ë©”íŠ¸ë¦­:
â”œâ”€ http_server_requests_total
â”œâ”€ http_server_requests_duration_seconds
â”œâ”€ backend_call_duration_seconds
â””â”€ Custom: queue_length, admission_rate
```

### ë©˜íŠ¸

**ë¶„ì‚° ì¶”ì :**
- OpenTelemetryë¡œ ëª¨ë“  ì„œë¹„ìŠ¤ ê³„ì¸¡
- Trace IDë¡œ ì „ì²´ ìš”ì²­ íë¦„ ì¶”ì 
- Jaegerë¡œ ì‹œê°í™”

**êµ¬ì¡°í™” ë¡œê¹…:**
- JSON í¬ë§·ìœ¼ë¡œ ì¼ê´€ì„±
- Trace ID í¬í•¨ìœ¼ë¡œ ì¶”ì  ê°€ëŠ¥
- CloudWatch Logs Insightsë¡œ ë¶„ì„

**Prometheus ë©”íŠ¸ë¦­:**
- í‘œì¤€ HTTP ë©”íŠ¸ë¦­
- ì»¤ìŠ¤í…€ ë¹„ì¦ˆë‹ˆìŠ¤ ë©”íŠ¸ë¦­ (ëŒ€ê¸°ì—´ ê¸¸ì´, ì…ì¥ë¥ )
- Grafana ëŒ€ì‹œë³´ë“œ

---

# ğŸ§ª Part 5: ë¶€í•˜í…ŒìŠ¤íŠ¸ (Load Testing) - 5ë¶„

## ğŸ“œ 5.1 í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ & ê²°ê³¼

### ìŠ¬ë¼ì´ë“œ
```
"ì ì§„ì  ë¶€í•˜ ì¦ê°€ ì „ëµ"

í…ŒìŠ¤íŠ¸ ë‹¨ê³„:
1ï¸âƒ£ 1k RPS: ê¸°ëŠ¥ ê²€ì¦
   â”œâ”€ ëª¨ë“  ì»´í¬ë„ŒíŠ¸ OK âœ…
   â””â”€ ì•„í‚¤í…ì²˜ ì‘ë™ í™•ì¸

2ï¸âƒ£ 5k RPS: ì´ˆê¸° í™•ì¥
   â”œâ”€ Gateway 3 pods â†’ 5 pods
   â””â”€ ì•ˆì •ì  ì²˜ë¦¬ âœ…

3ï¸âƒ£ 10k RPS: ë³‘ëª© ë°œê²¬
   â”œâ”€ Redis CPU 100% ğŸ”´
   â”œâ”€ Status API KEYS ëª…ë ¹ì–´
   â””â”€ ìµœì í™” í•„ìš”!

4ï¸âƒ£ ìµœì í™” í›„ 10k RPS:
   â”œâ”€ Position Index ì ìš©
   â”œâ”€ Redis CPU 40% âœ…
   â””â”€ ì—¬ìœ ë¡œì›€

5ï¸âƒ£ 20k RPS: í™•ì¥ ê²€ì¦
   â”œâ”€ Gateway 10 pods â†’ 20 pods
   â”œâ”€ Redis CPU 70% âœ…
   â””â”€ ì•ˆì •ì 

6ï¸âƒ£ 30k RPS: ëª©í‘œ ë‹¬ì„±
   â”œâ”€ Gateway 30 pods
   â”œâ”€ Redis CPU 90% âœ…
   â””â”€ ëª©í‘œ ë‹¬ì„±! ğŸ‰
```

### ë©˜íŠ¸

ë¶€í•˜ í…ŒìŠ¤íŠ¸ ì „ëµì€ ì ì§„ì  ì¦ê°€ì˜€ìŠµë‹ˆë‹¤.

**1k RPS:** ê¸°ëŠ¥ ê²€ì¦
- ëª¨ë“  API ì •ìƒ ì‘ë™
- ì•„í‚¤í…ì²˜ ê²€ì¦ ì™„ë£Œ

**5k RPS:** ì´ˆê¸° í™•ì¥
- Karpenterê°€ ìë™ìœ¼ë¡œ Gateway pods ì¦ê°€
- ì•ˆì •ì  ì²˜ë¦¬

**10k RPS:** ë³‘ëª© ë°œê²¬!
- Redis CPU 100%
- KEYS ëª…ë ¹ì–´ê°€ ë¬¸ì œ
- Position Indexë¡œ ìµœì í™”

**ìµœì í™” í›„:**
- 10k RPS: Redis CPU 40%
- 20k RPS: Redis CPU 70%
- **30k RPS: Redis CPU 90% - ëª©í‘œ ë‹¬ì„±!**

**ìµœì¢… ì„±ëŠ¥:**
- ì²˜ë¦¬ëŸ‰: 30k RPS
- Gateway CPU: 15%
- Backend CPU: < 5%
- ì—ëŸ¬ìœ¨: < 1%

---

## ğŸ“œ 5.2 Karpenter ìë™ í™•ì¥ ê²€ì¦

### ìŠ¬ë¼ì´ë“œ
```
"Karpenter í™•ì¥ ì„±ëŠ¥"

Scale-up í…ŒìŠ¤íŠ¸:
â”œâ”€ 1k â†’ 5k RPS (4k ì¦ê°€):
â”‚   â””â”€ 30ì´ˆë§Œì— 2 pods ì¶”ê°€ (3 â†’ 5)
â”‚
â”œâ”€ 5k â†’ 10k RPS (5k ì¦ê°€):
â”‚   â””â”€ 1ë¶„ë§Œì— 5 pods ì¶”ê°€ (5 â†’ 10)
â”‚
â”œâ”€ 10k â†’ 20k RPS (10k ì¦ê°€):
â”‚   â””â”€ 2ë¶„ë§Œì— 10 pods ì¶”ê°€ (10 â†’ 20)
â”‚
â””â”€ 20k â†’ 30k RPS (10k ì¦ê°€):
    â””â”€ 2ë¶„ë§Œì— 10 pods ì¶”ê°€ (20 â†’ 30)

Scale-down í…ŒìŠ¤íŠ¸:
â”œâ”€ 30k â†’ 10k RPS:
â”‚   â””â”€ 5ë¶„ë§Œì— 15 pods ì œê±° (30 â†’ 15)
â”‚
â””â”€ 10k â†’ 1k RPS:
    â””â”€ 10ë¶„ë§Œì— 10 pods ì œê±° (15 â†’ 5)

Spot Instance íš¨ê³¼:
â”œâ”€ Spot ë¹„ìœ¨: 70% (21/30 pods)
â”œâ”€ ì¤‘ë‹¨ìœ¨: < 2% (1ê°œì›” í‰ê· )
â””â”€ ë¹„ìš© ì ˆê°: $840/month
```

### ë©˜íŠ¸

Karpenterì˜ ìë™ í™•ì¥ ì„±ëŠ¥ì…ë‹ˆë‹¤.

**Scale-up (ë¹ ë¦„):**
- 5k RPS ì¦ê°€ ì‹œ: 30ì´ˆ ~ 1ë¶„
- 10k RPS ì¦ê°€ ì‹œ: 2ë¶„
- íŠ¸ë˜í”½ ì¦ê°€ì— ë¹ ë¥´ê²Œ ëŒ€ì‘

**Scale-down (ì•ˆì •ì ):**
- 5-10ë¶„ ëŒ€ê¸° í›„ ì œê±°
- íŠ¸ë˜í”½ ê°ì†Œ í™•ì¸ í›„ ì¶•ì†Œ
- ì•ˆì •ì„± ìš°ì„ 

**Spot Instance:**
- 70% Spot + 30% On-demand
- ì¤‘ë‹¨ìœ¨ < 2% (ë‹¤ì–‘í•œ íƒ€ì… ì‚¬ìš©)
- ì›” $840 ì ˆê°

**í•µì‹¬:**
- Gateway ë¶€í•˜ ì§‘ì¤‘ â†’ Karpenterë¡œ ëŒ€ì‘ ì„±ê³µ
- Trade-offë¥¼ ìë™í™”ë¡œ í•´ê²°

---

# ğŸ“ Part 6: Lesson Learned - 5ë¶„

## ğŸ“œ 6.1 ì„¤ê³„ ê³¼ì •ì˜ êµí›ˆ

### ìŠ¬ë¼ì´ë“œ
```
"ì„¤ê³„ë¶€í„° ìµœì í™”ê¹Œì§€ì˜ êµí›ˆ"

1ï¸âƒ£ ìš”êµ¬ì‚¬í•­ ë¨¼ì €
   "30ë§Œ ëª…, ì‹¤ì‹œê°„ í”¼ë“œë°±, ê³µì •ì„±"
   â†’ ì•„í‚¤í…ì²˜ê°€ ë”°ë¼ì˜´

2ï¸âƒ£ Trade-off ì¸ì •
   "Gateway ë¶€í•˜ ì§‘ì¤‘" â†’ ìˆ˜ìš©í•˜ê³  ìµœì í™”

3ï¸âƒ£ ì ì ˆí•œ ë„êµ¬ ì„ íƒ
   "ëŒ€ê¸°ì—´ = Redis ZSET" â†’ ë”± ë§ìŒ

4ï¸âƒ£ ì´ˆê¸° êµ¬í˜„ â‰  ìµœì¢…
   "ì¼ë‹¨ ì‘ë™í•˜ê²Œ, ê·¸ ë‹¤ìŒ ìµœì í™”"

5ï¸âƒ£ ëª¨ë‹ˆí„°ë§ í•„ìˆ˜
   "CloudWatch + pprof" â†’ ë³‘ëª© ë°œê²¬

6ï¸âƒ£ ì½”ë“œê°€ ë‹µ
   "ë…¸ë“œ ì¦ì„¤ < ì½”ë“œ ìµœì í™”"

7ï¸âƒ£ ê²€ì¦ ì¤‘ìš”
   "ì„¤ê³„ê°€ ë§ì•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸ë¡œ ì¦ëª…"
```

### ë©˜íŠ¸

ì´ë²ˆ ì—¬ì •ì—ì„œ ë°°ìš´ êµí›ˆë“¤ì„ ì •ë¦¬í•˜ê² ìŠµë‹ˆë‹¤.

**ì²«ì§¸, ìš”êµ¬ì‚¬í•­ì´ ë¨¼ì €ì…ë‹ˆë‹¤.**
"30ë§Œ ëª…ì„ ì²˜ë¦¬í•´ì•¼ í•œë‹¤" â†’ ê¸°ìˆ  ì„ íƒ
"ì‹¤ì‹œê°„ í”¼ë“œë°±ì´ í•„ìš”í•˜ë‹¤" â†’ Gateway íŒ¨í„´
"ê³µì •ì„±ì„ ë³´ì¥í•´ì•¼ í•œë‹¤" â†’ ëŒ€ê¸°ì—´ ê´€ë¦¬

ê¸°ìˆ ì´ ë¨¼ì €ê°€ ì•„ë‹ˆë¼, ìš”êµ¬ì‚¬í•­ì´ ë¨¼ì €ì…ë‹ˆë‹¤.

**ë‘˜ì§¸, Trade-offë¥¼ ì¸ì •í•´ì•¼ í•©ë‹ˆë‹¤.**
"Gatewayì— ë¶€í•˜ê°€ ì§‘ì¤‘ë  ê²ƒì´ë‹¤" â†’ ì•Œê³  ìˆì—ˆìŠµë‹ˆë‹¤.
í•˜ì§€ë§Œ ì´ê²Œ ìµœì„ ì´ë¼ê³  íŒë‹¨í–ˆìŠµë‹ˆë‹¤.
ê·¸ë¦¬ê³  ìµœì í™”ì— ì§‘ì¤‘í–ˆìŠµë‹ˆë‹¤.

**ì…‹ì§¸, ì ì ˆí•œ ë„êµ¬ë¥¼ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤.**
ëŒ€ê¸°ì—´ ê´€ë¦¬ = Redis ZSET
ì´ë§Œí¼ ë”± ë§ëŠ” ë„êµ¬ê°€ ì—†ì—ˆìŠµë‹ˆë‹¤.

**ë„·ì§¸, ì´ˆê¸° êµ¬í˜„ê³¼ ìµœì¢…ì€ ë‹¤ë¦…ë‹ˆë‹¤.**
"ì¼ë‹¨ ì‘ë™í•˜ê²Œ ë§Œë“¤ì" â†’ KEYS ì‚¬ìš©
"ì´ì œ ìµœì í™”í•˜ì" â†’ Position Index

ë¹ ë¥´ê²Œ ê²€ì¦í•˜ê³ , ì ì§„ì ìœ¼ë¡œ ê°œì„ í•˜ëŠ” ê²Œ ì¤‘ìš”í•©ë‹ˆë‹¤.

**ë‹¤ì„¯ì§¸, ëª¨ë‹ˆí„°ë§ì´ í•„ìˆ˜ì…ë‹ˆë‹¤.**
CloudWatch ì—†ì—ˆìœ¼ë©´, Redis CPU 100%ë¥¼ ëª°ëì„ ê²ë‹ˆë‹¤.
pprof ì—†ì—ˆìœ¼ë©´, KEYSê°€ ë¬¸ì œì¸ì§€ ëª°ëì„ ê²ë‹ˆë‹¤.

**ì—¬ì„¯ì§¸, ì½”ë“œê°€ ë‹µì…ë‹ˆë‹¤.**
"Redis ë…¸ë“œë¥¼ ëŠ˜ë¦´ê¹Œ?" â†’ ë¹„ìš© ì¦ê°€
"ì½”ë“œë¥¼ ìµœì í™”í•˜ì" â†’ ë¹„ìš© 0ì›

ëŒ€ë¶€ë¶„ì˜ ë¬¸ì œëŠ” ì½”ë“œ ìµœì í™”ë¡œ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ì¼ê³±ì§¸, ê²€ì¦ì´ ì¤‘ìš”í•©ë‹ˆë‹¤.**
"ì´ ì„¤ê³„ê°€ ë§ì„ê¹Œ?" â†’ ë¶€í•˜ í…ŒìŠ¤íŠ¸ë¡œ ì¦ëª…
"ì •ë§ 30k RPSë¥¼ ì²˜ë¦¬í• ê¹Œ?" â†’ ì‹¤ì œë¡œ ì²˜ë¦¬í•¨

ì„¤ê³„ê°€ ë§ì•˜ëŠ”ì§€ëŠ”, í…ŒìŠ¤íŠ¸ë¡œ ì¦ëª…í•´ì•¼ í•©ë‹ˆë‹¤.

---

## ğŸ“œ 6.2 ì‹¤ì „ íŒ

### ìŠ¬ë¼ì´ë“œ
```
"Redis ì‚¬ìš© ì‹œ ì£¼ì˜ì‚¬í•­"

ğŸš« ì ˆëŒ€ í•˜ì§€ ë§ì•„ì•¼ í•  ê²ƒë“¤:
1. KEYS ëª…ë ¹ì–´ ì‚¬ìš© (O(N) blocking)
   â†’ SCAN ë˜ëŠ” Index ì‚¬ìš©
   
2. ì‘ì€ Connection Pool (ê³ ë¶€í•˜ ëŒ€ë¹„ ì•ˆë¨)
   â†’ ìµœì†Œ 1000 ì´ìƒ ê¶Œì¥
   
3. ê¸°ë³¸ Timeout ì„¤ì • (Redis ì‘ë‹µ ëŒ€ê¸° í•„ìš”)
   â†’ 10s ì´ìƒ ì—¬ìœ ìˆê²Œ
   
4. Cluster Mode ë¬´ì‹œ (Hash tag í•„ìˆ˜)
   â†’ {key} í˜•ì‹ìœ¼ë¡œ ê°™ì€ slotì— ë§¤í•‘


âœ… ë°˜ë“œì‹œ í•´ì•¼ í•  ê²ƒë“¤:
1. ì ì ˆí•œ ìë£Œêµ¬ì¡° (ZSET for Index)
2. Lua Script (ì›ìì  ì—°ì‚°)
3. TTL ì„¤ì • (ìë™ ë§Œë£Œ)
4. Read Replica í™œìš© (ì½ê¸° ë¶„ì‚°)
5. CloudWatch ëª¨ë‹ˆí„°ë§ (CPU, Network)
6. pprof í”„ë¡œíŒŒì¼ë§ (ë³‘ëª© ì°¾ê¸°)
```

### ë©˜íŠ¸

ë§ˆì§€ë§‰ìœ¼ë¡œ, ì‹¤ì „ íŒë“¤ì„ ê³µìœ í•˜ê² ìŠµë‹ˆë‹¤.

**Redis ì‚¬ìš© ì‹œ ì ˆëŒ€ í•˜ì§€ ë§ì•„ì•¼ í•  ê²ƒ:**

1. **KEYS ëª…ë ¹ì–´ ì‚¬ìš©**
   - Productionì—ì„œ ì ˆëŒ€ ê¸ˆì§€
   - ëŒ€ì‹  SCANì´ë‚˜ Index ì‚¬ìš©
   - ìš°ë¦¬ì˜ êµí›ˆ: KEYS â†’ 100ë°° ëŠë¦¼

2. **ì‘ì€ Connection Pool**
   - ê¸°ë³¸ê°’ 100ì€ ë¶€ì¡±
   - ìµœì†Œ 1000 ì´ìƒ ê¶Œì¥
   - ê³ ë¶€í•˜ ëŒ€ë¹„ í•„ìˆ˜

3. **ì§§ì€ Timeout**
   - 2-3ì´ˆëŠ” ë¶€ì¡±
   - 10ì´ˆ ì´ìƒ ì—¬ìœ ìˆê²Œ
   - Redis ì‘ë‹µ ëŒ€ê¸° í•„ìš”

4. **Cluster Mode ë¬´ì‹œ**
   - Hash tag ì‚¬ìš© í•„ìˆ˜
   - `{eventID}` í˜•ì‹ìœ¼ë¡œ ê°™ì€ slot ë§¤í•‘
   - CROSSSLOT ì—ëŸ¬ ë°©ì§€

**ë°˜ë“œì‹œ í•´ì•¼ í•  ê²ƒ:**

1. **ì ì ˆí•œ ìë£Œêµ¬ì¡°**
   - ZSETìœ¼ë¡œ Index ë§Œë“¤ê¸°
   - O(log N) ì¡°íšŒ ë³´ì¥

2. **Lua Script**
   - ì›ìì  ì—°ì‚° ë³´ì¥
   - Race condition ë°©ì§€

3. **TTL ì„¤ì •**
   - ë¹„í™œì„± ë°ì´í„° ìë™ ë§Œë£Œ
   - ë©”ëª¨ë¦¬ ê´€ë¦¬

4. **Read Replica**
   - ì½ê¸° ë¶€í•˜ ë¶„ì‚°
   - `RouteByLatency: true`

5. **ëª¨ë‹ˆí„°ë§**
   - CloudWatch ë©”íŠ¸ë¦­ í™•ì¸
   - CPU/Network/Commands ì¶”ì 

6. **í”„ë¡œíŒŒì¼ë§**
   - pprofë¡œ ë³‘ëª© ì°¾ê¸°
   - CPU/Memory/Goroutine ë¶„ì„

---

## ğŸ“œ 6.3 ë§ˆë¬´ë¦¬

### ìŠ¬ë¼ì´ë“œ
```
"30ë§Œ ëª…ì˜ íŠ¸ë˜í”½, ì–´ë–»ê²Œ ì²˜ë¦¬í–ˆë‚˜?"

ì—¬ì • ìš”ì•½:
1ï¸âƒ£ ë¬¸ì œ ì •ì˜: 30ë§Œ ëª…, ì‹¤ì‹œê°„, ê³µì •ì„±
2ï¸âƒ£ ì„¤ê³„ ê³ ë¯¼: Direct vs Queue vs Gateway
3ï¸âƒ£ ìš°ë¦¬ì˜ ì„ íƒ: Gateway + Redis + ì…ì¥ ì œì–´
4ï¸âƒ£ ì™œ Redisì¸ê°€: ZSET, Lua, TTL, Cluster
5ï¸âƒ£ ì„¤ê³„ êµ¬ì¡°: ë°©íŒŒì œ ì•„í‚¤í…ì²˜
5ï¸âƒ£-1ï¸âƒ£ ìš©ëŸ‰ ì‚°ì •: ì™œ 1,000 RPSì¸ê°€?
6ï¸âƒ£ ì¸ìŠ¤í„´ìŠ¤ ì„ ì •: cache.m7g.xlarge Ã— 10
7ï¸âƒ£ êµ¬í˜„ ë° ê²€ì¦: 1k RPS â†’ ì‘ë™ í™•ì¸
8ï¸âƒ£ ë³‘ëª© ë°œê²¬: 10k RPS â†’ Redis CPU 100%
9ï¸âƒ£ ê·¼ë³¸ ì›ì¸: CloudWatch + pprof â†’ KEYS ëª…ë ¹ì–´
ğŸ”Ÿ í•´ê²°: Position Index (O(log N))
1ï¸âƒ£1ï¸âƒ£ ì„¸ë¶€ íŠœë‹: Pool, Memory, Probe
1ï¸âƒ£2ï¸âƒ£ ê²°ê³¼: 30k RPS, ë¹„ìš© 0ì›
1ï¸âƒ£3ï¸âƒ£ ì„¤ê³„ ê²€ì¦: ê°€ì„¤ ì¦ëª…, Trade-off í•´ê²°


í•µì‹¬ êµí›ˆ:
"ìš”êµ¬ì‚¬í•­ â†’ ì„¤ê³„ â†’ êµ¬í˜„ â†’ ê²€ì¦ â†’ ìµœì í™”"
"Trade-offë¥¼ ì¸ì •í•˜ê³ , ì§‘ì¤‘ íˆ¬ì"
"ë³‘ëª©ì€ ì˜ˆìƒ ë°–ì˜ ê³³ì—ì„œ, í•´ê²°ì±…ì€ ê°€ê¹Œìš´ ê³³ì—"


ë‹¤ìŒ ëª©í‘œ: 100k RPS? Multi-region? ğŸš€
```

### ë©˜íŠ¸

ì •ë¦¬í•˜ê² ìŠµë‹ˆë‹¤.

**"30ë§Œ ëª…ì˜ íŠ¸ë˜í”½, ì–´ë–»ê²Œ ì²˜ë¦¬í•  ê²ƒì¸ê°€?"**

ì´ ì§ˆë¬¸ì—ì„œ ì‹œì‘í–ˆìŠµë‹ˆë‹¤.

**ì„¤ê³„ ë‹¨ê³„:**
- 3ê°€ì§€ ì•„í‚¤í…ì²˜ íŒ¨í„´ì„ ë¹„êµí–ˆìŠµë‹ˆë‹¤
- Gateway + ì…ì¥ ì œì–´ë¥¼ ì„ íƒí–ˆìŠµë‹ˆë‹¤
- Redis ZSETìœ¼ë¡œ ëŒ€ê¸°ì—´ì„ ê´€ë¦¬í•˜ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤
- Trade-offë¥¼ ìˆ˜ìš©í•˜ê³ , ìµœì í™”ì— ì§‘ì¤‘í•˜ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤

**êµ¬í˜„ ë° ê²€ì¦:**
- 1,000 RPS í…ŒìŠ¤íŠ¸ â†’ ì‘ë™ í™•ì¸
- 10,000 RPS í…ŒìŠ¤íŠ¸ â†’ ë³‘ëª© ë°œê²¬ (Redis CPU 100%)
- pprof í”„ë¡œíŒŒì¼ë§ â†’ ê·¼ë³¸ ì›ì¸ ë°œê²¬ (KEYS ëª…ë ¹ì–´)

**í•´ê²° ë° ìµœì í™”:**
- Position Index ë„ì… (KEYS â†’ ZRANK)
- ì„±ëŠ¥ 100ë°° í–¥ìƒ (O(N) â†’ O(log N))
- ì„¸ë¶€ íŠœë‹ (Pool, Memory, Probe)

**ìµœì¢… ê²°ê³¼:**
- 30,000 RPS ë‹¬ì„±
- ì¶”ê°€ ë¹„ìš© 0ì›
- ì„¤ê³„ ê²€ì¦ ì™„ë£Œ

**í•µì‹¬ êµí›ˆ:**

1. **ìš”êµ¬ì‚¬í•­ì´ ë¨¼ì €**
   - ê¸°ìˆ ì´ ì•„ë‹Œ, ìš”êµ¬ì‚¬í•­ì´ ì„¤ê³„ë¥¼ ì´ë•ë‹ˆë‹¤

2. **Trade-offë¥¼ ì¸ì •**
   - ì™„ë²½í•œ ì„¤ê³„ëŠ” ì—†ìŠµë‹ˆë‹¤
   - Trade-offë¥¼ ìˆ˜ìš©í•˜ê³ , ì§‘ì¤‘ íˆ¬ìí•©ë‹ˆë‹¤

3. **ì ì§„ì  ê²€ì¦**
   - ë¹ ë¥´ê²Œ êµ¬í˜„í•˜ê³ , í…ŒìŠ¤íŠ¸ë¡œ ê²€ì¦í•©ë‹ˆë‹¤
   - ë³‘ëª©ì„ ì°¾ê³ , ìµœì í™”í•©ë‹ˆë‹¤

4. **ì½”ë“œê°€ ë‹µ**
   - ì¸í”„ë¼ ì¦ì„¤ë³´ë‹¤, ì½”ë“œ ìµœì í™”ê°€ ë¨¼ì €ì…ë‹ˆë‹¤

5. **ëª¨ë‹ˆí„°ë§ê³¼ í”„ë¡œíŒŒì¼ë§**
   - ë³‘ëª©ì€ ìˆ¨ì–´ ìˆìŠµë‹ˆë‹¤
   - ë„êµ¬ë¡œ ì°¾ì•„ì•¼ í•©ë‹ˆë‹¤

**ê·¸ë¦¬ê³  ë¬´ì—‡ë³´ë‹¤:**
ë³‘ëª©ì€ ì˜ˆìƒ ë°–ì˜ ê³³ì—ì„œ ë°œê²¬ë˜ê³ ,
í•´ê²°ì±…ì€ ì˜ì™¸ë¡œ ê°€ê¹Œìš´ ê³³ì— ìˆìŠµë‹ˆë‹¤.

ë‹¤ìŒ ëª©í‘œëŠ” 100k RPSì¼ê¹Œìš”?
ì•„ë‹ˆë©´ Multi-region ë°°í¬ì¼ê¹Œìš”?

ì—¬ëŸ¬ë¶„ì˜ ì‹œìŠ¤í…œì—ë„ ìˆ¨ê²¨ì§„ ë³‘ëª©ì´ ìˆì„ ê²ë‹ˆë‹¤.
ì°¾ì•„ì„œ í•´ê²°í•˜ëŠ” ê·¸ ê³¼ì •ì´,
ë°”ë¡œ ì—”ì§€ë‹ˆì–´ë§ì˜ ì¬ë¯¸ ì•„ë‹ê¹Œìš”?

ê°ì‚¬í•©ë‹ˆë‹¤! ğŸš€

---

## ğŸ“Š ë¶€ë¡: ê¸°ìˆ  ìŠ¤íƒ & ì„±ê³¼

### ê¸°ìˆ  ìŠ¤íƒ
```yaml
Architecture Pattern:
  - Gateway + Admission Control
  - Trade-off: Gateway ë¶€í•˜ ì§‘ì¤‘ ìˆ˜ìš©

Gateway (ë°©íŒŒì œ):
  - Go + Fiber
  - ElastiCache Redis Cluster (5 shards, 10 nodes)
  - Position Index (ZSET) - O(log N)
  - Admission Control (1,000 RPS)

Backend (ë³´í˜¸ë°›ëŠ” ì˜ì—­):
  - Reservation: Kotlin + Spring WebFlux
  - Inventory: Go + gRPC
  - Payment: Go + gRPC

Database:
  - DynamoDB (On-demand)
  - ElastiCache Redis

Monitoring & Profiling:
  - CloudWatch (CPU, Network, Commands)
  - Prometheus + Grafana
  - pprof (Go CPU/Memory profiling)

Infrastructure:
  - EKS (Kubernetes)
  - Karpenter (Auto-scaling)
  - ArgoCD (GitOps)
```

### ì„¤ê³„ ê²°ì • (Design Decisions)
```yaml
Why Gateway + Admission Control?
  âœ… ì‹¤ì‹œê°„ í”¼ë“œë°± (ìˆœë²ˆ ì¡°íšŒ)
  âœ… ë’·ë‹¨ ë³´í˜¸ (ì…ì¥ ì œì–´)
  âœ… ê³µì •ì„± ë³´ì¥ (ëŒ€ê¸°ì—´ ê´€ë¦¬)
  âŒ Gateway ë¶€í•˜ ì§‘ì¤‘ (ìˆ˜ìš©)

Why Redis?
  âœ… O(log N) ì¡°íšŒ (ZSET)
  âœ… ì›ìì  ì—°ì‚° (Lua Script)
  âœ… TTL ìë™ ë§Œë£Œ
  âœ… Cluster Mode (í™•ì¥ì„±)
  âœ… Read Replica (ì½ê¸° ë¶„ì‚°)
  âŒ DynamoDB: ë¹„ìš© ë†’ìŒ, ëŠë¦¼
  âŒ PostgreSQL: ë™ì‹œì„± ì œì–´ ì–´ë ¤ì›€

Why Position Index?
  âœ… O(log N) vs O(N) (100ë°° ë¹ ë¦„)
  âœ… Non-blocking (ZRANK)
  âœ… ê°„ë‹¨í•œ êµ¬í˜„
  âŒ KEYS: ì ˆëŒ€ ê¸ˆì§€
```

### ì„±ê³¼ ì§€í‘œ
```yaml
Performance:
  - ì²˜ë¦¬ëŸ‰: 10k â†’ 30k RPS (3ë°° í–¥ìƒ)
  - Redis CPU: 100% â†’ 40% (10k RPS ê¸°ì¤€)
  - Gateway CPU: 15% (ì—¬ìœ )
  - Backend CPU: 5% ë¯¸ë§Œ (ë§¤ìš° ì—¬ìœ )
  - Status API: 100ms â†’ <5ms
  
Optimization:
  - KEYS â†’ Index: ~100x faster
  - O(N) â†’ O(log N): ì‹œê°„ ë³µì¡ë„ ê°œì„ 
  - Memory: 200Mi â†’ 80Mi (idle)
  - Readiness: Pod ì‹œì‘ ì•ˆì •í™”
  
Cost:
  - ì¶”ê°€ ë¹„ìš©: 0ì›
  - ë…¸ë“œ ì¦ì„¤: ë¶ˆí•„ìš”
  - ì½”ë“œ ìµœì í™”ë§Œìœ¼ë¡œ ë‹¬ì„±
  - ElastiCache: cache.m7g.xlarge Ã— 10 (ìœ ì§€)
  
Reliability:
  - HPA scale-down: ì •ìƒí™”
  - Rolling update: ì•ˆì •í™”
  - Error rate: < 1%
  - Readiness probe failure: ì œê±°
```

### ì„¤ê³„ ê²€ì¦ ê²°ê³¼
```yaml
ê°€ì„¤:
  "Gateway + Redisê°€ ë°©íŒŒì œ ì—­í• ì„ í•  ê²ƒì´ë‹¤"

ê²€ì¦:
  âœ… 30ë§Œ ëª… íŠ¸ë˜í”½ ë°›ì•„ëƒ„
  âœ… ì…ì¥ ì œì–´ë¡œ ë’·ë‹¨ ë³´í˜¸
  âœ… Backend CPU < 5%
  âœ… DynamoDB 10% ì‚¬ìš©
  âœ… ë¹„ìš© 0ì› ì¶”ê°€
  âœ… 30k RPS ë‹¬ì„±

Trade-off í•´ê²°:
  "Gateway ë¶€í•˜ ì§‘ì¤‘" â†’ Position Index ìµœì í™”
  "Redis ë³‘ëª©" â†’ O(log N) ê°œì„ 

ì„¤ê³„ ì›ì¹™ ë‹¬ì„±:
  âœ… ì‹¤ì‹œê°„ í”¼ë“œë°±
  âœ… ë’·ë‹¨ ë³´í˜¸
  âœ… ê³µì •ì„± ë³´ì¥
  âœ… ë¹„ìš© íš¨ìœ¨ì„±
```

---

**ì‘ì„±**: Traffic Tacos Team  
**ì¼ì**: 2025-10-08  
**ë²„ì „**: 2.0 (ì„¤ê³„ ê³¼ì • ì¤‘ì‹¬ ì¬êµ¬ì„±)  
**ë³€ê²½**: ê²°ê³¼ ì¤‘ì‹¬ â†’ ì„¤ê³„ ê³ ë¯¼ ë° Trade-off ë¶„ì„ ì¶”ê°€
