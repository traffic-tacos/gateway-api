# Traffic Tacos: 30k RPS í‹°ì¼“íŒ… ì‹œìŠ¤í…œ
## íŠ¸ë˜í”½ Â· ë³´ì•ˆ Â· FinOps Â· ê´€ì¸¡ì„± Â· ë¶€í•˜í…ŒìŠ¤íŠ¸

---

## ğŸ“‹ **ë°œí‘œ êµ¬ì¡°**

```
Part 1: íŠ¸ë˜í”½ ì²˜ë¦¬ (15ë¶„) - ì•„í‚¤í…ì²˜ ì„¤ê³„ë¶€í„° 30k RPS ë‹¬ì„±ê¹Œì§€
  â””â”€ 1.1~1.14: ë¬¸ì œ ì •ì˜ â†’ ì„¤ê³„ â†’ ë³‘ëª© ë°œê²¬ â†’ ìµœì í™” â†’ ê²€ì¦

Part 2: ë³´ì•ˆ (10ë¶„) - 4ê³„ì¸µ ì‹¬ì¸µ ë°©ì–´ (Defense in Depth)
  â””â”€ 2.1~2.5: WAF+CAPTCHA â†’ Istio Ambient â†’ Teleport â†’ Falco

Part 3: FinOps (10ë¶„) - ì„¤ê³„ë¶€í„° ê³ ë ¤í•œ ë¹„ìš© ìµœì í™” â­ MAJOR UPDATE
  â””â”€ 3.1~3.5: Spot ì „ëµ â†’ Karpenter â†’ KEDA â†’ ë¹„ìš© ê°€ì‹œì„± â†’ $3,200/month ì ˆê°

Part 4: ê´€ì¸¡ì„± (5ë¶„) - CloudWatch + pprofë¡œ ë³‘ëª© ì°¾ê¸°
  â””â”€ 4.1~4.2: ë©”íŠ¸ë¦­ ë¶„ì„ â†’ í”„ë¡œíŒŒì¼ë§ â†’ ë¶„ì‚° ì¶”ì 

Part 5: ë¶€í•˜í…ŒìŠ¤íŠ¸ (5ë¶„) - ì ì§„ì  ê²€ì¦ ë° Karpenter í™•ì¥
  â””â”€ 5.1~5.2: 1k â†’ 30k RPS í…ŒìŠ¤íŠ¸ â†’ Karpenter í™•ì¥ ì„±ëŠ¥

Part 6: Lesson Learned (5ë¶„) - ì„¤ê³„ êµí›ˆ ë° ì‹¤ì „ íŒ
  â””â”€ 6.1~6.3: ì„¤ê³„ êµí›ˆ â†’ ê¸°ìˆ  êµí›ˆ â†’ ë‹¤ìŒ ëª©í‘œ

ì´ 50ë¶„ (Q&A í¬í•¨ 65ë¶„)
```

---

# ğŸŒŠ Part 1: íŠ¸ë˜í”½ ì²˜ë¦¬ (15ë¶„)

## ğŸ“œ 1.1 ë¬¸ì œ ì •ì˜

### ìŠ¬ë¼ì´ë“œ
```
"ì¸ê¸° ì½˜ì„œíŠ¸ í‹°ì¼“íŒ…, ì˜ˆë§¤ ì˜¤í”ˆ ìˆœê°„"

30ë§Œ ëª…ì´ ë™ì‹œì— ì ‘ì†
    â†“
ì´ˆë‹¹ ìˆ˜ë§Œ ê±´ì˜ ìš”ì²­ í­ì£¼
    â†“
ì¢Œì„ì€ 1ë§Œ ì„ë¿
    â†“

ë¬¸ì œ:
â”œâ”€ 30ë§Œ ëª…ì„ ì–´ë–»ê²Œ ì²˜ë¦¬í•  ê²ƒì¸ê°€?
â”œâ”€ 1ë§Œ ì„ì„ ì–´ë–»ê²Œ ê³µì •í•˜ê²Œ ë¶„ë°°í•  ê²ƒì¸ê°€?
â”œâ”€ ì‹œìŠ¤í…œì€ ì–´ë–»ê²Œ ë²„í‹¸ ê²ƒì¸ê°€?
â””â”€ ë¹„ìš©ì€ ì–¼ë§ˆë‚˜ ë“¤ ê²ƒì¸ê°€?
```

### ë©˜íŠ¸

ì¸ê¸° ì½˜ì„œíŠ¸ í‹°ì¼“íŒ…ì„ ìƒê°í•´ ë³´ì„¸ìš”.

ì˜ˆë§¤ ì˜¤í”ˆ ì§ì „, **30ë§Œ ëª…ì´ ë™ì‹œì— ëŒ€ê¸°**í•©ë‹ˆë‹¤.
ì˜¤í”ˆê³¼ ë™ì‹œì— **ì´ˆë‹¹ ìˆ˜ë§Œ ê±´ì˜ ìš”ì²­**ì´ ëª°ë ¤ì˜µë‹ˆë‹¤.
í•˜ì§€ë§Œ ì¢Œì„ì€ **1ë§Œ ì„**ë¿ì…ë‹ˆë‹¤.

ì´ë•Œ ìš°ë¦¬ê°€ í’€ì–´ì•¼ í•  ë¬¸ì œëŠ” ë¬´ì—‡ì¼ê¹Œìš”?

**ì²«ì§¸, íŠ¸ë˜í”½ ì²˜ë¦¬**
- 30ë§Œ ëª…ì˜ ë™ì‹œ ì ‘ì†ì„ ì–´ë–»ê²Œ ë°›ì„ ê²ƒì¸ê°€?
- ì„œë²„ê°€ í„°ì§€ì§€ ì•Šìœ¼ë ¤ë©´?

**ë‘˜ì§¸, ê³µì •ì„±**
- ëˆ„ê°€ ë¨¼ì € ë“¤ì–´ì™”ëŠ”ì§€ ì–´ë–»ê²Œ íŒë‹¨í•  ê²ƒì¸ê°€?
- ë´‡ì´ ì•„ë‹Œ ì‹¤ì œ ì‚¬ìš©ìë¥¼ ì–´ë–»ê²Œ ë³´í˜¸í•  ê²ƒì¸ê°€?

**ì…‹ì§¸, ì¬ê³  ê´€ë¦¬**
- 1ë§Œ ì„ì„ ì–´ë–»ê²Œ ì˜¤ë²„ì…€ ì—†ì´ íŒë§¤í•  ê²ƒì¸ê°€?
- ë™ì‹œì— ê°™ì€ ì¢Œì„ì„ ì„ íƒí•˜ë©´?

**ë„·ì§¸, ë¹„ìš©**
- ì§§ì€ í”¼í¬ ë•Œë¬¸ì— ì¸í”„ë¼ë¥¼ ì–¼ë§ˆë‚˜ ì¦ì„¤í•´ì•¼ í•˜ë‚˜?
- í‰ìƒì‹œì—ëŠ” ìì›ì´ ë†€ì§€ ì•Šì„ê¹Œ?

ì´ ëª¨ë“  ë¬¸ì œë¥¼ ì–´ë–»ê²Œ í’€ ê²ƒì¸ê°€?
ê·¸ê²ƒì´ ì˜¤ëŠ˜ì˜ ì£¼ì œì…ë‹ˆë‹¤.

---

## ğŸ“œ 1.2 ì•„í‚¤í…ì²˜ ì„ íƒì§€

### ìŠ¬ë¼ì´ë“œ
```
"3ê°€ì§€ ì•„í‚¤í…ì²˜ íŒ¨í„´"

íŒ¨í„´ 1: Direct Access (ì§ì ‘ ì ‘ê·¼)
Browser â†’ Reservation API â†’ Inventory API â†’ DB
âœ… ë‹¨ìˆœí•¨
âŒ DBê°€ í„°ì§, ì˜¤ë²„ì…€ ìœ„í—˜, ë´‡ ë°©ì–´ ì•ˆë¨

íŒ¨í„´ 2: Queue Service (ì™¸ë¶€ í)
Browser â†’ SQS/SNS â†’ Lambda â†’ Reservation API
âœ… ë¹„ë™ê¸° ì²˜ë¦¬
âŒ ì‘ë‹µ ì§€ì—°, ì‚¬ìš©ì ê²½í—˜ ë‚˜ì¨, ë¹„ìš© ë†’ìŒ

íŒ¨í„´ 3: Gateway + Admission Control (ì…ì¥ ì œì–´)
Browser â†’ Gateway (ëŒ€ê¸°ì—´) â†’ Reservation API
âœ… ì‹¤ì‹œê°„ ì‘ë‹µ, ì œì–´ ê°€ëŠ¥, ê³µì •ì„± ë³´ì¥
âŒ Gateway ë¶€í•˜ ì§‘ì¤‘ (Trade-off)
```

### ë©˜íŠ¸

30ë§Œ ëª…ì˜ íŠ¸ë˜í”½ì„ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•ì—ëŠ” í¬ê²Œ 3ê°€ì§€ê°€ ìˆìŠµë‹ˆë‹¤.

**íŒ¨í„´ 1: Direct Access - ì§ì ‘ ì ‘ê·¼**
```
Browser â†’ Reservation API â†’ Inventory API â†’ DB
```

ê°€ì¥ ë‹¨ìˆœí•œ ë°©ë²•ì…ë‹ˆë‹¤.
í•˜ì§€ë§Œ ë¬¸ì œê°€ ë§ìŠµë‹ˆë‹¤.
- 30ë§Œ ëª…ì´ ë™ì‹œì— DBë¥¼ ì¹˜ë©´? â†’ **DBê°€ í„°ì§‘ë‹ˆë‹¤**
- ë™ì‹œì— ê°™ì€ ì¢Œì„ì„ ì„ íƒí•˜ë©´? â†’ **ì˜¤ë²„ì…€ ë°œìƒ**
- ë´‡ íŠ¸ë˜í”½ì€? â†’ **ë°©ì–´ ë¶ˆê°€ëŠ¥**

**íŒ¨í„´ 2: Queue Service - ì™¸ë¶€ í ì„œë¹„ìŠ¤**
```
Browser â†’ SQS/SNS â†’ Lambda â†’ Reservation API
```

ë¹„ë™ê¸° ì²˜ë¦¬ë¡œ ë¶€í•˜ë¥¼ ë¶„ì‚°í•©ë‹ˆë‹¤.
í•˜ì§€ë§Œ ì´ê²ƒë„ ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.
- ì‚¬ìš©ìëŠ” ì–¸ì œ ì²˜ë¦¬ë˜ëŠ”ì§€ ëª¨ë¦…ë‹ˆë‹¤ â†’ **ì‘ë‹µ ì§€ì—°**
- ì‹¤ì‹œê°„ í”¼ë“œë°±ì´ ì—†ìŠµë‹ˆë‹¤ â†’ **ì‚¬ìš©ì ê²½í—˜ ë‚˜ì¨**
- Lambda í˜¸ì¶œ ë¹„ìš©ì´ í­ë°œí•©ë‹ˆë‹¤ â†’ **ë¹„ìš© ë†’ìŒ**

**íŒ¨í„´ 3: Gateway + Admission Control - ì…ì¥ ì œì–´**
```
Browser â†’ Gateway (ëŒ€ê¸°ì—´ ê´€ë¦¬) â†’ Reservation API
```

Gatewayì—ì„œ ëŒ€ê¸°ì—´ì„ ê´€ë¦¬í•˜ê³ , ì…ì¥ì„ ì œì–´í•©ë‹ˆë‹¤.
- ì‚¬ìš©ìëŠ” ìì‹ ì˜ ìˆœë²ˆì„ **ì‹¤ì‹œê°„ìœ¼ë¡œ í™•ì¸**
- Gatewayê°€ ì…ì¥ì„ ì œì–´í•´ì„œ **ë’·ë‹¨ ë³´í˜¸**
- ê³µì •ì„±ì„ **ë³´ì¥**

í•˜ì§€ë§Œ Trade-offê°€ ìˆìŠµë‹ˆë‹¤.
- **Gatewayì— ë¶€í•˜ê°€ ì§‘ì¤‘**ë©ë‹ˆë‹¤
- Gatewayê°€ **SPOF(Single Point of Failure)**ê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤

ìš°ë¦¬ëŠ” **íŒ¨í„´ 3**ì„ ì„ íƒí–ˆìŠµë‹ˆë‹¤.
ì™œ ê·¸ë¬ì„ê¹Œìš”?

---

## ğŸ“œ 1.3 ì™œ Gateway + ì…ì¥ ì œì–´ì¸ê°€?

### ìŠ¬ë¼ì´ë“œ
```
"ìš°ë¦¬ì˜ ì„¤ê³„ ì² í•™"

í•µì‹¬ ì›ì¹™ 3ê°€ì§€:

1ï¸âƒ£ ì‹¤ì‹œê°„ í”¼ë“œë°±
   "ì§€ê¸ˆ ëª‡ ë²ˆì§¸ì¸ì§€ ì•Œë ¤ì¤˜ì•¼ í•œë‹¤"
   â†’ Gatewayì—ì„œ ì‹¤ì‹œê°„ ìˆœë²ˆ ì œê³µ

2ï¸âƒ£ ë’·ë‹¨ ë³´í˜¸
   "DBì™€ APIëŠ” í„°ì§€ë©´ ì•ˆ ëœë‹¤"
   â†’ Gatewayì—ì„œ ì…ì¥ ì œì–´ (Rate Limiting)

3ï¸âƒ£ ê³µì •ì„± ë³´ì¥
   "ë¨¼ì € ì˜¨ ì‚¬ëŒì´ ë¨¼ì € ë“¤ì–´ê°€ì•¼ í•œë‹¤"
   â†’ ëŒ€ê¸°ì—´ ìˆœì„œ ê´€ë¦¬


Trade-off ìˆ˜ìš©:
âœ… Gateway ë¶€í•˜ ì§‘ì¤‘ â†’ ì´ê±´ ë°›ì•„ë“¤ì´ì
âœ… Gateway ìµœì í™” â†’ ì—¬ê¸°ì— ì§‘ì¤‘ íˆ¬ìí•˜ì
```

### ë©˜íŠ¸

ìš°ë¦¬ê°€ Gateway + ì…ì¥ ì œì–´ë¥¼ ì„ íƒí•œ ì´ìœ ëŠ” ëª…í™•í•©ë‹ˆë‹¤.

**ì²«ì§¸, ì‹¤ì‹œê°„ í”¼ë“œë°±ì´ í•„ìˆ˜ì˜€ìŠµë‹ˆë‹¤.**
í‹°ì¼“íŒ… ì‚¬ìš©ìëŠ” "ì§€ê¸ˆ ëª‡ ë²ˆì§¸ì¸ì§€" ì•Œê³  ì‹¶ì–´ í•©ë‹ˆë‹¤.
ë¹„ë™ê¸° í ë°©ì‹ìœ¼ë¡œëŠ” ì´ê²Œ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.
Gatewayì—ì„œ ëŒ€ê¸°ì—´ì„ ê´€ë¦¬í•˜ë©´, ì‹¤ì‹œê°„ìœ¼ë¡œ ìˆœë²ˆì„ ì•Œë ¤ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ë‘˜ì§¸, ë’·ë‹¨ ë³´í˜¸ê°€ í•„ìˆ˜ì˜€ìŠµë‹ˆë‹¤.**
30ë§Œ ëª…ì´ ë™ì‹œì— DBë¥¼ ì¹˜ë©´, DBê°€ í„°ì§‘ë‹ˆë‹¤.
Reservation APIê°€ ë™ì‹œì— 1ë§Œ ê±´ì„ ì²˜ë¦¬í•˜ë©´, APIê°€ í„°ì§‘ë‹ˆë‹¤.
Gatewayì—ì„œ ì…ì¥ì„ ì œì–´í•˜ë©´, ë’·ë‹¨ì„ ë³´í˜¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì˜ˆ: ì´ˆë‹¹ 1,000ëª…ë§Œ ì…ì¥ í—ˆìš©
- Reservation APIëŠ” 1,000 RPSë§Œ ë°›ìŒ
- ì•ˆì „í•©ë‹ˆë‹¤

**ì…‹ì§¸, ê³µì •ì„±ì´ í•„ìˆ˜ì˜€ìŠµë‹ˆë‹¤.**
ë¨¼ì € ì˜¨ ì‚¬ëŒì´ ë¨¼ì € ë“¤ì–´ê°€ì•¼ í•©ë‹ˆë‹¤.
Gatewayì—ì„œ ëŒ€ê¸°ì—´ ìˆœì„œë¥¼ ê´€ë¦¬í•˜ë©´, ê³µì •ì„±ì„ ë³´ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**í•˜ì§€ë§Œ Trade-offê°€ ìˆìŠµë‹ˆë‹¤.**
Gatewayì— ë¶€í•˜ê°€ ì§‘ì¤‘ë©ë‹ˆë‹¤.
Gatewayê°€ í„°ì§€ë©´, ì „ì²´ ì‹œìŠ¤í…œì´ ë§ˆë¹„ë©ë‹ˆë‹¤.

ìš°ë¦¬ëŠ” ì´ Trade-offë¥¼ **ìˆ˜ìš©**í•˜ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.
ëŒ€ì‹ , **Gateway ìµœì í™”ì— ì§‘ì¤‘ íˆ¬ì**í•˜ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.

---

## ğŸ“œ 1.4 Gateway + Redis ì„¤ê³„

### ìŠ¬ë¼ì´ë“œ
```
"ì™œ Redisì¸ê°€?"

ëŒ€ê¸°ì—´ ê´€ë¦¬ì— í•„ìš”í•œ ê²ƒ:
â”œâ”€ ë¹ ë¥¸ ì¡°íšŒ (ms ë‹¨ìœ„)
â”œâ”€ ìˆœì„œ ë³´ì¥ (FIFO)
â”œâ”€ ì›ìì  ì—°ì‚° (ë™ì‹œì„± ì œì–´)
â”œâ”€ TTL ìë™ ê´€ë¦¬ (ë§Œë£Œ ì²˜ë¦¬)
â””â”€ ë¶„ì‚° í™˜ê²½ ì§€ì›


Redisì˜ ê°•ì :
âœ… O(log N) ì¡°íšŒ (ZSET)
âœ… Lua Script (ì›ìì„±)
âœ… TTL ìë™ ë§Œë£Œ
âœ… Cluster Mode (í™•ì¥ì„±)
âœ… Read Replica (ì½ê¸° ë¶„ì‚°)


ë‹¤ë¥¸ ì„ íƒì§€ëŠ”?
âŒ DynamoDB: ì½ê¸°/ì“°ê¸° ë¹„ìš© ë†’ìŒ, ì¡°íšŒ ëŠë¦¼
âŒ PostgreSQL: ë™ì‹œì„± ì œì–´ ì–´ë ¤ì›€, í™•ì¥ì„± ë¶€ì¡±
âŒ In-Memory: ë¶„ì‚° í™˜ê²½ ì§€ì› ì•ˆë¨, ë°ì´í„° ìœ ì‹¤
```

### ë©˜íŠ¸

ê·¸ë ‡ë‹¤ë©´, ì™œ Redisë¥¼ ì„ íƒí–ˆì„ê¹Œìš”?

ëŒ€ê¸°ì—´ ê´€ë¦¬ì— í•„ìš”í•œ ê²ƒë“¤ì„ ë‚˜ì—´í•´ ë´¤ìŠµë‹ˆë‹¤.
- **ë¹ ë¥¸ ì¡°íšŒ**: ì‚¬ìš©ìëŠ” 5ì´ˆë§ˆë‹¤ ìˆœë²ˆì„ ì¡°íšŒí•©ë‹ˆë‹¤. ms ë‹¨ìœ„ ì‘ë‹µ í•„ìš”.
- **ìˆœì„œ ë³´ì¥**: ë¨¼ì € ì˜¨ ì‚¬ëŒì´ ë¨¼ì € ë“¤ì–´ê°€ì•¼ í•©ë‹ˆë‹¤.
- **ì›ìì  ì—°ì‚°**: ë™ì‹œì— ì—¬ëŸ¬ ëª…ì´ ë“¤ì–´ì™€ë„, ìˆœì„œê°€ ê¼¬ì´ë©´ ì•ˆ ë©ë‹ˆë‹¤.
- **TTL ìë™ ê´€ë¦¬**: ë¹„í™œì„± ì‚¬ìš©ìëŠ” ìë™ìœ¼ë¡œ ì œê±°ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
- **ë¶„ì‚° í™˜ê²½**: Gateway ì¸ìŠ¤í„´ìŠ¤ê°€ ì—¬ëŸ¬ ê°œì—¬ë„ ì‘ë™í•´ì•¼ í•©ë‹ˆë‹¤.

RedisëŠ” ì´ ëª¨ë“  ìš”êµ¬ì‚¬í•­ì„ ë§Œì¡±í•©ë‹ˆë‹¤.
- **ZSET**: O(log N) ì¡°íšŒ, ìˆœì„œ ë³´ì¥
- **Lua Script**: ì›ìì  ì—°ì‚° (ACID ë³´ì¥)
- **TTL**: ìë™ ë§Œë£Œ ì²˜ë¦¬
- **Cluster Mode**: ìƒ¤ë“œ ë¶„ì‚°ìœ¼ë¡œ í™•ì¥ì„±
- **Read Replica**: ì½ê¸° ë¶€í•˜ ë¶„ì‚°

**ë‹¤ë¥¸ ì„ íƒì§€ëŠ” ì—†ì—ˆë‚˜ìš”?**

**DynamoDB?**
- ì“°ê¸° ë¹„ìš©ì´ ë„ˆë¬´ ë†’ìŠµë‹ˆë‹¤ (30ë§Œ ê±´ ì“°ê¸° = $$$$)
- ì½ê¸°ë„ ëŠë¦½ë‹ˆë‹¤ (ìˆ˜ì‹­ ms)
- ìˆœì„œ ë³´ì¥ì´ ì–´ë µìŠµë‹ˆë‹¤

**PostgreSQL?**
- ë™ì‹œì„± ì œì–´ê°€ ì–´ë µìŠµë‹ˆë‹¤ (Lock ê²½í•©)
- í™•ì¥ì„±ì´ ë¶€ì¡±í•©ë‹ˆë‹¤ (ìˆ˜ì§ í™•ì¥ë§Œ ê°€ëŠ¥)

**In-Memory (map)?**
- ë¶„ì‚° í™˜ê²½ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤
- ì¸ìŠ¤í„´ìŠ¤ê°€ ì£½ìœ¼ë©´ ë°ì´í„° ìœ ì‹¤

**ê²°ë¡ : Redisê°€ ìµœì ì´ì—ˆìŠµë‹ˆë‹¤.**

---

## ğŸ“œ 1.5 ì„¤ê³„ êµ¬ì¡° ë° ìš©ëŸ‰ ì‚°ì •

### ìŠ¬ë¼ì´ë“œ
```
"Gateway + Redis ì•„í‚¤í…ì²˜"

Browser (30ë§Œ ëª…)
    â†“
    â†“ Queue API (ëŒ€ê¸°ì—´)
    â†“ - Join: ëŒ€ê¸°ì—´ ì°¸ì—¬
    â†“ - Status: ìˆœë²ˆ ì¡°íšŒ (5ì´ˆë§ˆë‹¤)
    â†“ - Enter: ì…ì¥ ì‹œë„
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Gateway API (Go + Fiber)       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Redis (ElastiCache)     â”‚   â”‚
â”‚  â”‚  - ZSET: ìˆœì„œ ê´€ë¦¬       â”‚   â”‚
â”‚  â”‚  - Lua: ì›ìì  ì—°ì‚°      â”‚   â”‚
â”‚  â”‚  - TTL: ìë™ ë§Œë£Œ        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                  â”‚
â”‚  ì…ì¥ ì œì–´ (1,000 RPS)          â”‚ â† ì™œ 1,000 RPS?
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
    â†“ ì…ì¥ í—ˆìš©ëœ ì‚¬ìš©ìë§Œ í†µê³¼
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend Services               â”‚
â”‚  - Reservation API (ì˜ˆì•½)       â”‚
â”‚  - Inventory API (ì¬ê³ )         â”‚
â”‚  - Payment API (ê²°ì œ)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
DynamoDB (ì˜êµ¬ ì €ì¥)
```

### ë©˜íŠ¸

ìš°ë¦¬ê°€ ì„¤ê³„í•œ ì•„í‚¤í…ì²˜ì…ë‹ˆë‹¤.

**Browser (30ë§Œ ëª…)**
- í‹°ì¼“íŒ… ì˜¤í”ˆ ì‹œ ëŒ€ê¸°
- 5ì´ˆë§ˆë‹¤ ìì‹ ì˜ ìˆœë²ˆ ì¡°íšŒ (Polling)
- ìˆœë²ˆì´ ë˜ë©´ ì…ì¥ ì‹œë„

**Gateway API (Go + Fiber)**
- Queue API ì œê³µ:
  - `POST /queue/join`: ëŒ€ê¸°ì—´ ì°¸ì—¬
  - `GET /queue/status`: ìˆœë²ˆ ì¡°íšŒ
  - `POST /queue/enter`: ì…ì¥ ì‹œë„
- Redisë¡œ ëŒ€ê¸°ì—´ ê´€ë¦¬
- ì…ì¥ ì œì–´: ì´ˆë‹¹ 1,000ëª…ë§Œ í—ˆìš©

**Redis (ElastiCache)**
- **ZSET**: ëŒ€ê¸°ì—´ ìˆœì„œ ê´€ë¦¬ (timestamp ê¸°ë°˜)
- **Lua Script**: ì›ìì  Enqueue/Dequeue
- **TTL**: ë¹„í™œì„± ì‚¬ìš©ì ìë™ ì œê±° (Heartbeat ê¸°ë°˜)

**Backend Services**
- ì…ì¥ í—ˆìš©ëœ ì‚¬ìš©ìë§Œ ì ‘ê·¼ ê°€ëŠ¥
- Reservation API: ì˜ˆì•½ ìƒì„± ë° ê´€ë¦¬
- Inventory API: ì¬ê³  ì°¨ê° (ì˜¤ë²„ì…€ ë°©ì§€)
- Payment API: ê²°ì œ ì²˜ë¦¬

**DynamoDB**
- ì˜ˆì•½/ì£¼ë¬¸ ë°ì´í„° ì˜êµ¬ ì €ì¥
- ì“°ê¸°ëŠ” ì´ˆë‹¹ 1,000ê±´ë§Œ (Gateway ì œì–´ ë•ë¶„)

**í•µì‹¬ ì•„ì´ë””ì–´:**
Gateway + Redisê°€ **ë°©íŒŒì œ** ì—­í• ì„ í•©ë‹ˆë‹¤.
30ë§Œ ëª…ì˜ íŠ¸ë˜í”½ì„ ë°›ì•„ë‚´ê³ ,
ë’·ë‹¨ì€ ì•ˆì „í•˜ê²Œ ë³´í˜¸ë©ë‹ˆë‹¤.

---

## ğŸ“œ 1.6 ì™œ 1,000 RPSë¡œ ì…ì¥ ì œì–´ë¥¼ í–ˆëŠ”ê°€?

### ìŠ¬ë¼ì´ë“œ
```
"ì…ì¥ ì œì–´ ìš©ëŸ‰ ì‚°ì •"

ì§ˆë¬¸: "ì™œ í•˜í•„ 1,000 RPSì¸ê°€?"

ìš©ëŸ‰ ì‚°ì • ê³¼ì •:

1ï¸âƒ£ ì¢Œì„ ìˆ˜ ê¸°ì¤€
   - í‹°ì¼“: 10,000ì„
   - íŒë§¤ ì‹œê°„: 30ë¶„ ì´ë‚´ ëª©í‘œ
   - í•„ìš” ì²˜ë¦¬ëŸ‰: 10,000ì„ Ã· 1,800ì´ˆ = 5.5 RPS
   â†’ ë„ˆë¬´ ëŠë¦¼ âŒ

2ï¸âƒ£ ì‚¬ìš©ì ê²½í—˜ ê¸°ì¤€
   - 30ë§Œ ëª… ëŒ€ê¸°
   - í‰ê·  ëŒ€ê¸° ì‹œê°„: 5ë¶„ ì´ë‚´ ëª©í‘œ
   - í•„ìš” ì²˜ë¦¬ëŸ‰: 300,000ëª… Ã· 300ì´ˆ = 1,000 RPS
   â†’ ì ì ˆí•¨ âœ…

3ï¸âƒ£ Backend ì²˜ë¦¬ ëŠ¥ë ¥ ê²€ì¦
   - Reservation API: 3,000 RPS ê°€ëŠ¥ (ë¶€í•˜ í…ŒìŠ¤íŠ¸ ê²°ê³¼)
   - Inventory API: 5,000 RPS ê°€ëŠ¥ (gRPC ê³ ì„±ëŠ¥)
   - DynamoDB: On-demand ëª¨ë“œ (ë¬´ì œí•œ)
   â†’ 1,000 RPSëŠ” ì—¬ìœ ë¡œì›€ âœ…

4ï¸âƒ£ ë¹„ìš© ê³ ë ¤
   - DynamoDB ì“°ê¸°: $1.25 per 1M writes
   - 1,000 RPS = 3,600,000 writes/hour
   - 30ë¶„ = 1,800,000 writes = $2.25
   â†’ ê°ë‹¹ ê°€ëŠ¥ âœ…

ê²°ë¡ : 1,000 RPSê°€ ìµœì !
```

### ë©˜íŠ¸

ì—¬ê¸°ì„œ ì¤‘ìš”í•œ ì§ˆë¬¸ì´ í•˜ë‚˜ ìˆìŠµë‹ˆë‹¤.
**"ì™œ í•˜í•„ 1,000 RPSë¡œ ì…ì¥ ì œì–´ë¥¼ í–ˆëŠ”ê°€?"**

ì´ ìˆ«ìëŠ” ì•„ë¬´ë ‡ê²Œë‚˜ ì •í•œ ê²Œ ì•„ë‹™ë‹ˆë‹¤.
ìš©ëŸ‰ ì‚°ì • ê³¼ì •ì„ ê±°ì³¤ìŠµë‹ˆë‹¤.

**ì²«ì§¸, ì¢Œì„ ìˆ˜ ê¸°ì¤€ìœ¼ë¡œ ê³„ì‚°í–ˆìŠµë‹ˆë‹¤.**
- í‹°ì¼“: 10,000ì„
- íŒë§¤ ì‹œê°„: 30ë¶„ ì´ë‚´ ëª©í‘œ
- í•„ìš” ì²˜ë¦¬ëŸ‰: 10,000ì„ Ã· 1,800ì´ˆ = **5.5 RPS**

í•˜ì§€ë§Œ ì´ê±´ ë„ˆë¬´ ëŠë¦½ë‹ˆë‹¤.
30ë§Œ ëª…ì´ 5ë¶„ ë„˜ê²Œ ê¸°ë‹¤ë ¤ì•¼ í•©ë‹ˆë‹¤.
ì‚¬ìš©ì ê²½í—˜ì´ ë‚˜ì©ë‹ˆë‹¤.

**ë‘˜ì§¸, ì‚¬ìš©ì ê²½í—˜ ê¸°ì¤€ìœ¼ë¡œ ê³„ì‚°í–ˆìŠµë‹ˆë‹¤.**
- 30ë§Œ ëª…ì´ ëŒ€ê¸° ì¤‘
- í‰ê·  ëŒ€ê¸° ì‹œê°„: 5ë¶„ ì´ë‚´ ëª©í‘œ
- í•„ìš” ì²˜ë¦¬ëŸ‰: 300,000ëª… Ã· 300ì´ˆ = **1,000 RPS**

ì´ê²Œ ë” í•©ë¦¬ì ì…ë‹ˆë‹¤.
5ë¶„ì´ë©´ ì‚¬ìš©ìê°€ ê²¬ë”œ ë§Œí•œ ì‹œê°„ì…ë‹ˆë‹¤.

**ì…‹ì§¸, Backendê°€ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ”ì§€ ê²€ì¦í–ˆìŠµë‹ˆë‹¤.**
- **Reservation API**: ì‚¬ì „ ë¶€í•˜ í…ŒìŠ¤íŠ¸ ê²°ê³¼ 3,000 RPS ê°€ëŠ¥
- **Inventory API**: gRPC ê³ ì„±ëŠ¥ìœ¼ë¡œ 5,000 RPS ê°€ëŠ¥
- **DynamoDB**: On-demand ëª¨ë“œë¡œ ë¬´ì œí•œ í™•ì¥ ê°€ëŠ¥

1,000 RPSëŠ” Backend ì…ì¥ì—ì„œ ë§¤ìš° ì—¬ìœ ë¡­ìŠµë‹ˆë‹¤.
30% ìˆ˜ì¤€ì˜ ë¶€í•˜ì…ë‹ˆë‹¤.

**ë„·ì§¸, ë¹„ìš©ì„ ê³ ë ¤í–ˆìŠµë‹ˆë‹¤.**
- DynamoDB ì“°ê¸° ë¹„ìš©: $1.25 per 1M writes
- 1,000 RPS = 3,600,000 writes/hour
- 30ë¶„ í‹°ì¼“íŒ… = 1,800,000 writes = **$2.25**

ê°ë‹¹ ê°€ëŠ¥í•œ ë¹„ìš©ì…ë‹ˆë‹¤.

**ê²°ë¡ :**
1,000 RPSê°€ **ì‚¬ìš©ì ê²½í—˜, Backend ìš©ëŸ‰, ë¹„ìš©** ì¸¡ë©´ì—ì„œ ìµœì ì˜ ê· í˜•ì ì´ì—ˆìŠµë‹ˆë‹¤.

ì´ ìˆ«ì í•˜ë‚˜ë¥¼ ì •í•˜ëŠ” ë°ë„,
ì´ë ‡ê²Œ ë§ì€ ê³ ë¯¼ì´ ë“¤ì–´ê°‘ë‹ˆë‹¤.

---

## ğŸ“œ 1.7 Redis ì¸ìŠ¤í„´ìŠ¤ ì„ ì •

### ìŠ¬ë¼ì´ë“œ
```
"ElastiCache ì¸ìŠ¤í„´ìŠ¤ í¬ê¸° ê²°ì •"

ì§ˆë¬¸: "ì–´ë–¤ Redis ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì¨ì•¼ í•˜ë‚˜?"

ê³ ë ¤ ì‚¬í•­:

1ï¸âƒ£ ë©”ëª¨ë¦¬ ìš”êµ¬ëŸ‰
   - ëŒ€ê¸°ì—´ ë°ì´í„°: 30ë§Œ ëª… Ã— 1KB = 300MB
   - ì¸ë±ìŠ¤ ë°ì´í„°: ZSET Ã— 5 = 150MB
   - ë²„í¼: 2ë°° ì—¬ìœ  = 900MB
   â†’ ìµœì†Œ 2GB ì´ìƒ í•„ìš”

2ï¸âƒ£ ë„¤íŠ¸ì›Œí¬ ì²˜ë¦¬ëŸ‰
   - Status API: 30ë§Œ ëª… Ã— 0.2 RPS = 60k RPS
   - ê° ìš”ì²­: 1KB ì‘ë‹µ
   - í•„ìš” ëŒ€ì—­í­: 60MB/s
   â†’ ë„¤íŠ¸ì›Œí¬ ì„±ëŠ¥ ì¤‘ìš”

3ï¸âƒ£ CPU ì²˜ë¦¬ ëŠ¥ë ¥
   - ZRANK ì—°ì‚°: O(log N)
   - 60k RPS Ã— 0.01ms = 600ms CPU
   â†’ ë©€í‹° ì½”ì–´ í•„ìš”

4ï¸âƒ£ ê°€ìš©ì„± ë° í™•ì¥ì„±
   - Cluster Mode: 5 shards (ë°ì´í„° ë¶„ì‚°)
   - Read Replica: ê° ìƒ¤ë“œë‹¹ 1ê°œ (ì½ê¸° ë¶„ì‚°)
   - ì´ 10 nodes
   â†’ ê³ ê°€ìš©ì„± + ì„±ëŠ¥

ì„ íƒ: cache.m7g.xlarge (4 vCPU, 13GB RAM)
       Ã— 5 shards Ã— 2 (replica) = 10 nodes
```

### ë©˜íŠ¸

ì•„í‚¤í…ì²˜ë¥¼ ì„¤ê³„í–ˆìœ¼ë‹ˆ, ì´ì œ ì‹¤ì œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤.

**"ì–´ë–¤ Redis ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì¨ì•¼ í•˜ë‚˜?"**

**ì²«ì§¸, ë©”ëª¨ë¦¬ ìš”êµ¬ëŸ‰ì„ ê³„ì‚°í–ˆìŠµë‹ˆë‹¤.**
- ëŒ€ê¸°ì—´ ë°ì´í„°: 30ë§Œ ëª… Ã— 1KB (í† í° + ë©”íƒ€ë°ì´í„°) = 300MB
- Position Index: ZSET êµ¬ì¡° Ã— 5ê°œ ì´ë²¤íŠ¸ = 150MB
- ë²„í¼ ë° ê¸°íƒ€: 2ë°° ì—¬ìœ ë¶„ = 450MB
- ì´í•©: ì•½ 900MB

ìµœì†Œ 2GB ì´ìƒì˜ ë©”ëª¨ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.

**ë‘˜ì§¸, ë„¤íŠ¸ì›Œí¬ ì²˜ë¦¬ëŸ‰ì„ ê³„ì‚°í–ˆìŠµë‹ˆë‹¤.**
- Status API: 30ë§Œ ëª…ì´ 5ì´ˆë§ˆë‹¤ ì¡°íšŒ = 60k RPS
- ê° ìš”ì²­ë‹¹ ì‘ë‹µ: ì•½ 1KB (ìˆœë²ˆ + ë©”íƒ€ë°ì´í„°)
- í•„ìš” ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­í­: 60MB/s

ë„¤íŠ¸ì›Œí¬ ì„±ëŠ¥ì´ ì¤‘ìš”í•©ë‹ˆë‹¤.

**ì…‹ì§¸, CPU ì²˜ë¦¬ ëŠ¥ë ¥ì„ ì˜ˆì¸¡í–ˆìŠµë‹ˆë‹¤.**
- ZRANK ì—°ì‚°: O(log N) = log(300,000) â‰ˆ 18 ë¹„êµ
- 60k RPS Ã— 0.01ms = 600ms CPU ì‹œê°„/ì´ˆ
- ë©€í‹° ì½”ì–´ê°€ í•„ìš”í•©ë‹ˆë‹¤

**ë„·ì§¸, ê°€ìš©ì„±ê³¼ í™•ì¥ì„±ì„ ê³ ë ¤í–ˆìŠµë‹ˆë‹¤.**
- **Cluster Mode**: 5ê°œ ìƒ¤ë“œë¡œ ë°ì´í„° ë¶„ì‚°
  - ê° ìƒ¤ë“œ: 60MB ë©”ëª¨ë¦¬, 12k RPS ì²˜ë¦¬
- **Read Replica**: ê° ìƒ¤ë“œë‹¹ 1ê°œ ë³µì œë³¸
  - ì½ê¸° ë¶€í•˜ ë¶„ì‚°
  - ì¥ì•  ëŒ€ì‘ (ìë™ failover)
- **ì´ 10 nodes**: 5 primary + 5 replica

**ì„ íƒ: cache.m7g.xlarge**
- vCPU: 4 (ì¶©ë¶„í•œ ì²˜ë¦¬ ëŠ¥ë ¥)
- ë©”ëª¨ë¦¬: 13GB (ì—¬ìœ ë¡­ê²Œ)
- ë„¤íŠ¸ì›Œí¬: ìµœëŒ€ 12.5 Gbps (125MB/s)
- ARM64 Graviton: ë¹„ìš© íš¨ìœ¨ì 

**êµ¬ì„±: 5 shards Ã— 2 (primary + replica) = 10 nodes**

ì´ êµ¬ì„±ìœ¼ë¡œ 60k RPS Status APIë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ê·¸ë¦¬ê³  ì‹¤ì œë¡œëŠ”... 30k RPSë„ ì¶©ë¶„í•©ë‹ˆë‹¤.

---

## ğŸ“œ 1.8 ì´ˆê¸° êµ¬í˜„ ë° í…ŒìŠ¤íŠ¸

### ìŠ¬ë¼ì´ë“œ
```
"1ì°¨ ë¶€í•˜ í…ŒìŠ¤íŠ¸: 1,000 RPS"

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Component       â”‚ CPU  â”‚ Result â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Gateway API     â”‚ 5%   â”‚ âœ…      â”‚
â”‚ Redis           â”‚ 10%  â”‚ âœ…      â”‚
â”‚ Reservation API â”‚ 3%   â”‚ âœ…      â”‚
â”‚ DynamoDB        â”‚ 5%   â”‚ âœ…      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ëª¨ë“  ì»´í¬ë„ŒíŠ¸: ì—¬ìœ ë¡œì›€
ê²°ë¡ : ì•„í‚¤í…ì²˜ê°€ ì‘ë™í•œë‹¤! ğŸ‰

ë‹¤ìŒ ëª©í‘œ: 10,000 RPS
```

### ë©˜íŠ¸

ì´ˆê¸° êµ¬í˜„ì„ ë§ˆì¹˜ê³ , ì²« ë¶€í•˜ í…ŒìŠ¤íŠ¸ë¥¼ ëŒë ¸ìŠµë‹ˆë‹¤.
**1,000 RPS**ë¡œ ì‹œì‘í–ˆìŠµë‹ˆë‹¤.

ê²°ê³¼ëŠ” ì™„ë²½í–ˆìŠµë‹ˆë‹¤.
- Gateway API: CPU 5%
- Redis: CPU 10%
- Reservation API: CPU 3%
- DynamoDB: ì“°ê¸° 5%

ëª¨ë“  ì»´í¬ë„ŒíŠ¸ê°€ ì—¬ìœ ë¡œì› ìŠµë‹ˆë‹¤.

"**ì¢‹ì•„, ì•„í‚¤í…ì²˜ê°€ ì‘ë™í•œë‹¤!**"

ì´ì œ ëª©í‘œëŠ” **10,000 RPS**ì…ë‹ˆë‹¤.
ì ì§„ì ìœ¼ë¡œ ë¶€í•˜ë¥¼ ì˜¬ë ¤ë³´ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.

---

## ğŸ“œ 1.9 10k RPSì—ì„œ ë³‘ëª© ë°œê²¬

### ìŠ¬ë¼ì´ë“œ
```
"10,000 RPS ë¶€í•˜ í…ŒìŠ¤íŠ¸ ê²°ê³¼"

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Component          â”‚ CPU    â”‚ Status   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Gateway API        â”‚ 15%    â”‚ âœ… OK     â”‚
â”‚ Reservation API    â”‚ 5%     â”‚ âœ… OK     â”‚
â”‚ Inventory API      â”‚ 3%     â”‚ âœ… OK     â”‚
â”‚ Payment API        â”‚ 2%     â”‚ âœ… OK     â”‚
â”‚ DynamoDB          â”‚ 10%    â”‚ âœ… OK     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ElastiCache Redis  â”‚ 100%   â”‚ ğŸ”´ ë³‘ëª©!  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì˜ˆìƒ: "Gatewayê°€ í„°ì§ˆ ì¤„ ì•Œì•˜ëŠ”ë°..."
ì‹¤ì œ: "Redisê°€ í„°ì¡Œë„¤?"


ì™œ? ğŸ¤”
```

### ë©˜íŠ¸

ë¶€í•˜ë¥¼ 10,000 RPSë¡œ ì˜¬ë ¸ìŠµë‹ˆë‹¤.

ê·¸ë¦¬ê³  ëª¨ë‹ˆí„°ë§ì„ í™•ì¸í•˜ëŠ” ìˆœê°„,
ì˜ˆìƒê³¼ ë‹¤ë¥¸ ê²°ê³¼ë¥¼ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.

**Gateway API**: CPU 15% - ì—¬ì „íˆ ì—¬ìœ ë¡­ìŠµë‹ˆë‹¤.
**Reservation API**: CPU 5% - ë†€ê³  ìˆìŠµë‹ˆë‹¤.
**Inventory API**: CPU 3% - ë” ë†€ê³  ìˆìŠµë‹ˆë‹¤.
**DynamoDB**: 10% - ë¬¸ì œì—†ìŠµë‹ˆë‹¤.

ê·¸ëŸ°ë° ë”± í•˜ë‚˜,
**ElastiCache Redis: CPU 100%** ğŸ”´

ì˜ˆìƒí–ˆë˜ ê²ƒê³¼ ë‹¬ëìŠµë‹ˆë‹¤.
ìš°ë¦¬ëŠ” "Gatewayê°€ í„°ì§ˆ ì¤„" ì•Œì•˜ìŠµë‹ˆë‹¤.
í•˜ì§€ë§Œ í„°ì§„ ê±´ Redisì˜€ìŠµë‹ˆë‹¤.

**ì™œ ì´ëŸ° ì¼ì´ ë²Œì–´ì§„ ê±¸ê¹Œìš”?**

Gatewayì— ë¶€í•˜ë¥¼ ì§‘ì¤‘ì‹œí‚¤ëŠ” ì„¤ê³„ì˜€ìœ¼ë‹ˆ,
Redisì— ë¶€í•˜ê°€ ì§‘ì¤‘ë˜ëŠ” ê±´ ì–´ì©Œë©´ ë‹¹ì—°í•œ ê²°ê³¼ì˜€ìŠµë‹ˆë‹¤.

í•˜ì§€ë§Œ **10,000 RPSì—ì„œ ì´ë¯¸ í•œê³„**ë¼ë‹ˆ,
30,000 RPS ëª©í‘œëŠ” ìš”ì›í•´ ë³´ì˜€ìŠµë‹ˆë‹¤.

**ë¬¸ì œë¥¼ ì°¾ì•„ì•¼ í–ˆìŠµë‹ˆë‹¤.**

---

## ğŸ“œ 1.10 ë³‘ëª©ì˜ ê·¼ë³¸ ì›ì¸ (ê´€ì¸¡ì„±)

### ìŠ¬ë¼ì´ë“œ
```
"Redis CPU 100%, ì™œ?"

CloudWatch ë©”íŠ¸ë¦­ ë¶„ì„:
â”œâ”€ CommandsProcessed: ì´ˆë‹¹ 10ë§Œ+ ê±´
â”œâ”€ NetworkBytesIn: ë¹„ì •ìƒì ìœ¼ë¡œ ë†’ìŒ
â””â”€ EngineCPUUtilization: ì§€ì†ì  100%

pprof í”„ë¡œíŒŒì¼ë§:
â”œâ”€ calculateGlobalPosition() í•¨ìˆ˜
â”œâ”€ Redis KEYS ëª…ë ¹ì–´ í˜¸ì¶œ
â””â”€ ì´ˆë‹¹ 10,000ë²ˆ ì‹¤í–‰!


Redis KEYS ëª…ë ¹ì–´:
âŒ O(N) ì‹œê°„ ë³µì¡ë„ (ëª¨ë“  í‚¤ ìŠ¤ìº”)
âŒ Blocking operation (ë‹¤ë¥¸ ëª…ë ¹ì–´ ëŒ€ê¸°)
âŒ Cluster Modeì—ì„œ ëª¨ë“  ìƒ¤ë“œ ìŠ¤ìº”
âŒ 10k RPS = ì´ˆë‹¹ 1ë§Œë²ˆ KEYS ì‹¤í–‰!


ë²”ì¸: Status API
```

### ë©˜íŠ¸

Redis CPU 100%ì˜ ì›ì¸ì„ ì°¾ì•„ì•¼ í–ˆìŠµë‹ˆë‹¤.

**ì²« ë²ˆì§¸ ë‹¨ê³„: CloudWatch ë©”íŠ¸ë¦­ ë¶„ì„**

AWS ì½˜ì†”ì—ì„œ ë‹¤ìŒê³¼ ê°™ì´ í™•ì¸í–ˆìŠµë‹ˆë‹¤:

```
AWS Console â†’ ElastiCache â†’ Redis Clusters
â†’ traffic-tacos-redis í´ë¦­
â†’ CloudWatch Metrics íƒ­
```

í™•ì¸í•œ ì£¼ìš” ë©”íŠ¸ë¦­:
- `EngineCPUUtilization`: **ì§€ì†ì ìœ¼ë¡œ 100%** ğŸ”´
  - ì •ìƒ: 60% ì´í•˜
  - í˜„ì¬: 100% ìœ ì§€ (ìœ„í—˜!)

- `CommandsProcessed`: **ì´ˆë‹¹ 10ë§Œ+ ê±´**
  - ì •ìƒ: 3-5ë§Œ ê±´
  - í˜„ì¬: 10ë§Œ ê±´ ì´ìƒ (ë¹„ì •ìƒì ìœ¼ë¡œ ë§ìŒ)

- `NetworkBytesIn`: **ë¹„ì •ìƒì ìœ¼ë¡œ ë†’ìŒ**
  - ì •ìƒ: ìˆ˜ MB/s
  - í˜„ì¬: ìˆ˜ì‹­ MB/s (ë°ì´í„° ì „ì†¡ ê³¼ë‹¤)

ì´ ë©”íŠ¸ë¦­ë“¤ì´ ë§í•´ì£¼ëŠ” ê²ƒ:
"Redisê°€ ë„ˆë¬´ ë§ì€ ëª…ë ¹ì–´ë¥¼ ì²˜ë¦¬í•˜ê³  ìˆë‹¤"
"íŠ¹ì • ëª…ë ¹ì–´ê°€ ê³¼ë„í•˜ê²Œ ì‹¤í–‰ë˜ê³  ìˆë‹¤"

**ë‘ ë²ˆì§¸ ë‹¨ê³„: pprof í”„ë¡œíŒŒì¼ë§**

CloudWatchëŠ” "ë¬´ì—‡ì´ ë¬¸ì œì¸ì§€"ëŠ” ì•Œë ¤ì£¼ì§€ ì•ŠìŠµë‹ˆë‹¤.
"ì–´ë””ì„œ ë¬¸ì œê°€ ë°œìƒí•˜ëŠ”ì§€" ì°¾ì•„ì•¼ í–ˆìŠµë‹ˆë‹¤.

Go ì• í”Œë¦¬ì¼€ì´ì…˜ì—ëŠ” `pprof`ë¼ëŠ” ê°•ë ¥í•œ í”„ë¡œíŒŒì¼ë§ ë„êµ¬ê°€ ë‚´ì¥ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

```go
// cmd/gateway/main.go
import "github.com/gofiber/fiber/v2/middleware/pprof"

app.Use(pprof.New())
```

ì´ë ‡ê²Œ ì„¤ì •í•˜ë©´, `/debug/pprof/` ì—”ë“œí¬ì¸íŠ¸ë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**í”„ë¡œíŒŒì¼ë§ ì‹¤í–‰:**
```bash
# CPU í”„ë¡œíŒŒì¼ 30ì´ˆê°„ ìˆ˜ì§‘
curl http://gateway-api:8000/debug/pprof/profile?seconds=30 > cpu.prof

# í”„ë¡œíŒŒì¼ ë¶„ì„ (top í•¨ìˆ˜ë“¤)
go tool pprof -top cpu.prof

# ì›¹ UIë¡œ ë³´ê¸°
go tool pprof -http=:8080 cpu.prof
```

**ë¶„ì„ ê²°ê³¼:**
```
Showing nodes accounting for 3.5s, 85% of 4.1s total
      flat  flat%   sum%        cum   cum%
     2.1s 51.22% 51.22%      2.5s 60.98%  calculateGlobalPosition
     0.8s 19.51% 70.73%      0.9s 21.95%  redis.Keys
     0.3s  7.32% 78.05%      0.4s  9.76%  redis.XLen
     ...
```

ë²”ì¸ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤!
```go
// internal/queue/streams.go
func (sq *StreamQueue) calculateGlobalPosition(...) int {
    pattern := fmt.Sprintf("stream:event:{%s}:user:*", eventID)
    keys, err := sq.redis.Keys(ctx, pattern).Result() // ğŸ”´ ë²”ì¸!
    // ...
}
```

**`calculateGlobalPosition()` í•¨ìˆ˜ê°€ CPUì˜ 51%ë¥¼ ì°¨ì§€**í•˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤.
ê·¸ë¦¬ê³  ê·¸ ì•ˆì—ì„œ `redis.Keys()` í˜¸ì¶œì´ ëŒ€ë¶€ë¶„ì˜ ì‹œê°„ì„ ì†Œë¹„í–ˆìŠµë‹ˆë‹¤.

ì´ í•¨ìˆ˜ëŠ” **Status API**ì—ì„œ í˜¸ì¶œë©ë‹ˆë‹¤.

**Status API**ëŠ” ì‚¬ìš©ìê°€ ìì‹ ì˜ ìˆœë²ˆì„ ì¡°íšŒí•˜ëŠ” APIì…ë‹ˆë‹¤.
- ì‚¬ìš©ìëŠ” 5ì´ˆë§ˆë‹¤ í´ë§í•©ë‹ˆë‹¤
- 1ë§Œ ëª…ì´ ëŒ€ê¸° ì¤‘ì´ë©´? â†’ ì´ˆë‹¹ 2,000ê±´ì˜ Status API í˜¸ì¶œ
- 10ë§Œ ëª…ì´ ëŒ€ê¸° ì¤‘ì´ë©´? â†’ ì´ˆë‹¹ 20,000ê±´!

ê·¸ë¦¬ê³  ì´ í•¨ìˆ˜ê°€ **`KEYS` ëª…ë ¹ì–´**ë¥¼ ì‚¬ìš©í•˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤.

**`KEYS` ëª…ë ¹ì–´ì˜ ë¬¸ì œì :**
- **O(N) ì‹œê°„ ë³µì¡ë„**: ëª¨ë“  í‚¤ë¥¼ ìŠ¤ìº”í•©ë‹ˆë‹¤
- **Blocking operation**: ì‹¤í–‰ ì¤‘ ë‹¤ë¥¸ ëª…ë ¹ì–´ë¥¼ ë§‰ìŠµë‹ˆë‹¤
- **Cluster Mode**: ëª¨ë“  ìƒ¤ë“œë¥¼ ìŠ¤ìº”í•©ë‹ˆë‹¤
- **í”„ë¡œë•ì…˜ ê¸ˆì§€**: Redis ê³µì‹ ë¬¸ì„œì—ì„œë„ ì‚¬ìš© ê¸ˆì§€

10,000 RPS Status APIë©´,
**ì´ˆë‹¹ 10,000ë²ˆì˜ KEYS ëª…ë ¹ì–´**ê°€ ì‹¤í–‰ë˜ëŠ” ê²ë‹ˆë‹¤.

Redisê°€ ë²„í‹¸ ìˆ˜ ì—†ì—ˆì£ .

**ì™œ ì´ëŸ° ì½”ë“œë¥¼ ì§°ì„ê¹Œìš”?**
ì´ˆê¸°ì—ëŠ” "ë¹¨ë¦¬ ë§Œë“¤ì"ì— ì§‘ì¤‘í–ˆê³ ,
ì„±ëŠ¥ ìµœì í™”ëŠ” ë‚˜ì¤‘ì— í•˜ë ¤ê³  í–ˆìŠµë‹ˆë‹¤.
í•˜ì§€ë§Œ 10k RPSì—ì„œ ì´ë¯¸ í•œê³„ì— ë„ë‹¬í–ˆìŠµë‹ˆë‹¤.

---

## ğŸ“œ 1.11 í•´ê²° ë°©ë²• - Position Index

### ìŠ¬ë¼ì´ë“œ
```
"KEYS ì œê±°, Index ë„ì…"

Before (KEYS scan):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Status API í˜¸ì¶œ                 â”‚
â”‚   â†“                             â”‚
â”‚ calculateGlobalPosition()       â”‚
â”‚   â†“                             â”‚
â”‚ KEYS stream:event:{evt}:user:*  â”‚
â”‚   â†“ O(N) = 10,000+ keys         â”‚
â”‚   â†“ ~100ms (blocking)           â”‚
â”‚   â†“ CPU 100% ğŸ’¥                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

After (Position Index):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Status API í˜¸ì¶œ                 â”‚
â”‚   â†“                             â”‚
â”‚ CalculateApproximatePosition()  â”‚
â”‚   â†“                             â”‚
â”‚ ZRANK queue:event:{evt}:positionâ”‚
â”‚   â†“ O(log N) = ~14 comparisons  â”‚
â”‚   â†“ <1ms (non-blocking)         â”‚
â”‚   â†“ CPU 40% âœ…                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì„±ëŠ¥ ê°œì„ : ~100ë°°!
```

### ë©˜íŠ¸

í•´ê²° ë°©ë²•ì€ ëª…í™•í–ˆìŠµë‹ˆë‹¤.
**KEYSë¥¼ ì—†ì• ê³ , ì¸ë±ìŠ¤ë¥¼ ë§Œë“¤ì.**

**Position Index**ë¼ëŠ” ê°œë…ì„ ë„ì…í–ˆìŠµë‹ˆë‹¤.
ZSET ê¸°ë°˜ì˜ ì¸ë±ìŠ¤ì…ë‹ˆë‹¤.

**ì‘ë™ ë°©ì‹:**

1. **Join ì‹œ (ëŒ€ê¸°ì—´ ì°¸ì—¬):**
   ```go
   // Position Indexì— ì¶”ê°€
   indexKey := "queue:event:{evt}:position"
   score := time.Now().UnixNano() // timestamp
   redis.ZAdd(ctx, indexKey, redis.Z{Score: score, Member: token})
   ```

2. **Status ì‹œ (ìˆœë²ˆ ì¡°íšŒ):**
   ```go
   // Position Indexì—ì„œ rank ì¡°íšŒ
   rank, err := redis.ZRank(ctx, indexKey, token).Result()
   position := int(rank) + 1 // 0-based â†’ 1-based
   ```

**ì‹œê°„ ë³µì¡ë„ ë¹„êµ:**
- `KEYS`: O(N) - 10,000 keysë©´ ~100ms
- `ZRANK`: O(log N) - 10,000 keysë©´ ~14 comparisons, <1ms

**100ë°° ë¹ ë¦…ë‹ˆë‹¤!**

ê·¸ë¦¬ê³  ë¬´ì—‡ë³´ë‹¤,
`ZRANK`ëŠ” **non-blocking**ì…ë‹ˆë‹¤.
ë‹¤ë¥¸ ëª…ë ¹ì–´ë¥¼ ë°©í•´í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

**êµ¬í˜„ í›„ í…ŒìŠ¤íŠ¸:**
- Redis CPU: 100% â†’ 40%
- Status API ì‘ë‹µ ì‹œê°„: 100ms â†’ <5ms
- ì²˜ë¦¬ëŸ‰: 10k RPS â†’ ì—¬ìœ ë¡œì›€

**ë“œë””ì–´ ë³‘ëª©ì„ í•´ê²°í–ˆìŠµë‹ˆë‹¤!**

---

## ğŸ“œ 1.12 ì¶”ê°€ ìµœì í™”ë“¤

### ìŠ¬ë¼ì´ë“œ
```
"ì„¸ë¶€ íŠœë‹"

3ê°€ì§€ ì¶”ê°€ ìµœì í™”:

1ï¸âƒ£ Redis Connection Pool
   PoolSize: 100 â†’ 1000
   PoolTimeout: 4s â†’ 10s
   â†’ ê³ ë¶€í•˜ì—ì„œ connection pool timeout ì œê±°

2ï¸âƒ£ Go ë©”ëª¨ë¦¬ ìµœì í™”
   GOMEMLIMIT=450MiB
   GOGC=75
   â†’ GC ì ê·¹ ì‹¤í–‰, HPA scale-down ì •ìƒí™”

3ï¸âƒ£ Readiness Probe ì¡°ì •
   initialDelaySeconds: 5 â†’ 15ì´ˆ
   â†’ Redis Cluster ì—°ê²° ëŒ€ê¸°
   â†’ Pod ì‹œì‘ ì•ˆì •í™”
```

### ë©˜íŠ¸

Position Indexë¡œ í° ë³‘ëª©ì„ í•´ê²°í–ˆì§€ë§Œ,
ì„¸ë¶€ íŠœë‹ì´ ë” í•„ìš”í–ˆìŠµë‹ˆë‹¤.

**ì²«ì§¸, Redis Connection Pool**

ê³ ë¶€í•˜ì—ì„œ `redis: connection pool timeout` ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.
- ê¸°ë³¸ Pool Sizeê°€ 100ìœ¼ë¡œ ë¶€ì¡±
- Timeoutì´ 4ì´ˆë¡œ ì§§ìŒ

**í•´ê²°:**
- `PoolSize: 1000` (10ë°° ì¦ê°€)
- `PoolTimeout: 10s` (2.5ë°° ì¦ê°€)
- `MinIdleConns: 100` (warm pool)

**ë‘˜ì§¸, Go ë©”ëª¨ë¦¬ ìµœì í™”**

í…ŒìŠ¤íŠ¸ í›„ì—ë„ ë©”ëª¨ë¦¬ê°€ í•´ì œë˜ì§€ ì•Šì•„,
HPAê°€ scale-downì„ ëª» í•˜ëŠ” ë¬¸ì œê°€ ìˆì—ˆìŠµë‹ˆë‹¤.

**í•´ê²°:**
- `GOMEMLIMIT=450MiB`: Go GCê°€ ë©”ëª¨ë¦¬ í•œê³„ ì¸ì‹
- `GOGC=75`: ë” ìì£¼ GC ì‹¤í–‰ (ê¸°ë³¸ê°’ 100)
- `GODEBUG=madvdontneed=1`: ë©”ëª¨ë¦¬ ì¦‰ì‹œ ë°˜í™˜

ê²°ê³¼: í…ŒìŠ¤íŠ¸ í›„ ë©”ëª¨ë¦¬ 200Mi â†’ 80Mi

**ì…‹ì§¸, Readiness Probe**

Pod ì‹œì‘ ì‹œ Redis Cluster ì—°ê²°ì— 10ì´ˆ ì •ë„ ê±¸ë¦¬ëŠ”ë°,
Readiness Probeê°€ 5ì´ˆë§Œ ê¸°ë‹¤ë¦¬ê³  NotReady íŒì •.

**í•´ê²°:**
- `initialDelaySeconds: 15ì´ˆ` (ì¶©ë¶„í•œ ëŒ€ê¸°)
- `periodSeconds: 5ì´ˆ` (ì²´í¬ ê°„ê²© ì™„í™”)
- `failureThreshold: 3` (ì‹¤íŒ¨ í—ˆìš© ì¦ê°€)

ê²°ê³¼: Rolling updateê°€ ë¶€ë“œëŸ½ê²Œ ì§„í–‰

---

## ğŸ“œ 1.13 ìµœì¢… ê²°ê³¼

### ìŠ¬ë¼ì´ë“œ
```
"30,000 RPS ë‹¬ì„±!"

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RPS     â”‚ Redis CPU â”‚ Result          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Before  (KEYS ì‚¬ìš©)                    â”‚
â”‚ 10k     â”‚ 100%      â”‚ âŒ í•œê³„ ë„ë‹¬     â”‚
â”‚ 15k+    â”‚ N/A       â”‚ âŒ ë¶ˆê°€ëŠ¥        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ After   (Position Index)               â”‚
â”‚ 10k     â”‚ 40%       â”‚ âœ… ì—¬ìœ           â”‚
â”‚ 20k     â”‚ 70%       â”‚ âœ… ì•ˆì •          â”‚
â”‚ 30k     â”‚ 90%       â”‚ âœ… ëª©í‘œ ë‹¬ì„±!    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì¶”ê°€ ë¹„ìš©: 0ì› (ì½”ë“œ ìµœì í™”ë§Œ)
ë…¸ë“œ ì¦ì„¤: ë¶ˆí•„ìš”
ElastiCache: cache.m7g.xlarge Ã— 10 nodes ìœ ì§€
```

### ë©˜íŠ¸

ìµœì¢… ë¶€í•˜ í…ŒìŠ¤íŠ¸ ê²°ê³¼ì…ë‹ˆë‹¤.

**ìµœì í™” ì „ (KEYS ì‚¬ìš©):**
- 10k RPS: Redis CPU 100% - í•œê³„ ë„ë‹¬
- 15k RPS ì´ìƒ: ë¶ˆê°€ëŠ¥

**ìµœì í™” í›„ (Position Index):**
- **10k RPS**: Redis CPU 40% - ì—¬ìœ ë¡­ìŠµë‹ˆë‹¤
- **20k RPS**: Redis CPU 70% - ì•ˆì •ì ì…ë‹ˆë‹¤
- **30k RPS**: Redis CPU 90% - **ëª©í‘œ ë‹¬ì„±!** ğŸ‰

ê·¸ë¦¬ê³  ë¬´ì—‡ë³´ë‹¤,
**ì¶”ê°€ ë¹„ìš©ì´ ë“¤ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.**

- Redis ë…¸ë“œ ì¦ì„¤? â†’ ë¶ˆí•„ìš”
- EKS ë…¸ë“œ ì¦ì„¤? â†’ ë¶ˆí•„ìš”
- ì½”ë“œ ìµœì í™”ë§Œìœ¼ë¡œ ë‹¬ì„±

**cache.m7g.xlarge Ã— 10 nodes** ê·¸ëŒ€ë¡œ
30k RPSë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

---

## ğŸ“œ 1.14 ì„¤ê³„ ê²€ì¦

### ìŠ¬ë¼ì´ë“œ
```
"ì•„í‚¤í…ì²˜ ì„¤ê³„ê°€ ë§ì•˜ë‹¤"

ìš°ë¦¬ì˜ ê°€ì„¤:
"Gateway + Redisê°€ ë°©íŒŒì œ ì—­í• ì„ í•  ê²ƒì´ë‹¤"

ê²€ì¦ ê²°ê³¼:
âœ… Gateway + Redisê°€ 30ë§Œ ëª… íŠ¸ë˜í”½ ë°›ì•„ëƒ„
âœ… ì…ì¥ ì œì–´ë¡œ ë’·ë‹¨ ë³´í˜¸ (1,000 RPSë¡œ ì œí•œ)
âœ… Backend CPU < 5% (ë§¤ìš° ì—¬ìœ ë¡œì›€)
âœ… DynamoDB 10% ì‚¬ìš© (ì“°ê¸° ë¹„ìš© ì ˆê°)
âœ… ë¹„ìš© ì¦ê°€ ì—†ì´ 30k RPS ë‹¬ì„±


Trade-off ìˆ˜ìš©:
"Gateway ë¶€í•˜ ì§‘ì¤‘" â†’ ìµœì í™”ë¡œ í•´ê²°
"Redis ë³‘ëª©" â†’ Position Indexë¡œ í•´ê²°


ì„¤ê³„ ì² í•™ ê²€ì¦:
âœ… ì‹¤ì‹œê°„ í”¼ë“œë°± (ìˆœë²ˆ ì¡°íšŒ)
âœ… ë’·ë‹¨ ë³´í˜¸ (ì…ì¥ ì œì–´)
âœ… ê³µì •ì„± ë³´ì¥ (ëŒ€ê¸°ì—´ ê´€ë¦¬)
âœ… ë¹„ìš© íš¨ìœ¨ì„± (ì½”ë“œ ìµœì í™”)
```

### ë©˜íŠ¸

ê°€ì¥ ì¤‘ìš”í•œ êµí›ˆì€,
**ìš°ë¦¬ì˜ ì•„í‚¤í…ì²˜ ì„¤ê³„ê°€ ë§ì•˜ë‹¤**ëŠ” ê²ë‹ˆë‹¤.

**ì²˜ìŒ ì„¤ê³„ ë‹¨ê³„ì—ì„œ ì„¸ìš´ ê°€ì„¤:**
"Gateway + Redisê°€ ë°©íŒŒì œ ì—­í• ì„ í•  ê²ƒì´ë‹¤"

**ê²€ì¦ ê²°ê³¼:**
- Gateway + Redisê°€ 30ë§Œ ëª…ì˜ íŠ¸ë˜í”½ì„ ë°›ì•„ëƒˆìŠµë‹ˆë‹¤
- ì…ì¥ ì œì–´ë¡œ ë’·ë‹¨ì„ ë³´í˜¸í–ˆìŠµë‹ˆë‹¤ (1,000 RPSë¡œ ì œí•œ)
- Backend ì„œë¹„ìŠ¤ë“¤ì€ CPU 5% ë¯¸ë§Œìœ¼ë¡œ ì—¬ìœ ë¡œì› ìŠµë‹ˆë‹¤
- DynamoDBëŠ” 10%ë§Œ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤ (ì“°ê¸° ë¹„ìš© ì ˆê°)
- ë¹„ìš© ì¦ê°€ ì—†ì´ 30k RPSë¥¼ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤

**Trade-off ìˆ˜ìš©:**
ìš°ë¦¬ëŠ” "Gatewayì— ë¶€í•˜ê°€ ì§‘ì¤‘ë  ê²ƒ"ì„ ì•Œê³  ìˆì—ˆìŠµë‹ˆë‹¤.
í•˜ì§€ë§Œ ì´ Trade-offë¥¼ ìˆ˜ìš©í•˜ê³ , ìµœì í™”ì— ì§‘ì¤‘í–ˆìŠµë‹ˆë‹¤.
- Position Index ë„ì…
- Connection Pool íŠœë‹
- Go ë©”ëª¨ë¦¬ ìµœì í™”

**ì„¤ê³„ ì² í•™ ê²€ì¦:**
1. **ì‹¤ì‹œê°„ í”¼ë“œë°±**: ì‚¬ìš©ìëŠ” 5ì´ˆë§ˆë‹¤ ìˆœë²ˆ í™•ì¸ âœ…
2. **ë’·ë‹¨ ë³´í˜¸**: Backend CPU < 5% âœ…
3. **ê³µì •ì„± ë³´ì¥**: ëŒ€ê¸°ì—´ ìˆœì„œ ê´€ë¦¬ âœ…
4. **ë¹„ìš© íš¨ìœ¨ì„±**: ì¶”ê°€ ë¹„ìš© 0ì› âœ…

ë§Œì•½ ë‹¤ë¥¸ ì•„í‚¤í…ì²˜ë¥¼ ì„ íƒí–ˆë‹¤ë©´?
- Direct Access: DBê°€ í„°ì¡Œì„ ê²ë‹ˆë‹¤
- Queue Service: ì‚¬ìš©ì ê²½í—˜ì´ ë‚˜ë¹´ì„ ê²ë‹ˆë‹¤

**Gateway + ì…ì¥ ì œì–´ê°€ ì •ë‹µì´ì—ˆìŠµë‹ˆë‹¤.**

---

# ğŸ”’ Part 2: ë³´ì•ˆ (Security) - 10ë¶„

## ğŸ“œ 2.1 ì™¸ë¶€ íŠ¸ë˜í”½ ë³´ì•ˆ: WAF + CAPTCHA

### ìŠ¬ë¼ì´ë“œ
```
"ì²« ë²ˆì§¸ ë°©ì–´ì„ : Edge Security"

ì„¤ê³„ ê³ ë¯¼:
â”œâ”€ ë¬¸ì œ: í‹°ì¼“íŒ… ì˜¤í”ˆ ì‹œ ë´‡ íŠ¸ë˜í”½ í­ì¦ (ì‹¤ì œ ì‚¬ìš©ì vs ë´‡ êµ¬ë¶„ í•„ìš”)
â”œâ”€ ìš”êµ¬ì‚¬í•­: 
â”‚   â””â”€ ì •ìƒ ì‚¬ìš©ì ì˜í–¥ ìµœì†Œí™”
â”‚   â””â”€ ë´‡ íŠ¸ë˜í”½ ì‚¬ì „ ì°¨ë‹¨
â”‚   â””â”€ DDoS ê³µê²© ë°©ì–´
â””â”€ ê³ ë¯¼: CloudFront WAF vs ALB WAF?

ì„ íƒ: CloudFront + AWS WAF + CAPTCHA
â”œâ”€ CloudFront: Edge ë ˆë²¨ ë°©ì–´ (ì „ ì„¸ê³„ 216ê°œ PoP)
â”œâ”€ AWS WAF: Managed Rules + Custom Rules
â”œâ”€ CAPTCHA: AWS WAF CAPTCHA (JavaScript Challenge)
â””â”€ AWS Shield Standard: ìë™ DDoS ë°©ì–´

êµ¬í˜„ ê²°ê³¼:
â”œâ”€ Rate-based Rule: 100 req/5min per IP
â”œâ”€ Geo-blocking: íŠ¹ì • êµ­ê°€ ì°¨ë‹¨ (ì„¤ì • ê°€ëŠ¥)
â”œâ”€ Known Bot Blocking: AWS Managed Bot Control
â””â”€ CAPTCHA Challenge: ì˜ì‹¬ IP ìë™ ê²€ì¦
```

### ë©˜íŠ¸

**ì„¤ê³„ ë‹¨ê³„ ê³ ë¯¼:**

í‹°ì¼“íŒ… ì‹œìŠ¤í…œ ì„¤ê³„ ì´ˆê¸°, ê°€ì¥ í° ê³ ë¯¼ì€ **ë´‡ íŠ¸ë˜í”½**ì´ì—ˆìŠµë‹ˆë‹¤.
- ì‹¤ì œ ì‚¬ë¡€: í•œ ì´ë²¤íŠ¸ì—ì„œ 30ë§Œ ëª… ëŒ€ê¸° ì¤‘ **20%ê°€ ë´‡**ìœ¼ë¡œ ì¶”ì •
- ë´‡ì´ ë¨¼ì € í‹°ì¼“ì„ ì„ ì í•˜ë©´, ì‹¤ì œ ê³ ê° ë¶ˆë§Œ í­ë°œ
- í•˜ì§€ë§Œ ê³¼ë„í•œ ë³´ì•ˆì€ ì •ìƒ ì‚¬ìš©ì ê²½í—˜ ì €í•˜

**ê³ ë¯¼í•œ ì„ íƒì§€:**
1. **ALB WAF**: ë¹„ìš© ì €ë ´, í•˜ì§€ë§Œ ëª¨ë“  íŠ¸ë˜í”½ì´ EKSê¹Œì§€ ë„ë‹¬
2. **CloudFront WAF**: ë¹„ìš© ë†’ìŒ, í•˜ì§€ë§Œ Edgeì—ì„œ ì°¨ë‹¨ (ëŒ€ì—­í­ ì ˆê°)
3. **Third-party (Cloudflare)**: ê°•ë ¥, í•˜ì§€ë§Œ AWS ìƒíƒœê³„ ì´íƒˆ

**ìš°ë¦¬ì˜ ì„ íƒ: CloudFront + AWS WAF**

ì´ìœ :
- **Edgeì—ì„œ ì°¨ë‹¨**: ì•…ì„± íŠ¸ë˜í”½ì´ EKSì— ë„ë‹¬í•˜ê¸° ì „ì— ì°¨ë‹¨
- **ëŒ€ì—­í­ ì ˆê°**: ì°¨ë‹¨ëœ íŠ¸ë˜í”½ì€ AWS ìš”ê¸ˆ ë¶€ê³¼ ì•ˆë¨
- **Managed Rules**: AWSê°€ ê´€ë¦¬í•˜ëŠ” ë´‡ ì°¨ë‹¨ ê·œì¹™ (ìë™ ì—…ë°ì´íŠ¸)

**ì‹¤ì œ êµ¬í˜„:**
```hcl
# AWS WAF Web ACL
resource "aws_wafv2_web_acl" "main" {
  name  = "traffic-tacos-waf"
  scope = "CLOUDFRONT"

  # Rule 1: Rate Limiting (100 req/5min per IP)
  rate_based_statement {
    limit              = 100
    aggregate_key_type = "IP"
  }

  # Rule 2: AWS Managed Bot Control
  managed_rule_group_statement {
    vendor_name = "AWS"
    name        = "AWSManagedRulesBotControlRuleSet"
  }

  # Rule 3: CAPTCHA Challenge
  captcha_config {
    immunity_time_property {
      immunity_time = 300  # 5ë¶„ê°„ CAPTCHA ë©´ì œ
    }
  }
}
```

**ìš´ì˜ ê²½í—˜ (ì‹¤ì œ ë°ì´í„°):**

**1ì°¨ í‹°ì¼“íŒ… (WAF ì ìš© ì „):**
- ì´ ìš”ì²­: 50ë§Œ ê±´
- ë´‡ íŠ¸ë˜í”½: ì•½ 10ë§Œ ê±´ (ì¶”ì •)
- ì„œë²„ ë¶€í•˜: Gateway API CPU 85%
- ê³ ê° ë¶ˆë§Œ: ë†’ìŒ (ë´‡ì´ ë¨¼ì € ì„ ì )

**2ì°¨ í‹°ì¼“íŒ… (WAF + CAPTCHA ì ìš© í›„):**
- ì´ ìš”ì²­: 60ë§Œ ê±´
- WAF ì°¨ë‹¨: 15ë§Œ ê±´ (25%)
- CAPTCHA í†µê³¼: 45ë§Œ ê±´
- ì„œë²„ ë¶€í•˜: Gateway API CPU 45% (40% ê°ì†Œ)
- ëŒ€ì—­í­ ì ˆê°: ì•½ 30% (ì°¨ë‹¨ëœ íŠ¸ë˜í”½)
- ê³ ê° ë§Œì¡±ë„: ìƒìŠ¹ (ì •ìƒ ì‚¬ìš©ì ê²½í—˜ ê°œì„ )

**WAF ì°¨ë‹¨ ìœ í˜• ë¶„ì„:**
- Rate-based Rule: 60% (IPë‹¹ ì´ˆê³¼ ìš”ì²­)
- Bot Control: 30% (Known Bot íŒ¨í„´)
- Geo-blocking: 10% (íŠ¹ì • êµ­ê°€)

**CAPTCHA íš¨ê³¼:**
- False Positive: < 2% (ì •ìƒ ì‚¬ìš©ìê°€ CAPTCHA ë³¸ ë¹„ìœ¨)
- í‰ê·  í•´ê²° ì‹œê°„: 3ì´ˆ
- ì‚¬ìš©ì ë¶ˆë§Œ: ê±°ì˜ ì—†ìŒ (ë´‡ ì°¨ë‹¨ íš¨ê³¼ê°€ ë” í¼)

**êµí›ˆ:**
- Edge ë³´ì•ˆì€ í•„ìˆ˜ (ì„œë²„ ë¦¬ì†ŒìŠ¤ ì ˆê° + ëŒ€ì—­í­ ì ˆê°)
- CAPTCHAëŠ” ì‹ ì¤‘í•˜ê²Œ (False Positive ìµœì†Œí™”)
- Managed Rules í™œìš© (AWSê°€ ìë™ìœ¼ë¡œ ë´‡ íŒ¨í„´ ì—…ë°ì´íŠ¸)
- ëª¨ë‹ˆí„°ë§ ì¤‘ìš” (WAF ë¡œê·¸ â†’ CloudWatch â†’ ì•ŒëŒ)

---

## ğŸ“œ 2.2 ë‚´ë¶€ íŠ¸ë˜í”½ ë³´ì•ˆ: Istio Ambient Mode

### ìŠ¬ë¼ì´ë“œ
```
"ë‘ ë²ˆì§¸ ë°©ì–´ì„ : Service Mesh Security"

ì„¤ê³„ ê³ ë¯¼:
â”œâ”€ ë¬¸ì œ: MSA í™˜ê²½ì—ì„œ ì„œë¹„ìŠ¤ ê°„ í†µì‹  ë³´ì•ˆ
â”‚   â”œâ”€ Gateway â†’ Reservation â†’ Inventory â†’ Payment
â”‚   â”œâ”€ í‰ë¬¸ í†µì‹ ? mTLS í•„ìš”? 
â”‚   â””â”€ ì„œë¹„ìŠ¤ ê°„ ì¸ì¦/ì¸ê°€?
â”‚
â”œâ”€ ìš”êµ¬ì‚¬í•­:
â”‚   â”œâ”€ ì„œë¹„ìŠ¤ ê°„ ì•”í˜¸í™” (mTLS)
â”‚   â”œâ”€ ì„œë¹„ìŠ¤ ê°„ ì¸ê°€ (Authorization Policy)
â”‚   â”œâ”€ íŠ¸ë˜í”½ ê°€ì‹œì„± (Observability)
â”‚   â””â”€ ì„±ëŠ¥ ì˜¤ë²„í—¤ë“œ ìµœì†Œí™”
â”‚
â””â”€ ê³ ë¯¼: Istio Sidecar vs Ambient vs Linkerd vs Cilium?

ì„ íƒ: Istio Ambient Mode
â”œâ”€ No Sidecar: ì»¨í…Œì´ë„ˆ ì—†ì´ ztunnel (node-level proxy)
â”œâ”€ mTLS ìë™í™”: ì¸ì¦ì„œ ìë™ ê°±ì‹ 
â”œâ”€ Layer 4 ë³´ì•ˆ: TCP/UDP ìˆ˜ì¤€ ì•”í˜¸í™”
â”œâ”€ ì„±ëŠ¥: Sidecar ëŒ€ë¹„ CPU/Memory 50% ì ˆê°
â””â”€ Layer 7: Waypoint proxy (ì„ íƒì )

êµ¬í˜„ ê²°ê³¼:
â”œâ”€ ëª¨ë“  ì„œë¹„ìŠ¤ ê°„ mTLS ìë™ ì ìš©
â”œâ”€ AuthorizationPolicy: í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ê¸°ë°˜
â”œâ”€ CPU ì˜¤ë²„í—¤ë“œ: < 5% (Sidecar 15% ëŒ€ë¹„)
â””â”€ ì•”í˜¸í™” ì„±ëŠ¥: ê±°ì˜ ì˜í–¥ ì—†ìŒ (ztunnel ìµœì í™”)
```

### ë©˜íŠ¸

**ì„¤ê³„ ë‹¨ê³„ ê³ ë¯¼:**

MSA í™˜ê²½ì—ì„œ ì„œë¹„ìŠ¤ ê°„ í†µì‹ ì€ ê¸°ë³¸ì ìœ¼ë¡œ í‰ë¬¸ì…ë‹ˆë‹¤.
- Gateway â†’ Reservation: gRPC (í‰ë¬¸)
- Reservation â†’ Inventory: gRPC (í‰ë¬¸)
- Inventory â†’ DynamoDB: TLS (ì•”í˜¸í™”)

**ë¬¸ì œì :**
- í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ê°€ ì¹¨í•´ë˜ë©´? â†’ ëª¨ë“  íŠ¸ë˜í”½ ë„ì²­ ê°€ëŠ¥
- ì„œë¹„ìŠ¤ ê°„ ì¸ì¦ ì—†ìŒ â†’ ì•…ì˜ì  Podê°€ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ í˜¸ì¶œ ê°€ëŠ¥
- Zero Trust ìœ„ë°˜ â†’ "ë‚´ë¶€ëŠ” ì•ˆì „í•˜ë‹¤"ëŠ” ê°€ì •

**ê³ ë¯¼í•œ ì„ íƒì§€:**

**1. Istio Sidecar Mode:**
- âœ… ì„±ìˆ™í•œ ê¸°ìˆ , í’ë¶€í•œ ê¸°ëŠ¥
- âŒ Sidecar ì»¨í…Œì´ë„ˆ ì˜¤ë²„í—¤ë“œ (CPU +15%, Memory +50MB/pod)
- âŒ ë°°í¬ ë³µì¡ë„ ì¦ê°€

**2. Linkerd:**
- âœ… ê²½ëŸ‰í™”, ì„±ëŠ¥ ìš°ìˆ˜
- âŒ ìƒíƒœê³„ ì‘ìŒ, AWS EKS ìµœì í™” ë¶€ì¡±

**3. Cilium Service Mesh:**
- âœ… eBPF ê¸°ë°˜, ì´ˆê³ ì„±ëŠ¥
- âŒ Learning curve ë†’ìŒ, ìš´ì˜ ë³µì¡

**4. Istio Ambient Mode:**
- âœ… Sidecar ì—†ìŒ (ztunnel node-level proxy)
- âœ… CPU/Memory 50% ì ˆê°
- âœ… Istio ìƒíƒœê³„ í™œìš© ê°€ëŠ¥
- âš ï¸ ì‹ ê¸°ìˆ  (2023ë…„ Beta)

**ìš°ë¦¬ì˜ ì„ íƒ: Istio Ambient Mode**

ì´ìœ :
- **ì„±ëŠ¥**: Sidecar ëŒ€ë¹„ CPU 50% ì ˆê° (30k RPS í™˜ê²½ì—ì„œ ì¤‘ìš”)
- **ê°„í¸í•¨**: ê¸°ì¡´ Pod ìˆ˜ì • ë¶ˆí•„ìš” (Namespace labelë§Œ ì¶”ê°€)
- **Zero Trust**: ëª¨ë“  íŠ¸ë˜í”½ ìë™ mTLS ì•”í˜¸í™”
- **ë‹¨ê³„ì  ë„ì…**: Layer 4 â†’ Layer 7 (Waypoint) ì„ íƒì  ì ìš©

**ì‹¤ì œ êµ¬í˜„:**
```yaml
# Istio Ambient í™œì„±í™” (Namespace label)
apiVersion: v1
kind: Namespace
metadata:
  name: tickets-api
  labels:
    istio.io/dataplane-mode: ambient  # Ambient ëª¨ë“œ í™œì„±í™”
```

```yaml
# AuthorizationPolicy: Gatewayë§Œ Reservation í˜¸ì¶œ í—ˆìš©
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: reservation-access-policy
spec:
  selector:
    matchLabels:
      app: reservation-api
  action: ALLOW
  rules:
  - from:
    - source:
        principals: ["cluster.local/ns/tickets-api/sa/gateway-api"]  # Gateway SAë§Œ í—ˆìš©
```

**ìš´ì˜ ê²½í—˜ (ì‹¤ì œ ë°ì´í„°):**

**ì ìš© ì „ (í‰ë¬¸ í†µì‹ ):**
- íŠ¸ë˜í”½: í‰ë¬¸
- ë³´ì•ˆ: ì—†ìŒ (ë‚´ë¶€ ì‹ ë¢°)
- CPU ì˜¤ë²„í—¤ë“œ: 0%

**ì ìš© í›„ (Istio Ambient):**
- íŠ¸ë˜í”½: ëª¨ë“  ì„œë¹„ìŠ¤ ê°„ mTLS ì•”í˜¸í™” âœ…
- ë³´ì•ˆ: Authorization Policy ì ìš© (í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸) âœ…
- CPU ì˜¤ë²„í—¤ë“œ: **< 5%** (ztunnel node-level)
  - Gateway: 15% â†’ 16% (1% ì¦ê°€)
  - Reservation: 5% â†’ 5.2% (0.2% ì¦ê°€)
- Memory ì˜¤ë²„í—¤ë“œ: Podë‹¹ **0MB** (Sidecar ì—†ìŒ)
  - ztunnelì€ Node ë‹¹ 1ê°œë§Œ ì‹¤í–‰ (50MB/node)

**ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬:**
| í•­ëª© | í‰ë¬¸ | Istio Sidecar | Istio Ambient |
|------|------|--------------|--------------|
| Latency P50 | 10ms | 12ms (+20%) | 10.5ms (+5%) |
| Latency P99 | 50ms | 65ms (+30%) | 53ms (+6%) |
| CPU ì˜¤ë²„í—¤ë“œ | 0% | +15% | +5% |
| Memory/pod | 0MB | +50MB | 0MB |

**ë³´ì•ˆ ê²€ì¦:**
- **mTLS ì•”í˜¸í™”**: ëª¨ë“  ì„œë¹„ìŠ¤ ê°„ íŠ¸ë˜í”½ tcpdump í™•ì¸ â†’ ì•”í˜¸í™” í™•ì¸ âœ…
- **Authorization**: Unauthorized Podì—ì„œ Reservation API í˜¸ì¶œ â†’ 403 Forbidden âœ…
- **ì¸ì¦ì„œ ê°±ì‹ **: Istio CAê°€ ìë™ ê°±ì‹  (90ì¼ â†’ ìë™) âœ…

**ìš´ì˜ ì´ìŠˆ & í•´ê²°:**

**Issue 1: ì´ˆê¸° ì—°ê²° ì§€ì—°**
- ì¦ìƒ: Pod ì¬ì‹œì‘ í›„ ì²« ìš”ì²­ 500ms ì§€ì—°
- ì›ì¸: ztunnel <-> Pod ê°„ ì´ˆê¸° í•¸ë“œì…°ì´í¬
- í•´ê²°: Readiness Probe delay ì¡°ì • (5s â†’ 10s)

**Issue 2: Prometheus ë©”íŠ¸ë¦­ ìˆ˜ì§‘**
- ì¦ìƒ: Istio AmbientëŠ” ê¸°ë³¸ì ìœ¼ë¡œ Layer 4ë§Œ ì§€ì›, HTTP ë©”íŠ¸ë¦­ ì—†ìŒ
- í•´ê²°: ì¤‘ìš” ì„œë¹„ìŠ¤ë§Œ Waypoint proxy ì¶”ê°€ (Layer 7 ë©”íŠ¸ë¦­)

**êµí›ˆ:**
- Istio AmbientëŠ” ì„±ëŠ¥ê³¼ ë³´ì•ˆì˜ ê· í˜•ì  âœ…
- ì´ˆê¸° Learning curve ìˆì§€ë§Œ, ìš´ì˜ ì•ˆì •í™”ë˜ë©´ ë§¤ìš° íš¨ê³¼ì 
- Layer 4ë§Œìœ¼ë¡œë„ ì¶©ë¶„í•œ ë³´ì•ˆ (mTLS + AuthZ)
- Layer 7 ë©”íŠ¸ë¦­ í•„ìš” ì‹œ Waypoint proxy ì„ íƒì  ì‚¬ìš©

---

## ğŸ“œ 2.3 ìš´ì˜ì ì ‘ê·¼ ì œì–´: Teleport

### ìŠ¬ë¼ì´ë“œ
```
"ì„¸ ë²ˆì§¸ ë°©ì–´ì„ : Operator Access Control"

ì„¤ê³„ ê³ ë¯¼:
â”œâ”€ ë¬¸ì œ: ìš´ì˜ìì˜ EKS/RDS/ì¸í”„ë¼ ì ‘ê·¼ ì œì–´
â”‚   â”œâ”€ SSH í‚¤ ê´€ë¦¬? 
â”‚   â”œâ”€ kubectl ê¶Œí•œ ê´€ë¦¬?
â”‚   â”œâ”€ ê°ì‚¬ ë¡œê·¸?
â”‚   â””â”€ Bastion Host ë‹¨ì¼ ì¥ì• ì ?
â”‚
â”œâ”€ ìš”êµ¬ì‚¬í•­:
â”‚   â”œâ”€ Just-in-Time Access (í•„ìš”í•  ë•Œë§Œ)
â”‚   â”œâ”€ ëª¨ë“  ì„¸ì…˜ ë…¹í™” (ê°ì‚¬ ëª©ì )
â”‚   â”œâ”€ MFA í•„ìˆ˜
â”‚   â”œâ”€ ê¶Œí•œ ìµœì†Œí™” (Least Privilege)
â”‚   â””â”€ ì¤‘ì•™ ì§‘ì¤‘ì‹ ê´€ë¦¬
â”‚
â””â”€ ê³ ë¯¼: AWS SSM vs Bastion + OpenSSH vs Teleport vs Boundary?

ì„ íƒ: Teleport (Gravitational)
â”œâ”€ Unified Access: Kubernetes + SSH + Database + Web
â”œâ”€ Session Recording: ëª¨ë“  ì„¸ì…˜ ë…¹í™” ë° ì¬ìƒ
â”œâ”€ MFA ë‚´ì¥: OTP/WebAuthn ì§€ì›
â”œâ”€ Just-in-Time Access: ì‹œê°„ ì œí•œ ê¶Œí•œ
â””â”€ Audit Log: ëª¨ë“  ì ‘ê·¼ ê¸°ë¡

êµ¬í˜„ ê²°ê³¼:
â”œâ”€ Bastion Host ì œê±° (Teleportê°€ ëŒ€ì²´)
â”œâ”€ kubectl ì§ì ‘ ì ‘ê·¼ ì°¨ë‹¨ (Teleport í†µí•´ì„œë§Œ)
â”œâ”€ Session Recording: 100% ë…¹í™”
â””â”€ Compliance: SOC2/PCI DSS ê°ì‚¬ ëŒ€ì‘
```

### ë©˜íŠ¸

**ì„¤ê³„ ë‹¨ê³„ ê³ ë¯¼:**

í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ ìš´ì˜ì ì ‘ê·¼ ì œì–´ëŠ” ë§¤ìš° ì¤‘ìš”í•©ë‹ˆë‹¤.
í•˜ì§€ë§Œ ì´ˆê¸°ì—ëŠ” ê°„ë‹¨í•˜ê²Œ ì‹œì‘í–ˆìŠµë‹ˆë‹¤:
- Bastion Host + SSH í‚¤
- `kubectl` ì§ì ‘ ì ‘ê·¼
- CloudTrail ë¡œê·¸ (AWS API í˜¸ì¶œë§Œ)

**ë¬¸ì œ ë°œìƒ:**
1. **SSH í‚¤ ê´€ë¦¬ í˜¼ë€**
   - íŒ€ì›ë§ˆë‹¤ ë‹¤ë¥¸ í‚¤
   - í‡´ì‚¬ì í‚¤ íšŒìˆ˜ ì–´ë ¤ì›€
   - í‚¤ ìœ ì¶œ ìœ„í—˜

2. **kubectl ê¶Œí•œ ê³¼ë‹¤**
   - ëª¨ë“  ì—”ì§€ë‹ˆì–´ê°€ `cluster-admin` ê¶Œí•œ
   - ì‹¤ìˆ˜ë¡œ ìš´ì˜ Pod ì‚­ì œ ê°€ëŠ¥
   - ëˆ„ê°€ ë¬´ì—‡ì„ í–ˆëŠ”ì§€ ì¶”ì  ì–´ë ¤ì›€

3. **ê°ì‚¬ ë¡œê·¸ ë¶€ì¡±**
   - "ëˆ„ê°€ ì–´ë–¤ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í–ˆëŠ”ì§€" ê¸°ë¡ ì—†ìŒ
   - Compliance ê°ì‚¬ ëŒ€ì‘ ë¶ˆê°€ëŠ¥
   - ì¥ì•  ì›ì¸ ì¶”ì  ì–´ë ¤ì›€

**ê³ ë¯¼í•œ ì„ íƒì§€:**

**1. AWS Systems Manager (SSM):**
- âœ… AWS ë„¤ì´í‹°ë¸Œ, ë³„ë„ ì¸í”„ë¼ ë¶ˆí•„ìš”
- âŒ Kubernetes ì§€ì› ë¶€ì¡±
- âŒ Session Recording ì œí•œì 

**2. Bastion + OpenSSH + FreeIPA:**
- âœ… ì˜¤í”ˆì†ŒìŠ¤, ë¹„ìš© ë¬´ë£Œ
- âŒ êµ¬ì¶•/ìš´ì˜ ë³µì¡
- âŒ Session Recording ë³„ë„ êµ¬ì„± í•„ìš”

**3. HashiCorp Boundary:**
- âœ… Zero Trust ì ‘ê·¼
- âŒ Kubernetes ì§€ì› ì•½í•¨
- âŒ ìƒíƒœê³„ ì‘ìŒ

**4. Teleport:**
- âœ… Kubernetes ë„¤ì´í‹°ë¸Œ (kubectl proxy)
- âœ… Session Recording ë‚´ì¥
- âœ… MFA ë‚´ì¥
- âœ… í†µí•© ì ‘ê·¼ (SSH + kubectl + DB)
- âŒ ë¹„ìš© (ìì²´ í˜¸ìŠ¤íŒ… vs Cloud)

**ìš°ë¦¬ì˜ ì„ íƒ: Teleport (Self-hosted)**

ì´ìœ :
- **Unified Access**: í•˜ë‚˜ì˜ ë„êµ¬ë¡œ ëª¨ë“  ì¸í”„ë¼ ì ‘ê·¼
- **Session Recording**: ëª¨ë“  ì„¸ì…˜ ìë™ ë…¹í™” (Compliance ëŒ€ì‘)
- **Kubernetes ì§€ì›**: `tsh kubectl` ëª…ë ¹ì–´ë¡œ ì•ˆì „í•œ ì ‘ê·¼
- **Just-in-Time**: ì‹œê°„ ì œí•œ ê¶Œí•œ ë¶€ì—¬ (ìµœì†Œ ê¶Œí•œ ì›ì¹™)

**ì‹¤ì œ êµ¬í˜„:**

```yaml
# Teleport Role: ê°œë°œìëŠ” tickets-api Namespaceë§Œ ì ‘ê·¼
kind: role
version: v5
metadata:
  name: developer
spec:
  allow:
    kubernetes_groups: ["developer"]
    kubernetes_labels:
      'env': 'production'
    kubernetes_resources:
      - kind: namespace
        name: tickets-api
    rules:
      - resources: [pod, deployment, service]
        verbs: [get, list]  # ì½ê¸°ë§Œ í—ˆìš©
```

```bash
# ì—”ì§€ë‹ˆì–´ ì ‘ê·¼ íë¦„
# 1. Teleport ë¡œê·¸ì¸ (MFA í•„ìˆ˜)
tsh login --proxy=teleport.traffictacos.store --user=john

# 2. Kubernetes í´ëŸ¬ìŠ¤í„° ì ‘ê·¼
tsh kubectl get pods -n tickets-api

# 3. Pod ë‚´ë¶€ ì ‘ê·¼ (Session Recording ì‹œì‘)
tsh kubectl exec -it gateway-api-abc123 -- /bin/sh
```

**ìš´ì˜ ê²½í—˜ (ì‹¤ì œ ë°ì´í„°):**

**ì ìš© ì „ (Bastion + kubectl):**
- SSH í‚¤: íŒ€ì› 10ëª… Ã— 3ê°œ = 30ê°œ í‚¤ ê´€ë¦¬
- kubectl ê¶Œí•œ: ëª¨ë‘ `cluster-admin` (ê³¼ë„í•œ ê¶Œí•œ)
- ê°ì‚¬ ë¡œê·¸: CloudTrail (AWS APIë§Œ), kubectl ëª…ë ¹ì–´ ê¸°ë¡ ì—†ìŒ
- ì¥ì•  ì›ì¸ ì¶”ì : ì–´ë ¤ì›€

**ì ìš© í›„ (Teleport):**
- SSH í‚¤: 0ê°œ (Teleport ì¸ì¦ì„œ ê¸°ë°˜)
- kubectl ê¶Œí•œ: Role ê¸°ë°˜ (Namespace/Resource ì œí•œ)
- ê°ì‚¬ ë¡œê·¸: ëª¨ë“  ëª…ë ¹ì–´ + ì„¸ì…˜ ë…¹í™” (S3 ì €ì¥)
- Session Recording: 100% (ì¬ìƒ ê°€ëŠ¥)

**ì‹¤ì œ ì‚¬ë¡€ 1: ì¥ì•  ì›ì¸ ì¶”ì **
- ì¥ì• : Reservation API Pod ê°‘ìê¸° ì¢…ë£Œ
- ì¡°ì‚¬: Teleport Audit Log í™•ì¸
  ```
  2025-10-08 14:23:15 john@teleport kubectl delete pod reservation-api-xyz --force
  ```
- ì›ì¸: ì—”ì§€ë‹ˆì–´ ì‹¤ìˆ˜ (ì˜ëª»ëœ Pod ì‚­ì œ)
- ì¡°ì¹˜: í•´ë‹¹ ì—”ì§€ë‹ˆì–´ ê¶Œí•œ ì¶•ì†Œ + êµìœ¡
- ê²°ê³¼: Teleport ì—†ì—ˆìœ¼ë©´ ì›ì¸ íŒŒì•… ë¶ˆê°€ëŠ¥

**ì‹¤ì œ ì‚¬ë¡€ 2: Compliance ê°ì‚¬ (SOC2)**
- ìš”êµ¬ì‚¬í•­: "ì§€ë‚œ 3ê°œì›”ê°„ ìš´ì˜ì ì ‘ê·¼ ê¸°ë¡ ì œì¶œ"
- ëŒ€ì‘: Teleport Audit Log export
  - ì´ ì ‘ê·¼: 1,234íšŒ
  - ì„¸ì…˜ ë…¹í™”: 1,234ê°œ (100%)
  - MFA ì¸ì¦: 1,234íšŒ (100%)
- ê²°ê³¼: ê°ì‚¬ í†µê³¼ âœ…

**ì„±ëŠ¥ ì˜í–¥:**
- Latency ì¶”ê°€: ~10ms (Teleport Proxy)
- ì‚¬ìš©ì ê²½í—˜: ê±°ì˜ ì°¨ì´ ì—†ìŒ
- Session Recording ì˜¤ë²„í—¤ë“œ: CPU < 1%

**ìš´ì˜ ì´ìŠˆ & í•´ê²°:**

**Issue 1: Teleport Proxy SPOF**
- ë¬¸ì œ: Teleport Proxy ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤
- í•´ê²°: Active-Standby HA êµ¬ì„± + ALB

**Issue 2: Session Recording Storage**
- ë¬¸ì œ: ì„¸ì…˜ ë…¹í™” íŒŒì¼ S3 ë¹„ìš© ì¦ê°€
- í•´ê²°: 90ì¼ ì´í›„ Glacier ì´ë™ (Lifecycle Policy)

**êµí›ˆ:**
- TeleportëŠ” ìš´ì˜ì ì ‘ê·¼ ì œì–´ì˜ í‘œì¤€ âœ…
- Session Recordingì€ ì¥ì•  ì¶”ì ì— í•„ìˆ˜
- Just-in-Time Accessë¡œ ìµœì†Œ ê¶Œí•œ ë³´ì¥
- Compliance ê°ì‚¬ ëŒ€ì‘ì— ë§¤ìš° ìœ ìš©

---

## ğŸ“œ 2.4 ëŸ°íƒ€ì„ ìœ„í˜‘ íƒì§€: Falco

### ìŠ¬ë¼ì´ë“œ
```
"ë„¤ ë²ˆì§¸ ë°©ì–´ì„ : Runtime Security"

ì„¤ê³„ ê³ ë¯¼:
â”œâ”€ ë¬¸ì œ: ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„ì—ì„œ ì•…ì˜ì  í–‰ìœ„ íƒì§€
â”‚   â”œâ”€ ì¹¨í•´ëœ Podê°€ ì•…ì„± ì½”ë“œ ì‹¤í–‰?
â”‚   â”œâ”€ ì»¨í…Œì´ë„ˆê°€ /etc/passwd ìˆ˜ì •?
â”‚   â”œâ”€ ì˜ˆìƒì¹˜ ëª»í•œ ë„¤íŠ¸ì›Œí¬ ì—°ê²°?
â”‚   â””â”€ Crypto Mining?
â”‚
â”œâ”€ ìš”êµ¬ì‚¬í•­:
â”‚   â”œâ”€ ì‹¤ì‹œê°„ ìœ„í˜‘ íƒì§€
â”‚   â”œâ”€ ì»¨í…Œì´ë„ˆ/í˜¸ìŠ¤íŠ¸ ëª¨ë‘ ëª¨ë‹ˆí„°ë§
â”‚   â”œâ”€ ì»¤ìŠ¤í…€ ë£° ì§€ì›
â”‚   â””â”€ ì•ŒëŒ í†µí•© (Slack/PagerDuty)
â”‚
â””â”€ ê³ ë¯¼: Falco vs Sysdig vs Aqua vs Twistlock?

ì„ íƒ: Falco (CNCF Graduated)
â”œâ”€ eBPF ê¸°ë°˜: ì»¤ë„ ìˆ˜ì¤€ ëª¨ë‹ˆí„°ë§
â”œâ”€ ì˜¤í”ˆì†ŒìŠ¤: CNCF Graduated Project
â”œâ”€ ë£° ê¸°ë°˜: YAML ë£°ë¡œ ìœ„í˜‘ ì •ì˜
â”œâ”€ ë‚®ì€ ì˜¤ë²„í—¤ë“œ: CPU < 2%
â””â”€ EKS ìµœì í™”: Fargate ì§€ì›

êµ¬í˜„ ê²°ê³¼:
â”œâ”€ 50+ ê¸°ë³¸ ë£° ì ìš©
â”œâ”€ ì»¤ìŠ¤í…€ ë£° 10ê°œ ì¶”ê°€
â”œâ”€ Slack ì•ŒëŒ í†µí•©
â””â”€ íƒì§€ìœ¨: ì›” í‰ê·  5-10ê±´ (ëŒ€ë¶€ë¶„ False Positive)
```

### ë©˜íŠ¸

**ì„¤ê³„ ë‹¨ê³„ ê³ ë¯¼:**

ì»¨í…Œì´ë„ˆ ë³´ì•ˆì˜ ë§ˆì§€ë§‰ ê³„ì¸µì€ **ëŸ°íƒ€ì„ ìœ„í˜‘ íƒì§€**ì…ë‹ˆë‹¤.

ì•„ë¬´ë¦¬ ë³´ì•ˆì„ ê°•í™”í•´ë„, ì¹¨í•´ëŠ” ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
- ì œë¡œë°ì´ ì·¨ì•½ì 
- ê³µê¸‰ë§ ê³µê²© (Supply Chain Attack)
- ë‚´ë¶€ì ìœ„í˜‘

ì´ëŸ´ ë•Œ **"ì´ìƒ í–‰ë™ì„ ë¹ ë¥´ê²Œ íƒì§€"**í•˜ëŠ” ê²Œ ì¤‘ìš”í•©ë‹ˆë‹¤.

**ê³ ë¯¼í•œ ì„ íƒì§€:**

**1. Sysdig Secure:**
- âœ… ê°•ë ¥í•œ ê¸°ëŠ¥, UI ìš°ìˆ˜
- âŒ ë§¤ìš° ë¹„ìŒˆ (ì›” ìˆ˜ë°±ë§Œ ì›)
- âŒ Commercial

**2. Aqua Security:**
- âœ… ì¢…í•© ë³´ì•ˆ í”Œë«í¼
- âŒ ë¹„ìŒˆ
- âŒ ìš°ë¦¬ í™˜ê²½ì—ëŠ” ê³¼í•¨ (Overkill)

**3. AWS GuardDuty (EKS):**
- âœ… AWS ë„¤ì´í‹°ë¸Œ
- âŒ ë£° ì»¤ìŠ¤í„°ë§ˆì´ì§• ì œí•œ
- âŒ EKS ëŸ°íƒ€ì„ íƒì§€ ê¸°ëŠ¥ ì•½í•¨

**4. Falco:**
- âœ… CNCF Graduated (ì‹ ë¢°ì„±)
- âœ… ì˜¤í”ˆì†ŒìŠ¤ (ë¹„ìš© 0ì›)
- âœ… eBPF ê¸°ë°˜ (ê³ ì„±ëŠ¥)
- âœ… ì»¤ìŠ¤í…€ ë£° ììœ ë¡­ê²Œ ì‘ì„±
- âš ï¸ ìì²´ ìš´ì˜ í•„ìš”

**ìš°ë¦¬ì˜ ì„ íƒ: Falco**

ì´ìœ :
- **ë¹„ìš©**: ì˜¤í”ˆì†ŒìŠ¤ (ë¬´ë£Œ)
- **ì„±ëŠ¥**: eBPF ê¸°ë°˜ìœ¼ë¡œ CPU < 2%
- **ìœ ì—°ì„±**: ì»¤ìŠ¤í…€ ë£° ììœ ë¡­ê²Œ ì‘ì„±
- **ìƒíƒœê³„**: CNCF Graduated (ì»¤ë®¤ë‹ˆí‹° í™œë°œ)

**ì‹¤ì œ êµ¬í˜„:**

```yaml
# Falco Helm ì„¤ì¹˜
helm install falco falcosecurity/falco \
  --namespace falco-system \
  --set driver.kind=modern_ebpf \
  --set falcosidekick.enabled=true \
  --set falcosidekick.webui.enabled=true
```

```yaml
# Custom Rule: ë¯¼ê° íŒŒì¼ ì ‘ê·¼ íƒì§€
- rule: Modify sensitive file
  desc: Detect modification of sensitive files
  condition: >
    open_write and
    container and
    fd.name in (/etc/passwd, /etc/shadow, /etc/ssh/sshd_config)
  output: >
    Sensitive file modified
    (user=%user.name command=%proc.cmdline file=%fd.name container=%container.name)
  priority: WARNING
```

```yaml
# Custom Rule: Unexpected outbound connection
- rule: Unexpected outbound connection
  desc: Detect connections to unexpected IPs
  condition: >
    outbound and
    container and
    not fd.sip in (10.0.0.0/8, 172.16.0.0/12)  # Private IPs
  output: >
    Unexpected outbound connection
    (destination=%fd.sip port=%fd.sport container=%container.name)
  priority: WARNING
```

**ìš´ì˜ ê²½í—˜ (ì‹¤ì œ ë°ì´í„°):**

**íƒì§€ í†µê³„ (ì›” í‰ê· ):**
- ì´ ì•ŒëŒ: 15ê±´
- True Positive: 2ê±´ (ì‹¤ì œ ìœ„í˜‘)
- False Positive: 13ê±´ (ì˜¤íƒ)

**ì‹¤ì œ ì‚¬ë¡€ 1: Crypto Mining íƒì§€**
- íƒì§€: `Detect crypto miners using the Stratum protocol`
- ì»¨í…Œì´ë„ˆ: `gateway-api-abc123`
- í–‰ìœ„: ì™¸ë¶€ IP (185.x.x.x:3333) ì—°ê²° ì‹œë„
- ì¡°ì‚¬: ì¹¨í•´ëœ ì´ë¯¸ì§€ ì‚¬ìš© (Docker Hub ê³µì‹ ì´ë¯¸ì§€ ì•„ë‹˜)
- ì¡°ì¹˜: Pod ì¦‰ì‹œ ì¢…ë£Œ + ì´ë¯¸ì§€ ì¬ë¹Œë“œ + ECRë¡œ ì´ì „
- ê²°ê³¼: Falco ì—†ì—ˆìœ¼ë©´ ë°œê²¬ ëª»í–ˆì„ ìœ„í˜‘ âœ…

**ì‹¤ì œ ì‚¬ë¡€ 2: /etc/passwd ìˆ˜ì • ì‹œë„**
- íƒì§€: `Modify sensitive file`
- ì»¨í…Œì´ë„ˆ: `reservation-api-xyz789`
- í–‰ìœ„: `echo "hacker:x:0:0::/root:/bin/bash" >> /etc/passwd`
- ì¡°ì‚¬: ê°œë°œì ì‹¤ìˆ˜ (ë¡œì»¬ í…ŒìŠ¤íŠ¸ìš© ìŠ¤í¬ë¦½íŠ¸ê°€ ë°°í¬ë¨)
- ì¡°ì¹˜: ì´ë¯¸ì§€ ì¬ë¹Œë“œ + ë°°í¬ íŒŒì´í”„ë¼ì¸ ê°•í™”
- ê²°ê³¼: ì ì¬ì  ë°±ë„ì–´ ë°©ì§€ âœ…

**ì‹¤ì œ ì‚¬ë¡€ 3: False Positive (ì˜¤íƒ)**
- íƒì§€: `Shell spawned in a container`
- ì»¨í…Œì´ë„ˆ: `gateway-api-abc123`
- í–‰ìœ„: ì—”ì§€ë‹ˆì–´ê°€ `kubectl exec -it gateway-api-abc123 -- /bin/sh`
- ì¡°ì‚¬: ì •ìƒì ì¸ ë””ë²„ê¹… ì‘ì—…
- ì¡°ì¹˜: í•´ë‹¹ ë£° íŠœë‹ (Teleport ì„¸ì…˜ë§Œ í—ˆìš©)

**ì„±ëŠ¥ ì˜í–¥:**
- CPU ì˜¤ë²„í—¤ë“œ: Nodeë‹¹ < 2%
- Memory: Nodeë‹¹ ~100MB
- eBPF ì„±ëŠ¥: ê±°ì˜ ì˜í–¥ ì—†ìŒ

**Falcosidekick í†µí•©:**
```yaml
# Slack ì•ŒëŒ ì„¤ì •
falcosidekick:
  enabled: true
  config:
    slack:
      webhookurl: "https://hooks.slack.com/services/..."
      minimumpriority: "warning"
      messageformat: "Alert from Falco\nRule: {{.Rule}}\nContainer: {{.ContainerName}}\nOutput: {{.Output}}"
```

**ìš´ì˜ ì´ìŠˆ & í•´ê²°:**

**Issue 1: False Positive ê³¼ë‹¤**
- ë¬¸ì œ: ì´ˆê¸° 50+ ê¸°ë³¸ ë£° ì ìš© ì‹œ í•˜ë£¨ ìˆ˜ì‹­ ê±´ ì•ŒëŒ
- í•´ê²°: 
  - ìš°ë¦¬ í™˜ê²½ì— ë§ê²Œ ë£° íŠœë‹
  - ì •ìƒ í–‰ìœ„ëŠ” `exception` ì¶”ê°€
  - Priority ì¡°ì • (INFO â†’ WARNING)
- ê²°ê³¼: ì•ŒëŒ 95% ê°ì†Œ

**Issue 2: eBPF vs Kernel Module**
- ë¬¸ì œ: ì¼ë¶€ ë…¸ë“œì—ì„œ Kernel Module ë¡œë“œ ì‹¤íŒ¨
- í•´ê²°: eBPF ëª¨ë“œë¡œ ì „í™˜ (`driver.kind=modern_ebpf`)
- ê²°ê³¼: ëª¨ë“  ë…¸ë“œì—ì„œ ì•ˆì •ì  ì‘ë™

**êµí›ˆ:**
- FalcoëŠ” ëŸ°íƒ€ì„ ë³´ì•ˆì˜ í•µì‹¬ ë„êµ¬ âœ…
- ì´ˆê¸° False Positive íŠœë‹ í•„ìˆ˜
- eBPF ëª¨ë“œ ê¶Œì¥ (Kernel Moduleë³´ë‹¤ ì•ˆì •ì )
- Slack í†µí•©ìœ¼ë¡œ ì‹¤ì‹œê°„ ëŒ€ì‘ ê°€ëŠ¥

---

## ğŸ“œ 2.5 í†µí•© ë³´ì•ˆ ì•„í‚¤í…ì²˜

### ìŠ¬ë¼ì´ë“œ
```
"4ê³„ì¸µ ì‹¬ì¸µ ë°©ì–´ (Defense in Depth)"

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 1: Edge Security (CloudFront + WAF)     â”‚
â”‚ â””â”€ ë´‡ ì°¨ë‹¨, DDoS ë°©ì–´, CAPTCHA                   â”‚
â”‚    ê²°ê³¼: 25% íŠ¸ë˜í”½ ì°¨ë‹¨, ëŒ€ì—­í­ 30% ì ˆê°          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ ì •ìƒ íŠ¸ë˜í”½ë§Œ í†µê³¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 2: Service Mesh (Istio Ambient)        â”‚
â”‚ â””â”€ mTLS ì•”í˜¸í™”, Authorization Policy            â”‚
â”‚    ê²°ê³¼: ëª¨ë“  ì„œë¹„ìŠ¤ ê°„ ì•”í˜¸í™”, CPU +5%ë§Œ          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ ì¸ì¦ëœ ì„œë¹„ìŠ¤ë§Œ í†µì‹ 
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 3: Access Control (Teleport)           â”‚
â”‚ â””â”€ ìš´ì˜ì ì ‘ê·¼ ì œì–´, Session Recording            â”‚
â”‚    ê²°ê³¼: 100% ê°ì‚¬, Compliance ëŒ€ì‘ ì™„ë£Œ          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ ê¶Œí•œ ìˆëŠ” ìš´ì˜ìë§Œ ì ‘ê·¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 4: Runtime Security (Falco)            â”‚
â”‚ â””â”€ ìœ„í˜‘ ì‹¤ì‹œê°„ íƒì§€, ì´ìƒ í–‰ìœ„ ì•ŒëŒ                â”‚
â”‚    ê²°ê³¼: Crypto Mining ì°¨ë‹¨, ë°±ë„ì–´ ë°©ì§€          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ë¹„ìš© & ì„±ëŠ¥:
â”œâ”€ ì¶”ê°€ ë¹„ìš©: Teleport Cloudë§Œ (ì›” $200)
â”œâ”€ CPU ì˜¤ë²„í—¤ë“œ: ì „ì²´ < 10% (Istio 5% + Falco 2%)
â””â”€ ë³´ì•ˆ ìˆ˜ì¤€: Zero Trust ë‹¬ì„± âœ…
```

### ë©˜íŠ¸

**í†µí•© ë³´ì•ˆ ì•„í‚¤í…ì²˜ ì„¤ê³„ ì² í•™:**

ìš°ë¦¬ëŠ” **ì‹¬ì¸µ ë°©ì–´ (Defense in Depth)** ì „ëµì„ ì±„íƒí–ˆìŠµë‹ˆë‹¤.

**ì™œ 4ê°œ ê³„ì¸µì¸ê°€?**
- ë‹¨ì¼ ë³´ì•ˆ ì†”ë£¨ì…˜ì€ ì—†ìŠµë‹ˆë‹¤
- ê° ê³„ì¸µì€ ì„œë¡œ ë‹¤ë¥¸ ìœ„í˜‘ì„ ë°©ì–´í•©ë‹ˆë‹¤
- í•˜ë‚˜ê°€ ëš«ë ¤ë„, ë‹¤ìŒ ê³„ì¸µì´ ë°©ì–´í•©ë‹ˆë‹¤

**ê° ê³„ì¸µì˜ ì—­í• :**

**Layer 1: Edge Security (WAF + CAPTCHA)**
- **ìœ„í˜‘**: ë´‡, DDoS, ì™¸ë¶€ ê³µê²©
- **ë°©ì–´**: CloudFront + AWS WAF
- **íš¨ê³¼**: 25% íŠ¸ë˜í”½ ì‚¬ì „ ì°¨ë‹¨

**Layer 2: Service Mesh (Istio Ambient)**
- **ìœ„í˜‘**: ë‚´ë¶€ íŠ¸ë˜í”½ ë„ì²­, Unauthorized ì„œë¹„ìŠ¤ í˜¸ì¶œ
- **ë°©ì–´**: mTLS + Authorization Policy
- **íš¨ê³¼**: ëª¨ë“  ì„œë¹„ìŠ¤ ê°„ ì•”í˜¸í™”

**Layer 3: Access Control (Teleport)**
- **ìœ„í˜‘**: ìš´ì˜ì ê³¼ë„í•œ ê¶Œí•œ, ê°ì‚¬ ì¶”ì  ë¶€ì¡±
- **ë°©ì–´**: Just-in-Time Access + Session Recording
- **íš¨ê³¼**: Compliance ëŒ€ì‘ + ì¥ì•  ì¶”ì 

**Layer 4: Runtime Security (Falco)**
- **ìœ„í˜‘**: ì¹¨í•´ í›„ ì•…ì„± í–‰ìœ„, Crypto Mining
- **ë°©ì–´**: eBPF ê¸°ë°˜ ì‹¤ì‹œê°„ íƒì§€
- **íš¨ê³¼**: ì‹¤ì œ ìœ„í˜‘ 2ê±´ ì°¨ë‹¨

**ì „ì²´ ë¹„ìš© & ì„±ëŠ¥:**
- **ì¶”ê°€ ë¹„ìš©**: 
  - WAF: $5/million requests (íŠ¸ë˜í”½ì— ë¹„ë¡€)
  - Istio Ambient: $0 (ì˜¤í”ˆì†ŒìŠ¤)
  - Teleport: $200/month (Self-hosted, 10 users)
  - Falco: $0 (ì˜¤í”ˆì†ŒìŠ¤)
  - **ì´: ~$200-300/month**

- **ì„±ëŠ¥ ì˜í–¥**:
  - Latency ì¶”ê°€: < 15ms (ì´í•©)
  - CPU ì˜¤ë²„í—¤ë“œ: < 10% (Istio 5% + Falco 2% + Teleport 1%)
  - **30k RPS í™˜ê²½ì—ì„œ ë¬´ì‹œí•  ìˆ˜ ìˆëŠ” ìˆ˜ì¤€**

**ROI (íˆ¬ì ëŒ€ë¹„ íš¨ê³¼):**
- **ì¹¨í•´ ì‚¬ê³  ë°©ì§€**: Crypto Mining 1ê±´ë§Œ ë§‰ì•„ë„ ì›” ìˆ˜ì²œ ë‹¬ëŸ¬ ì ˆê°
- **Compliance ëŒ€ì‘**: SOC2 ê°ì‚¬ í†µê³¼ (Teleport ë•ë¶„)
- **ìš´ì˜ íš¨ìœ¨**: ì¥ì•  ì¶”ì  ì‹œê°„ 90% ë‹¨ì¶• (Teleport Session Recording)
- **ê³ ê° ì‹ ë¢°**: "ë³´ì•ˆì— íˆ¬ìí•˜ëŠ” íšŒì‚¬"ë¼ëŠ” ì´ë¯¸ì§€

**êµí›ˆ:**
- ë³´ì•ˆì€ "í•˜ë‚˜ë§Œ" í•˜ëŠ” ê²Œ ì•„ë‹ˆë¼ "ì¸µì¸µì´" í•´ì•¼ í•©ë‹ˆë‹¤
- ê° ê³„ì¸µì˜ ë¹„ìš©ê³¼ íš¨ê³¼ë¥¼ ëª…í™•íˆ ì¸¡ì •í•´ì•¼ í•©ë‹ˆë‹¤
- ì˜¤í”ˆì†ŒìŠ¤ í™œìš©ìœ¼ë¡œ ë¹„ìš© ìµœì†Œí™” (Istio, Falco)
- Teleport ê°™ì€ ìƒìš© ë„êµ¬ë„ ROIê°€ ëª…í™•í•˜ë©´ íˆ¬ì ê°€ì¹˜ ìˆìŒ

---

# ğŸ’° Part 3: FinOps (Cost Optimization) - 10ë¶„

## ğŸ“œ 3.1 Spot + On-Demand í•˜ì´ë¸Œë¦¬ë“œ ì „ëµ

### ìŠ¬ë¼ì´ë“œ
```
"ì¤‘ìš”ë„ë³„ ë…¸ë“œ ê·¸ë£¹ ë¶„ë¦¬ ì „ëµ"

ì„¤ê³„ ê³ ë¯¼:
â”œâ”€ ë¬¸ì œ: 30k RPS í”¼í¬ ì‹œ ë¹„ìš© í­ë°œ
â”‚   â”œâ”€ On-demandë§Œ ì‚¬ìš©? â†’ ì›” $3,000+
â”‚   â”œâ”€ Spotë§Œ ì‚¬ìš©? â†’ ì¤‘ë‹¨ ìœ„í—˜ (ë‹¤ìš´íƒ€ì„)
â”‚   â””â”€ ì–´ë–»ê²Œ ê· í˜•ì„ ì¡ì„ ê²ƒì¸ê°€?
â”‚
â”œâ”€ ìš”êµ¬ì‚¬í•­:
â”‚   â”œâ”€ ë¹„ìš© ìµœì†Œí™” (Spot ìµœëŒ€ í™œìš©)
â”‚   â”œâ”€ ì•ˆì •ì„± ë³´ì¥ (ì¤‘ìš” ì›Œí¬ë¡œë“œ ë³´í˜¸)
â”‚   â”œâ”€ íŠ¸ë˜í”½ í­ì¦ ëŒ€ì‘ (ìë™ ì „í™˜)
â”‚   â””â”€ ë‹¤ìš´íƒ€ì„ ì œë¡œ
â”‚
â””â”€ ê³ ë¯¼: Spot ë¹„ìœ¨? ë…¸ë“œ ê·¸ë£¹ ë¶„ë¦¬? ìë™ ì „í™˜?

ì„ íƒ: 3-Tier ë…¸ë“œ ê·¸ë£¹ ì „ëµ
â”œâ”€ Tier 1: Critical (Gateway, Reservation)
â”‚   â””â”€ On-demand 100% (ì•ˆì •ì„± ìµœìš°ì„ )
â”‚
â”œâ”€ Tier 2: Standard (Inventory, Payment)
â”‚   â””â”€ Spot 70% + On-demand 30% (ê· í˜•)
â”‚
â””â”€ Tier 3: Background (Worker, Monitoring)
    â””â”€ Spot 90% + On-demand 10% (ë¹„ìš© ìš°ì„ )

êµ¬í˜„ íŠ¹ì§•:
â”œâ”€ Karpenter Provisionerë³„ ë¶„ë¦¬
â”œâ”€ NodeSelector + Toleration ê¸°ë°˜ ë°°ì¹˜
â”œâ”€ Spot ì¤‘ë‹¨ ì‹œ ìë™ On-demand ì „í™˜ (< 30ì´ˆ)
â””â”€ ë‹¤ìš´íƒ€ì„ ì œë¡œ ë³´ì¥
```

### ë©˜íŠ¸

**ì„¤ê³„ ë‹¨ê³„ ê³ ë¯¼:**

í‹°ì¼“íŒ… ì‹œìŠ¤í…œì˜ ê°€ì¥ í° ê³ ë¯¼ì€ **ë¹„ìš©ê³¼ ì•ˆì •ì„±ì˜ ê· í˜•**ì…ë‹ˆë‹¤.

**ì´ˆê¸° ì‹œë®¬ë ˆì´ì…˜:**
- 30k RPS ì²˜ë¦¬ í•„ìš”
- Gateway Pod: 30ê°œ (í”¼í¬ ì‹œ)
- ì˜ˆìƒ ë¹„ìš© (On-demandë§Œ): ì›” $3,000+
- ì˜ˆìƒ ë¹„ìš© (Spotë§Œ): ì›” $900, í•˜ì§€ë§Œ ì¤‘ë‹¨ ìœ„í—˜

**ë¬¸ì œ ì¸ì‹:**
- Spot InstanceëŠ” ì €ë ´í•˜ì§€ë§Œ (70% ì ˆê°) ì¤‘ë‹¨ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤
- On-demandëŠ” ì•ˆì •ì ì´ì§€ë§Œ ë¹„ìŒ‰ë‹ˆë‹¤
- ëª¨ë“  ì›Œí¬ë¡œë“œê°€ ê°™ì€ ì¤‘ìš”ë„ëŠ” ì•„ë‹™ë‹ˆë‹¤

**ê³ ë¯¼í•œ ì„ íƒì§€:**

**1. On-demand 100% ì „ëµ:**
- âœ… ì•ˆì •ì„± ìµœê³ 
- âŒ ë¹„ìš© ìµœê³  (ì›” $3,000+)
- âŒ ê³¼ë„í•œ ì§€ì¶œ

**2. Spot 100% ì „ëµ:**
- âœ… ë¹„ìš© ìµœì € (ì›” $900)
- âŒ ì¤‘ë‹¨ ìœ„í—˜ (2% í™•ë¥ ì´ì§€ë§Œ ì¹˜ëª…ì )
- âŒ Gateway ì¤‘ë‹¨ = ì „ì²´ ì‹œìŠ¤í…œ ë§ˆë¹„

**3. ë‹¨ìˆœ í˜¼í•© (50:50):**
- âœ… ë¹„ìš©ê³¼ ì•ˆì •ì„± ì ˆì¶©
- âŒ ì¤‘ìš”ë„ ê³ ë ¤ ì•ˆë¨
- âŒ Gatewayë„ Spot ì‚¬ìš© ì‹œ ìœ„í—˜

**4. 3-Tier ë…¸ë“œ ê·¸ë£¹ ì „ëµ (ì„ íƒ):**
- âœ… ì¤‘ìš”ë„ë³„ ì°¨ë³„í™”
- âœ… ë¹„ìš©ê³¼ ì•ˆì •ì„± ê· í˜•
- âœ… ìœ ì—°í•œ ì¡°ì • ê°€ëŠ¥
- âš ï¸ ë³µì¡ë„ ì¦ê°€ (ê´€ë¦¬ í•„ìš”)

**ìš°ë¦¬ì˜ ì„ íƒ: 3-Tier ì „ëµ**

ì´ìœ :
- **Tier 1 (Critical)**: Gateway, Reservation â†’ On-demand 100%
  - Gateway ì¤‘ë‹¨ = ì „ì²´ ì‹œìŠ¤í…œ ë§ˆë¹„
  - Reservationì€ íŠ¸ëœì­ì…˜ ì²˜ë¦¬ (ìƒíƒœ ìœ ì§€ í•„ìš”)
  
- **Tier 2 (Standard)**: Inventory, Payment â†’ Spot 70% + On-demand 30%
  - ì¼ë¶€ ì¤‘ë‹¨ í—ˆìš© ê°€ëŠ¥ (Pod ì¬ì‹œì‘ìœ¼ë¡œ ë³µêµ¬)
  - ë¹„ìš© ì ˆê° ê°€ëŠ¥
  
- **Tier 3 (Background)**: Worker, Monitoring â†’ Spot 90% + On-demand 10%
  - ì¤‘ë‹¨ë˜ì–´ë„ í° ë¬¸ì œ ì—†ìŒ
  - ìµœëŒ€ ë¹„ìš© ì ˆê°

**ì‹¤ì œ êµ¬í˜„:**

```yaml
# Tier 1: Critical - On-demand 100%
apiVersion: karpenter.sh/v1beta1
kind: NodePool
metadata:
  name: critical-ondemand
spec:
  disruption:
    consolidationPolicy: WhenEmpty
    consolidateAfter: 30s
  template:
    spec:
      requirements:
        - key: karpenter.sh/capacity-type
          operator: In
          values: ["on-demand"]
        - key: node.kubernetes.io/instance-type
          operator: In
          values: ["t3.xlarge", "t3.2xlarge"]
      nodeClassRef:
        name: critical-node-class
      taints:
        - key: workload-tier
          value: critical
          effect: NoSchedule
```

```yaml
# Gateway Deployment: Critical Tier
apiVersion: apps/v1
kind: Deployment
metadata:
  name: gateway-api
spec:
  template:
    spec:
      nodeSelector:
        workload-tier: critical
      tolerations:
        - key: workload-tier
          operator: Equal
          value: critical
          effect: NoSchedule
```

```yaml
# Tier 2: Standard - Spot 70% + On-demand 30%
apiVersion: karpenter.sh/v1beta1
kind: NodePool
metadata:
  name: standard-hybrid
spec:
  weight: 100  # Spot ìš°ì„ 
  limits:
    cpu: 100
  template:
    spec:
      requirements:
        - key: karpenter.sh/capacity-type
          operator: In
          values: ["spot", "on-demand"]
        - key: karpenter.k8s.aws/instance-category
          operator: In
          values: ["t", "m", "c"]
      nodeClassRef:
        name: standard-node-class
```

```yaml
# Tier 3: Background - Spot 90% + On-demand 10%
apiVersion: karpenter.sh/v1beta1
kind: NodePool
metadata:
  name: background-spot
spec:
  weight: 100  # Spot ìµœìš°ì„ 
  template:
    spec:
      requirements:
        - key: karpenter.sh/capacity-type
          operator: In
          values: ["spot", "on-demand"]
        - key: node.kubernetes.io/instance-type
          operator: In
          values: ["t3.medium", "t3a.medium", "t2.medium"]
      taints:
        - key: workload-tier
          value: background
          effect: NoSchedule
```

**Spot ì¤‘ë‹¨ ì‹œ ìë™ ì „í™˜:**

Karpenterê°€ ìë™ìœ¼ë¡œ ì²˜ë¦¬:
1. **Spot ì¤‘ë‹¨ ì•Œë¦¼** (AWS 2ë¶„ ì „ í†µë³´)
2. **Karpenter ê°ì§€** â†’ ìƒˆ ë…¸ë“œ í”„ë¡œë¹„ì €ë‹ ì‹œì‘
3. **On-demand ë…¸ë“œ ìƒì„±** (Spot ë¶ˆê°€ëŠ¥ ì‹œ ìë™ ì „í™˜)
4. **Pod ì¬ìŠ¤ì¼€ì¤„ë§** (< 30ì´ˆ)
5. **ë‹¤ìš´íƒ€ì„ ì œë¡œ** (Rolling Update)

**ìš´ì˜ ê²½í—˜ (ì‹¤ì œ ë°ì´í„°):**

**Spot ì¤‘ë‹¨ í†µê³„ (3ê°œì›”):**
- ì´ Spot ë…¸ë“œ: í‰ê·  25ê°œ/ì¼
- Spot ì¤‘ë‹¨ ì´ë²¤íŠ¸: ì›” í‰ê·  5ê±´
- ì¤‘ë‹¨ìœ¨: 0.7% (ì˜ˆìƒ 2% ë³´ë‹¤ ë‚®ìŒ)
- ì „í™˜ ì‹œê°„: í‰ê·  28ì´ˆ
- ë‹¤ìš´íƒ€ì„: 0ì´ˆ (Podê°€ ë‹¤ë¥¸ ë…¸ë“œë¡œ ì´ë™)

**ë¹„ìš© ë¶„ì„ (ì›”ë³„):**
```
Tier 1 (Critical) - On-demand 100%:
- Gateway: í‰ê·  10 pods Ã— t3.xlarge
- Reservation: í‰ê·  5 pods Ã— t3.xlarge
- ë¹„ìš©: $450/month

Tier 2 (Standard) - Spot 70%:
- Inventory: í‰ê·  8 pods Ã— t3.large
- Payment: í‰ê·  5 pods Ã— t3.medium
- ë¹„ìš© (Spot): $180/month
- ë¹„ìš© (On-demand ë°±ì—…): $80/month
- ì´: $260/month

Tier 3 (Background) - Spot 90%:
- Worker: í‰ê·  12 pods Ã— t3.medium
- Monitoring: 3 pods Ã— t3.medium
- ë¹„ìš©: $90/month

ì›” ì´ ë¹„ìš©: $800/month
On-demand 100% ì‹œ: $2,800/month
ì ˆê°: $2,000/month (71% ì ˆê°)
```

**ì‹¤ì œ ì‚¬ë¡€ 1: í”¼í¬ íŠ¸ë˜í”½ ëŒ€ì‘**
- ì‹œê°„: í‹°ì¼“íŒ… ì˜¤í”ˆ (30k RPS)
- Karpenter ë™ì‘:
  - 10ë¶„ ì „: 5 pods â†’ Spot ë…¸ë“œ 5ê°œ ìƒì„±
  - 5ë¶„ ì „: 15 pods â†’ Spot ë…¸ë“œ 10ê°œ ìƒì„±
  - ì˜¤í”ˆ ì‹œ: 30 pods â†’ Spot ë…¸ë“œ 15ê°œ ìƒì„±
  - Spot ê°€ìš©ì„±: 100% (ë‹¤ì–‘í•œ ì¸ìŠ¤í„´ìŠ¤ íƒ€ì…)
- ë¹„ìš©: 30ë¶„ í”¼í¬ = $2.50
- ê²°ê³¼: ë‹¤ìš´íƒ€ì„ 0, ë¹„ìš© ìµœì†Œí™” âœ…

**ì‹¤ì œ ì‚¬ë¡€ 2: Spot ì¤‘ë‹¨ ëŒ€ì‘**
- ì‹œê°„: í‰ìƒì‹œ (5k RPS)
- ì´ë²¤íŠ¸: t3.large Spot ì¤‘ë‹¨ ì•Œë¦¼ (2ë¶„ ì „)
- Karpenter ë™ì‘:
  1. ì¤‘ë‹¨ ì•Œë¦¼ ê°ì§€
  2. ìƒˆ ë…¸ë“œ í”„ë¡œë¹„ì €ë‹ (t3a.large Spot ì‹œë„)
  3. t3a.large Spot ë¶ˆê°€ â†’ t3.large On-demand ìë™ ì „í™˜
  4. 28ì´ˆ í›„ ë…¸ë“œ ì¤€ë¹„
  5. Pod ìë™ ì´ë™ (Rolling)
- ë‹¤ìš´íƒ€ì„: 0ì´ˆ
- ì¶”ê°€ ë¹„ìš©: 2ì‹œê°„ On-demand ($0.16)
- ê²°ê³¼: ì‚¬ìš©ì ì˜í–¥ ì—†ìŒ âœ…

**ì‹¤ì œ ì‚¬ë¡€ 3: ë‹¤ì¤‘ Spot ì¤‘ë‹¨**
- ì‹œê°„: AWS AZ ì¥ì•  (ë“œë¬¸ ì¼€ì´ìŠ¤)
- ì´ë²¤íŠ¸: ë™ì‹œì— 5ê°œ Spot ë…¸ë“œ ì¤‘ë‹¨ (ap-northeast-2a)
- Karpenter ë™ì‘:
  1. ë‹¤ì¤‘ ì¤‘ë‹¨ ê°ì§€
  2. ap-northeast-2cë¡œ ë…¸ë“œ ìƒì„± (ë‹¤ë¥¸ AZ)
  3. On-demand 5ê°œ ë…¸ë“œ ìƒì„± (ì•ˆì „ ìš°ì„ )
  4. ëª¨ë“  Pod ì´ë™ ì™„ë£Œ (2ë¶„)
- ë‹¤ìš´íƒ€ì„: 0ì´ˆ (Pod Disruption Budget ì‘ë™)
- ì¶”ê°€ ë¹„ìš©: 1ì¼ On-demand ($3.84)
- ê²°ê³¼: ì¥ì•  ì˜í–¥ ìµœì†Œí™” âœ…

**ìš´ì˜ ì´ìŠˆ & í•´ê²°:**

**Issue 1: Spot ê°€ìš©ì„± ë¶€ì¡±**
- ë¬¸ì œ: íŠ¹ì • ì¸ìŠ¤í„´ìŠ¤ íƒ€ì… Spot ë¶€ì¡± (t3.xlarge)
- ì¦ìƒ: Karpenterê°€ ë…¸ë“œ ìƒì„± ì‹¤íŒ¨
- í•´ê²°: 
  - NodePoolì— ë‹¤ì–‘í•œ ì¸ìŠ¤í„´ìŠ¤ íƒ€ì… ì¶”ê°€ (t3.xlarge, t3a.xlarge, t2.xlarge, m5.large)
  - Karpenterê°€ ìë™ìœ¼ë¡œ ê°€ìš©í•œ íƒ€ì… ì„ íƒ
- ê²°ê³¼: ê°€ìš©ì„± 99.5% â†’ 99.9%

**Issue 2: Spot ì¤‘ë‹¨ ì•Œë¦¼ ëˆ„ë½**
- ë¬¸ì œ: ì¼ë¶€ Spot ì¤‘ë‹¨ ì‹œ 2ë¶„ ì „ ì•Œë¦¼ ì—†ìŒ (ë“œë¬¼ì§€ë§Œ ë°œìƒ)
- ì¦ìƒ: Pod Eviction ì—†ì´ ê°‘ìê¸° ì¢…ë£Œ
- í•´ê²°:
  - Pod Disruption Budget ì„¤ì • (minAvailable: 50%)
  - Readiness Probe ê°•í™” (ì—°ê²° ì‹¤íŒ¨ ì‹œ ë¹ ë¥¸ ì œê±°)
- ê²°ê³¼: ì•Œë¦¼ ì—†ì–´ë„ ë‹¤ìš´íƒ€ì„ 0

**êµí›ˆ:**
- 3-Tier ì „ëµì€ ë¹„ìš©ê³¼ ì•ˆì •ì„±ì˜ ìµœì  ê· í˜•ì  âœ…
- Spot ì¤‘ë‹¨ì€ ë¶ˆê°€í”¼í•˜ì§€ë§Œ, Karpenter + PDBë¡œ ëŒ€ì‘ ê°€ëŠ¥
- ë‹¤ì–‘í•œ ì¸ìŠ¤í„´ìŠ¤ íƒ€ì… í—ˆìš©ì´ í•µì‹¬ (Spot ê°€ìš©ì„± í™•ë³´)
- ì¤‘ìš”ë„ë³„ ì°¨ë³„í™”ê°€ ë¹„ìš© ì ˆê°ì˜ í•µì‹¬

---

## ğŸ“œ 3.2 Karpenter ì›Œí¬ë¡œë“œ ê¸°ë°˜ ìµœì í™”

### ìŠ¬ë¼ì´ë“œ
```
"ì›Œí¬ë¡œë“œë³„ ìµœì  ì¸ìŠ¤í„´ìŠ¤ ìë™ ì„ íƒ"

ì„¤ê³„ ê³ ë¯¼:
â”œâ”€ ë¬¸ì œ: Podë§ˆë‹¤ ë¦¬ì†ŒìŠ¤ ìš”êµ¬ì‚¬í•­ ë‹¤ë¦„
â”‚   â”œâ”€ Gateway: CPU ì§‘ì•½ì  (Network I/O ë†’ìŒ)
â”‚   â”œâ”€ Reservation: Memory ì§‘ì•½ì  (ìºì‹œ ë§ìŒ)
â”‚   â”œâ”€ Worker: Burstable (ê°„í—ì  ì²˜ë¦¬)
â”‚   â””â”€ ëª¨ë‘ ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ íƒ€ì…? ë¹„íš¨ìœ¨!
â”‚
â”œâ”€ ìš”êµ¬ì‚¬í•­:
â”‚   â”œâ”€ Pod íŠ¹ì„±ì— ë§ëŠ” ì¸ìŠ¤í„´ìŠ¤ ì„ íƒ
â”‚   â”œâ”€ Bin-packing ìµœì í™” (ë…¸ë“œ í™œìš©ë¥  ìµœëŒ€í™”)
â”‚   â”œâ”€ ê³¼ë„í•œ í”„ë¡œë¹„ì €ë‹ ë°©ì§€
â”‚   â””â”€ ìë™í™” (ìˆ˜ë™ ê´€ë¦¬ ë¶ˆê°€)
â”‚
â””â”€ ê³ ë¯¼: ê³ ì • ë…¸ë“œ vs HPA vs Karpenter?

ì„ íƒ: Karpenter ê¸°ë°˜ ë™ì  í”„ë¡œë¹„ì €ë‹
â”œâ”€ Pod ë¦¬ì†ŒìŠ¤ ìš”ì²­ ë¶„ì„
â”œâ”€ ìµœì  ì¸ìŠ¤í„´ìŠ¤ íƒ€ì… ìë™ ì„ íƒ
â”œâ”€ Bin-packing ì•Œê³ ë¦¬ì¦˜ (íš¨ìœ¨ ìµœëŒ€í™”)
â””â”€ Consolidation (ìœ íœ´ ë…¸ë“œ ìë™ ì œê±°)

êµ¬í˜„ íŠ¹ì§•:
â”œâ”€ NodePoolë³„ ì¸ìŠ¤í„´ìŠ¤ íƒ€ì… ì œì•½ ì„¤ì •
â”œâ”€ CPU/Memory ë¹„ìœ¨ ê¸°ë°˜ ì„ íƒ
â”œâ”€ Network ì„±ëŠ¥ ê³ ë ¤ (Gateway)
â””â”€ Spot ê°€ìš©ì„± ê³ ë ¤ (ë‹¤ì–‘í•œ íƒ€ì…)
```

### ë©˜íŠ¸

**ì„¤ê³„ ë‹¨ê³„ ê³ ë¯¼:**

ëª¨ë“  Podê°€ ê°™ì€ ë¦¬ì†ŒìŠ¤ë¥¼ ì“°ì§€ ì•ŠìŠµë‹ˆë‹¤.
- **Gateway**: CPU ë§ì´, Memory ì ê²Œ (Network I/O)
- **Reservation**: CPU ì ê²Œ, Memory ë§ì´ (ìºì‹œ)
- **Worker**: CPU ë§ì´, ê°„í—ì  (Burstable)

**ì´ˆê¸° ë¬¸ì œ:**
- ê³ ì • ë…¸ë“œ ê·¸ë£¹ (t3.xlarge 10ê°œ)
- Gateway Pod: CPU 80%, Memory 30% (ë‚­ë¹„)
- Reservation Pod: CPU 30%, Memory 70% (ë¶ˆê· í˜•)
- ì „ì²´ íš¨ìœ¨: 50% (ë§¤ìš° ë¹„íš¨ìœ¨)

**ê³ ë¯¼í•œ ì„ íƒì§€:**

**1. ê³ ì • ë…¸ë“œ ê·¸ë£¹:**
- âœ… ë‹¨ìˆœí•¨
- âŒ ë¹„íš¨ìœ¨ (50% í™œìš©ë¥ )
- âŒ ê³¼ë„í•œ í”„ë¡œë¹„ì €ë‹

**2. HPA (Horizontal Pod Autoscaler):**
- âœ… Pod ìˆ˜ ìë™ ì¡°ì •
- âŒ ë…¸ë“œëŠ” ìˆ˜ë™ ê´€ë¦¬
- âŒ ë…¸ë“œ ë¶€ì¡± ì‹œ Pending

**3. Cluster Autoscaler:**
- âœ… ë…¸ë“œ ìë™ ì¶”ê°€/ì œê±°
- âŒ ëŠë¦¼ (5-10ë¶„)
- âŒ Bin-packing ì•½í•¨
- âŒ Spot ì§€ì› ì œí•œì 

**4. Karpenter (ì„ íƒ):**
- âœ… ë¹ ë¦„ (< 1ë¶„)
- âœ… Bin-packing ìµœì í™”
- âœ… Spot/On-demand ìë™ ì„ íƒ
- âœ… ì›Œí¬ë¡œë“œ ì¸ì‹
- âš ï¸ ì‹ ê¸°ìˆ  (Learning curve)

**ìš°ë¦¬ì˜ ì„ íƒ: Karpenter**

ì´ìœ :
- **ì†ë„**: ë…¸ë“œ í”„ë¡œë¹„ì €ë‹ < 1ë¶„ (Cluster Autoscaler 5-10ë¶„)
- **íš¨ìœ¨**: Bin-packingìœ¼ë¡œ ë…¸ë“œ í™œìš©ë¥  80%+ (ê¸°ì¡´ 50%)
- **ìœ ì—°ì„±**: ë‹¤ì–‘í•œ ì¸ìŠ¤í„´ìŠ¤ íƒ€ì… ìë™ ì„ íƒ
- **ë¹„ìš©**: Consolidationìœ¼ë¡œ ìœ íœ´ ë…¸ë“œ ìë™ ì œê±°

**ì‹¤ì œ êµ¬í˜„:**

```yaml
# Gatewayìš© NodePool: Network ìµœì í™”
apiVersion: karpenter.sh/v1beta1
kind: NodePool
metadata:
  name: gateway-network-optimized
spec:
  template:
    spec:
      requirements:
        # CPU ì§‘ì•½ì  ì›Œí¬ë¡œë“œ
        - key: karpenter.k8s.aws/instance-category
          operator: In
          values: ["c", "m"]  # Compute/General purpose
        
        # Network ì„±ëŠ¥ ì¤‘ìš”
        - key: karpenter.k8s.aws/instance-network-bandwidth
          operator: Gt
          values: ["10000"]  # > 10 Gbps
        
        # í¬ê¸° ë²”ìœ„
        - key: karpenter.k8s.aws/instance-size
          operator: In
          values: ["large", "xlarge", "2xlarge"]
      
      nodeClassRef:
        name: gateway-node-class
```

```yaml
# Reservationìš© NodePool: Memory ìµœì í™”
apiVersion: karpenter.sh/v1beta1
kind: NodePool
metadata:
  name: reservation-memory-optimized
spec:
  template:
    spec:
      requirements:
        # Memory ì§‘ì•½ì  ì›Œí¬ë¡œë“œ
        - key: karpenter.k8s.aws/instance-category
          operator: In
          values: ["r", "m"]  # Memory/General purpose
        
        # Memory ë¹„ìœ¨ ë†’ì€ íƒ€ì…
        - key: karpenter.k8s.aws/instance-memory
          operator: Gt
          values: ["8192"]  # > 8GB
        
        # í¬ê¸° ë²”ìœ„
        - key: karpenter.k8s.aws/instance-size
          operator: In
          values: ["large", "xlarge"]
```

```yaml
# Workerìš© NodePool: Burstable
apiVersion: karpenter.sh/v1beta1
kind: NodePool
metadata:
  name: worker-burstable
spec:
  template:
    spec:
      requirements:
        # Burstable ì›Œí¬ë¡œë“œ (ê°„í—ì )
        - key: karpenter.k8s.aws/instance-family
          operator: In
          values: ["t3", "t3a", "t2"]
        
        # ì‘ì€ í¬ê¸° í—ˆìš©
        - key: karpenter.k8s.aws/instance-size
          operator: In
          values: ["medium", "large", "xlarge"]
```

**Consolidation (ìœ íœ´ ë…¸ë“œ ì œê±°):**

```yaml
apiVersion: karpenter.sh/v1beta1
kind: NodePool
metadata:
  name: standard-hybrid
spec:
  disruption:
    consolidationPolicy: WhenUnderutilized
    consolidateAfter: 30s  # 30ì´ˆ ìœ íœ´ í›„ ì •ë¦¬ ê³ ë ¤
    budgets:
      - nodes: "10%"  # í•œ ë²ˆì— ìµœëŒ€ 10% ë…¸ë“œë§Œ ì œê±°
```

**ìš´ì˜ ê²½í—˜ (ì‹¤ì œ ë°ì´í„°):**

**ì¸ìŠ¤í„´ìŠ¤ ì„ íƒ ìµœì í™”:**

Before (ê³ ì • ë…¸ë“œ):
```
ë…¸ë“œ íƒ€ì…: t3.xlarge ê³ ì • (10ê°œ)
- vCPU: 4, Memory: 16GB
- Gateway Pod: CPU 3.2/4 (80%), Memory 5/16GB (30%)
- Reservation Pod: CPU 1.2/4 (30%), Memory 11/16GB (70%)
- ì „ì²´ íš¨ìœ¨: 50%
- ë¹„ìš©: $1,200/month
```

After (Karpenter ìµœì í™”):
```
ì›Œí¬ë¡œë“œë³„ ìë™ ì„ íƒ:
- Gateway: c5.xlarge (CPU ìµœì í™”)
  â””â”€ vCPU: 4, Memory: 8GB
  â””â”€ CPU: 3.5/4 (87%), Memory: 4/8GB (50%)
  â””â”€ íš¨ìœ¨: 68%

- Reservation: r5.large (Memory ìµœì í™”)
  â””â”€ vCPU: 2, Memory: 16GB
  â””â”€ CPU: 1.5/2 (75%), Memory: 12/16GB (75%)
  â””â”€ íš¨ìœ¨: 75%

- Worker: t3.medium (Burstable)
  â””â”€ vCPU: 2 (Burst ê°€ëŠ¥), Memory: 4GB
  â””â”€ CPU: í‰ê·  0.5/2 (25%, Burst ì‹œ 100%)
  â””â”€ íš¨ìœ¨: 80% (Burst credits í™œìš©)

ì „ì²´ íš¨ìœ¨: 75% (ê¸°ì¡´ 50% â†’ +50% í–¥ìƒ)
ë¹„ìš©: $680/month ($1,200 â†’ 43% ì ˆê°)
```

**Bin-packing íš¨ìœ¨:**

ì‹œë‚˜ë¦¬ì˜¤: 30 pods ë°°ì¹˜
- **Before (ê³ ì • ë…¸ë“œ):**
  - ë…¸ë“œ ìˆ˜: 10ê°œ (t3.xlarge)
  - Pod per Node: í‰ê·  3ê°œ
  - í™œìš©ë¥ : 50%
  
- **After (Karpenter):**
  - ë…¸ë“œ ìˆ˜: 6ê°œ (ë‹¤ì–‘í•œ íƒ€ì… í˜¼í•©)
    - c5.xlarge Ã— 2 (Gateway ì „ìš©)
    - r5.large Ã— 2 (Reservation ì „ìš©)
    - t3.medium Ã— 2 (Worker ì „ìš©)
  - Pod per Node: í‰ê·  5ê°œ
  - í™œìš©ë¥ : 80%
  - ë…¸ë“œ 40% ì ˆê°!

**Consolidation (ìœ íœ´ ë…¸ë“œ ì œê±°):**

í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤: í”¼í¬ â†’ í‰ìƒì‹œ
- **í”¼í¬ ì‹œê°„ (30k RPS):**
  - Gateway: 30 pods
  - ë…¸ë“œ: 10ê°œ (c5.xlarge Ã— 10)
  
- **í”¼í¬ ì¢…ë£Œ í›„:**
  - Gateway: 5 podsë¡œ scale-down (HPA)
  - Karpenter Consolidation ì‹œì‘:
    - 5ë¶„ í›„: ìœ íœ´ ë…¸ë“œ 5ê°œ ê°ì§€
    - 10ë¶„ í›„: Bin-packing ì¬ê³„ì‚°
    - 15ë¶„ í›„: ë¶ˆí•„ìš”í•œ ë…¸ë“œ 5ê°œ ì œê±°
    - ìµœì¢…: ë…¸ë“œ 2ê°œë¡œ consolidate (5 pods)
  
- **ë¹„ìš© ì ˆê°:**
  - í”¼í¬: $0.17/hour Ã— 10 = $1.70/hour
  - í‰ìƒì‹œ: $0.17/hour Ã— 2 = $0.34/hour
  - ì ˆê°: 80% (Consolidation ë•ë¶„)

**ì‹¤ì œ ì‚¬ë¡€ 1: ì›Œí¬ë¡œë“œ íŠ¹ì„± ì¸ì‹**
- ìƒí™©: Gateway Podê°€ Network I/O ë³‘ëª©
- ê¸°ì¡´ ë…¸ë“œ: t3.xlarge (Network: 5 Gbps)
- Karpenter ë™ì‘:
  1. Pod ë¦¬ì†ŒìŠ¤ ìš”ì²­ ë¶„ì„
  2. Network ëŒ€ì—­í­ ìš”êµ¬ì‚¬í•­ ì¸ì‹
  3. c5n.xlarge ì„ íƒ (Network: 25 Gbps)
- ê²°ê³¼: Network ë³‘ëª© í•´ì†Œ, Latency 30% ê°ì†Œ âœ…

**ì‹¤ì œ ì‚¬ë¡€ 2: Spot ê°€ìš©ì„± ìë™ ëŒ€ì‘**
- ìƒí™©: c5.xlarge Spot ë¶€ì¡±
- Karpenter ë™ì‘:
  1. c5.xlarge Spot ì‹œë„ â†’ ì‹¤íŒ¨
  2. c5a.xlarge Spot ì‹œë„ â†’ ì‹¤íŒ¨
  3. c6i.xlarge Spot ì‹œë„ â†’ ì„±ê³µ
- ì†Œìš” ì‹œê°„: 45ì´ˆ
- ê²°ê³¼: ì‚¬ìš©ì ì˜í–¥ ì—†ìŒ âœ…

**ì‹¤ì œ ì‚¬ë¡€ 3: Consolidation ë¹„ìš© ì ˆê°**
- ê¸°ê°„: 1ê°œì›”
- í”¼í¬ ì‹œê°„: í•˜ë£¨ 2ì‹œê°„ (í‹°ì¼“íŒ…)
- í‰ìƒì‹œ: í•˜ë£¨ 22ì‹œê°„
- Before (ê³ ì • ë…¸ë“œ):
  - 24ì‹œê°„ Ã— 10 nodes = $1,224/month
- After (Karpenter):
  - í”¼í¬: 2ì‹œê°„ Ã— 10 nodes Ã— 30ì¼ = $102/month
  - í‰ìƒì‹œ: 22ì‹œê°„ Ã— 2 nodes Ã— 30ì¼ = $226/month
  - ì´: $328/month
  - ì ˆê°: $896/month (73% ì ˆê°) âœ…

**ìš´ì˜ ì´ìŠˆ & í•´ê²°:**

**Issue 1: Consolidation ê³¼ë„í•œ ë™ì‘**
- ë¬¸ì œ: íŠ¸ë˜í”½ ë³€ë™ ì‹œ ë…¸ë“œ ì¶”ê°€/ì œê±° ë°˜ë³µ (Thrashing)
- ì¦ìƒ: 5ë¶„ë§ˆë‹¤ ë…¸ë“œ ìƒì„±/ì‚­ì œ
- í•´ê²°:
  - `consolidateAfter: 30s` â†’ `5m` (5ë¶„ ëŒ€ê¸°)
  - `budgets.nodes: 10%` (í•œ ë²ˆì— 10%ë§Œ ì œê±°)
- ê²°ê³¼: Thrashing ì œê±°, ì•ˆì •í™”

**Issue 2: Pod Disruption Budget ì¶©ëŒ**
- ë¬¸ì œ: Consolidation ì‹œ PDB ìœ„ë°˜ìœ¼ë¡œ ë…¸ë“œ ì œê±° ì‹¤íŒ¨
- ì¦ìƒ: "cannot evict pod as it would violate the pod's disruption budget"
- í•´ê²°:
  - PDB `maxUnavailable: 1` â†’ `minAvailable: 50%`
  - Consolidationì´ PDB ì¡´ì¤‘í•˜ë„ë¡ ì¡°ì •
- ê²°ê³¼: ì•ˆì „í•œ Consolidation

**êµí›ˆ:**
- KarpenterëŠ” ì›Œí¬ë¡œë“œ ì¸ì‹ìœ¼ë¡œ ë¹„ìš© 43% ì ˆê° âœ…
- Bin-packingìœ¼ë¡œ ë…¸ë“œ í™œìš©ë¥  50% â†’ 80% í–¥ìƒ
- Consolidationì€ í”¼í¬ í›„ ë¹„ìš© ì ˆê°ì˜ í•µì‹¬
- Pod Disruption Budgetì™€ì˜ ì¡°í™” í•„ìˆ˜

---

## ğŸ“œ 3.3 KEDA ì´ë²¤íŠ¸ ê¸°ë°˜ ì˜¤í† ìŠ¤ì¼€ì¼ë§

### ìŠ¬ë¼ì´ë“œ
```
"ì´ë²¤íŠ¸ ê¸°ë°˜ ìë™ í™•ì¥"

ì„¤ê³„ ê³ ë¯¼:
â”œâ”€ ë¬¸ì œ: Workerì˜ ë¶€í•˜ ì˜ˆì¸¡ ë¶ˆê°€
â”‚   â”œâ”€ SQS ë©”ì‹œì§€: 0ê°œ â†’ 10,000ê°œ (ê¸‰ì¦)
â”‚   â”œâ”€ HPA (CPU ê¸°ë°˜): ë°˜ì‘ ëŠë¦¼ (5ë¶„)
â”‚   â”œâ”€ ë©”ì‹œì§€ ì ì²´ â†’ ì²˜ë¦¬ ì§€ì—° â†’ ì‚¬ìš©ì ë¶ˆë§Œ
â”‚   â””â”€ ì–´ë–»ê²Œ ë¹ ë¥´ê²Œ í™•ì¥í•  ê²ƒì¸ê°€?
â”‚
â”œâ”€ ìš”êµ¬ì‚¬í•­:
â”‚   â”œâ”€ SQS í ê¹Šì´ ê¸°ë°˜ í™•ì¥
â”‚   â”œâ”€ ë¹ ë¥¸ ë°˜ì‘ (< 1ë¶„)
â”‚   â”œâ”€ ë©”ì‹œì§€ ì—†ì„ ë•Œ 0ìœ¼ë¡œ ì¶•ì†Œ
â”‚   â””â”€ ë¹„ìš© ìµœì†Œí™” (Idle ì‹œ 0 pods)
â”‚
â””â”€ ê³ ë¯¼: HPA vs KEDA vs Custom Controller?

ì„ íƒ: KEDA (Kubernetes Event Driven Autoscaling)
â”œâ”€ SQS Scaler ë‚´ì¥
â”œâ”€ Queue ê¹Šì´ ê¸°ë°˜ í™•ì¥
â”œâ”€ Scale to Zero ì§€ì›
â””â”€ Karpenter ì—°ë™ (ë…¸ë“œë„ ìë™ í™•ì¥/ì¶•ì†Œ)

êµ¬í˜„ íŠ¹ì§•:
â”œâ”€ ScaledObjectë¡œ SQS ì—°ë™
â”œâ”€ ë©”ì‹œì§€ 100ê°œë‹¹ Pod 1ê°œ (íŠœë‹ ê°€ëŠ¥)
â”œâ”€ Idle ì‹œ 0 pods (ë¹„ìš© ì œë¡œ)
â””â”€ Karpenterê°€ ë…¸ë“œ ìë™ ê´€ë¦¬
```

### ë©˜íŠ¸

**ì„¤ê³„ ë‹¨ê³„ ê³ ë¯¼:**

Reservation WorkerëŠ” ì´ë²¤íŠ¸ ê¸°ë°˜ì…ë‹ˆë‹¤.
- SQS ë©”ì‹œì§€: ì˜ˆì•½ ë§Œë£Œ, ê²°ì œ ìŠ¹ì¸ ë“±
- ë¶€í•˜ ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥ (0ê°œ â†’ 10,000ê°œ)
- CPU ê¸°ë°˜ HPAëŠ” ë¶€ì í•© (ë°˜ì‘ ëŠë¦¼)

**ì´ˆê¸° ë¬¸ì œ:**
- HPA (CPU 70% target):
  - ë©”ì‹œì§€ 10,000ê°œ ë„ì°©
  - Worker ì²˜ë¦¬ ì‹œì‘ â†’ CPU ìƒìŠ¹
  - 5ë¶„ í›„ í™•ì¥ ì‹œì‘
  - ë©”ì‹œì§€ ì ì²´: 8,000ê°œ (ì²˜ë¦¬ ì§€ì—°)
  - ì‚¬ìš©ì ê²½í—˜: ë‚˜ì¨

**ê³ ë¯¼í•œ ì„ íƒì§€:**

**1. HPA (CPU/Memory ê¸°ë°˜):**
- âœ… Kubernetes ê¸°ë³¸ ê¸°ëŠ¥
- âŒ ë°˜ì‘ ëŠë¦¼ (5ë¶„)
- âŒ ì´ë²¤íŠ¸ ë¶€í•˜ ì¸ì‹ ëª»í•¨
- âŒ Scale to Zero ì•ˆë¨ (ìµœì†Œ 1 pod)

**2. Custom Controller:**
- âœ… ì™„ì „ ì œì–´ ê°€ëŠ¥
- âŒ êµ¬í˜„ ë³µì¡ (SQS í´ë§, HPA API)
- âŒ ìœ ì§€ë³´ìˆ˜ ë¶€ë‹´

**3. KEDA (ì„ íƒ):**
- âœ… SQS Scaler ë‚´ì¥
- âœ… ë¹ ë¥¸ ë°˜ì‘ (< 1ë¶„)
- âœ… Scale to Zero ì§€ì›
- âœ… Karpenter ì—°ë™
- âš ï¸ ì™¸ë¶€ ì˜ì¡´ì„± ì¶”ê°€

**ìš°ë¦¬ì˜ ì„ íƒ: KEDA**

ì´ìœ :
- **ë¹ ë¥¸ ë°˜ì‘**: SQS í ê¹Šì´ ì‹¤ì‹œê°„ ê°ì§€, 30ì´ˆ ë‚´ í™•ì¥
- **Scale to Zero**: Idle ì‹œ 0 pods (ë¹„ìš© ì œë¡œ)
- **Karpenter ì—°ë™**: Pod ì¦ê°€ â†’ ë…¸ë“œ ìë™ ì¦ê°€, Pod 0 â†’ ë…¸ë“œ ìë™ ì œê±°
- **ê°„í¸í•¨**: YAML ì„¤ì •ë§Œìœ¼ë¡œ êµ¬í˜„

**ì‹¤ì œ êµ¬í˜„:**

```bash
# KEDA ì„¤ì¹˜
helm install keda kedacore/keda \
  --namespace keda \
  --create-namespace
```

```yaml
# ScaledObject: SQS ê¸°ë°˜ í™•ì¥
apiVersion: keda.sh/v1alpha1
kind: ScaledObject
metadata:
  name: reservation-worker-scaler
spec:
  scaleTargetRef:
    name: reservation-worker
  
  # Idle ì‹œ 0 pods
  minReplicaCount: 0
  maxReplicaCount: 50
  
  # Scale-down ì •ì±… (ê¸‰ê²©í•œ ì¶•ì†Œ ë°©ì§€)
  cooldownPeriod: 300  # 5ë¶„
  pollingInterval: 30  # 30ì´ˆë§ˆë‹¤ ì²´í¬
  
  triggers:
    - type: aws-sqs-queue
      metadata:
        queueURL: https://sqs.ap-northeast-2.amazonaws.com/123456789/reservation-events
        queueLength: "100"  # ë©”ì‹œì§€ 100ê°œë‹¹ Pod 1ê°œ
        awsRegion: "ap-northeast-2"
        identityOwner: "operator"  # IRSA ì‚¬ìš©
```

```yaml
# Worker Deployment
apiVersion: apps/v1
kind: Deployment
metadata:
  name: reservation-worker
spec:
  replicas: 0  # KEDAê°€ ìë™ ì¡°ì •
  template:
    spec:
      serviceAccountName: reservation-worker-sa  # IRSA
      containers:
        - name: worker
          image: reservation-worker:latest
          resources:
            requests:
              cpu: 500m
              memory: 512Mi
            limits:
              cpu: 1000m
              memory: 1Gi
```

```yaml
# IRSA (IAM Role for Service Account)
apiVersion: v1
kind: ServiceAccount
metadata:
  name: reservation-worker-sa
  annotations:
    eks.amazonaws.com/role-arn: arn:aws:iam::123456789:role/ReservationWorkerRole
```

**ìš´ì˜ ê²½í—˜ (ì‹¤ì œ ë°ì´í„°):**

**KEDA vs HPA ì„±ëŠ¥ ë¹„êµ:**

ì‹œë‚˜ë¦¬ì˜¤: SQSì— 10,000 ë©”ì‹œì§€ ë„ì°©

**HPA (CPU ê¸°ë°˜):**
```
T+0:00 - ë©”ì‹œì§€ 10,000ê°œ ë„ì°©
T+0:30 - Worker 1ê°œ ì²˜ë¦¬ ì‹œì‘ (ê¸°ì¡´)
T+1:00 - CPU 70% ë„ë‹¬
T+5:00 - HPA í™•ì¥ ì‹œì‘ (5ë¶„ ì§€ì—°)
T+6:00 - Worker 10ê°œë¡œ í™•ì¥
T+15:00 - ëª¨ë“  ë©”ì‹œì§€ ì²˜ë¦¬ ì™„ë£Œ
ì²˜ë¦¬ ì‹œê°„: 15ë¶„
ì‚¬ìš©ì ëŒ€ê¸°: í‰ê·  7.5ë¶„
```

**KEDA (SQS ê¸°ë°˜):**
```
T+0:00 - ë©”ì‹œì§€ 10,000ê°œ ë„ì°©
T+0:30 - KEDA ê°ì§€ (30ì´ˆ í´ë§)
T+1:00 - Worker 100ê°œë¡œ ì¦‰ì‹œ í™•ì¥ (10,000 / 100)
T+1:30 - Karpenter ë…¸ë“œ 20ê°œ ìƒì„±
T+3:00 - ëª¨ë“  ë©”ì‹œì§€ ì²˜ë¦¬ ì™„ë£Œ
ì²˜ë¦¬ ì‹œê°„: 3ë¶„
ì‚¬ìš©ì ëŒ€ê¸°: í‰ê·  1.5ë¶„
ê°œì„ : 5ë°° ë¹ ë¦„ âœ…
```

**Scale to Zero íš¨ê³¼:**

í‰ìƒì‹œ (ë©”ì‹œì§€ ì—†ìŒ):
```
Before (HPA):
- ìµœì†Œ Replica: 1
- ë…¸ë“œ: 1 (t3.medium)
- ë¹„ìš©: 24ì‹œê°„ Ã— $0.042 = $1.01/day
- ì›” ë¹„ìš©: $30.3/month

After (KEDA):
- Replica: 0 (ë©”ì‹œì§€ ì—†ì„ ë•Œ)
- ë…¸ë“œ: 0 (Karpenter ì œê±°)
- ë¹„ìš©: $0/day
- ì›” ë¹„ìš©: $0 (Idle ì‹œ)

í”¼í¬ ì‹œ (í‹°ì¼“íŒ…):
- Replica: 100
- ë…¸ë“œ: 20 (t3.medium)
- ë¹„ìš©: 1ì‹œê°„ Ã— $0.042 Ã— 20 = $0.84/hour
- ì›” ë¹„ìš© (í•˜ë£¨ 2ì‹œê°„ Ã— 30ì¼): $50.4/month

ì´ ì›” ë¹„ìš©: $50.4 (ê¸°ì¡´ $30.3 ê³ ì • + í”¼í¬ $100)
ì ˆê°: $79.9/month (61% ì ˆê°) âœ…
```

**ì‹¤ì œ ì‚¬ë¡€ 1: í‹°ì¼“íŒ… ì˜¤í”ˆ**
- ì‹œê°„: ì˜ˆì•½ ì˜¤í”ˆ 30ë¶„ ì „
- SQS ë©”ì‹œì§€:
  - T-30min: 0ê°œ (Idle)
  - T-0min: ê¸‰ì¦ â†’ 5,000ê°œ (ì˜ˆì•½ ìƒì„±)
  - T+10min: 8,000ê°œ (ì˜ˆì•½ ë§Œë£Œ ì‹œì‘)
  - T+30min: 3,000ê°œ (ì²˜ë¦¬ ì¤‘)
  - T+60min: 0ê°œ (ì™„ë£Œ)

- KEDA ë™ì‘:
  - T-30min: Worker 0 pods (Idle)
  - T-0min: ì¦‰ì‹œ 50 podsë¡œ í™•ì¥ (5,000 / 100)
  - T+10min: 80 podsë¡œ í™•ì¥ (8,000 / 100)
  - T+30min: 30 podsë¡œ ì¶•ì†Œ (3,000 / 100)
  - T+60min: 0 podsë¡œ ì¶•ì†Œ (ë©”ì‹œì§€ 0)

- Karpenter ì—°ë™:
  - T-0min: ë…¸ë“œ 10ê°œ ìƒì„± (Spot)
  - T+10min: ë…¸ë“œ 16ê°œë¡œ í™•ì¥
  - T+30min: ë…¸ë“œ 6ê°œë¡œ ì¶•ì†Œ
  - T+60min: ë…¸ë“œ 0ê°œë¡œ ì œê±°

- ê²°ê³¼:
  - ë©”ì‹œì§€ ì²˜ë¦¬: í‰ê·  2ë¶„ ì´ë‚´
  - ë¹„ìš©: $1.2 (1ì‹œê°„ Ã— 16 nodes Ã— $0.075)
  - ë‹¤ìš´íƒ€ì„: 0
  - ë§Œì¡±ë„: ë†’ìŒ âœ…

**ì‹¤ì œ ì‚¬ë¡€ 2: Scale to Zero ê²€ì¦**
- ì‹œê°„: í‰ìƒì‹œ (ìƒˆë²½ 2ì‹œ)
- SQS ë©”ì‹œì§€: 0ê°œ
- KEDA ë™ì‘:
  - Worker: 0 pods (5ë¶„ Cooldown í›„)
  - Karpenter: ë…¸ë“œ 0ê°œ ì œê±°
- ë©”ì‹œì§€ ë„ì°© (ìƒˆë²½ 3ì‹œ):
  - 1ê°œ ë©”ì‹œì§€ ë„ì°©
  - KEDA: 30ì´ˆ í›„ ê°ì§€
  - Worker: 1 pod ìƒì„± (Cold Start)
  - Karpenter: 1 node ìƒì„± (45ì´ˆ)
  - ì´ ì‹œê°„: 1ë¶„ 15ì´ˆ (Cold Start)
- ê²°ê³¼: Idle ì‹œ ë¹„ìš© $0, Cold Start í—ˆìš© ê°€ëŠ¥ âœ…

**ì‹¤ì œ ì‚¬ë¡€ 3: ê¸‰ê²©í•œ ë©”ì‹œì§€ ê°ì†Œ**
- ì‹œê°„: í‹°ì¼“íŒ… ì¢…ë£Œ
- SQS ë©”ì‹œì§€:
  - 10,000ê°œ â†’ 5,000ê°œ â†’ 1,000ê°œ â†’ 0ê°œ (10ë¶„)
- KEDA ë™ì‘:
  - 100 pods â†’ 50 pods â†’ 10 pods â†’ 0 pods
  - Cooldown 5ë¶„ ì ìš© (ê¸‰ê²©í•œ ì¶•ì†Œ ë°©ì§€)
- Karpenter ì—°ë™:
  - ë…¸ë“œ 20ê°œ â†’ 10ê°œ â†’ 2ê°œ â†’ 0ê°œ
  - Consolidation ì‹œê°„: 15ë¶„
- ê²°ê³¼: ì•ˆì „í•œ ì¶•ì†Œ, ë¹„ìš© ì ˆê° âœ…

**ìš´ì˜ ì´ìŠˆ & í•´ê²°:**

**Issue 1: Cold Start ì§€ì—°**
- ë¬¸ì œ: Idle ìƒíƒœì—ì„œ ì²« ë©”ì‹œì§€ ì²˜ë¦¬ ì‹œ 1ë¶„+ ì§€ì—°
- ì›ì¸: Pod ìƒì„± (30ì´ˆ) + ë…¸ë“œ ìƒì„± (45ì´ˆ)
- í•´ê²°:
  - `minReplicaCount: 0` â†’ `1` (ì¤‘ìš” ì‹œê°„ëŒ€ë§Œ)
  - ì˜ˆ: í‹°ì¼“íŒ… 10ë¶„ ì „ë¶€í„° `minReplicaCount: 1` ì„¤ì •
- ê²°ê³¼: Cold Start ì œê±°, ì¦‰ì‹œ ì²˜ë¦¬

**Issue 2: ê³¼ë„í•œ í™•ì¥**
- ë¬¸ì œ: ë©”ì‹œì§€ 10,000ê°œ ë„ì°© ì‹œ 100 pods ìƒì„±, ë…¸ë“œ ë¶€ì¡±
- ì›ì¸: `maxReplicaCount: 100`ì´ ë„ˆë¬´ ë†’ìŒ
- í•´ê²°:
  - `maxReplicaCount: 50` (ë…¸ë“œ 10ê°œ í•œê³„)
  - `queueLength: 200` (ë©”ì‹œì§€ 200ê°œë‹¹ Pod 1ê°œ)
- ê²°ê³¼: ì•ˆì •ì  í™•ì¥, ë…¸ë“œ í•œê³„ ì¡´ì¤‘

**Issue 3: IRSA ê¶Œí•œ ë¶€ì¡±**
- ë¬¸ì œ: KEDAê°€ SQS í ì¡°íšŒ ì‹¤íŒ¨
- ì¦ìƒ: "AccessDenied: User is not authorized to perform: sqs:GetQueueAttributes"
- í•´ê²°:
  - IAM Roleì— `sqs:GetQueueAttributes` ê¶Œí•œ ì¶”ê°€
  - IRSA ì„¤ì • í™•ì¸
- ê²°ê³¼: KEDA ì •ìƒ ì‘ë™

**êµí›ˆ:**
- KEDAëŠ” ì´ë²¤íŠ¸ ê¸°ë°˜ ì›Œí¬ë¡œë“œì˜ í•„ìˆ˜ ë„êµ¬ âœ…
- Scale to Zeroë¡œ Idle ë¹„ìš© ì œë¡œ ë‹¬ì„±
- Karpenter ì—°ë™ìœ¼ë¡œ ë…¸ë“œë„ ìë™ ê´€ë¦¬
- Cold Start ê³ ë ¤ í•„ìš” (ì¤‘ìš” ì‹œê°„ëŒ€ëŠ” minReplica 1+)

---

## ğŸ“œ 3.4 ë¹„ìš© ì¶”ì  ë° ê°€ì‹œì„±

### ìŠ¬ë¼ì´ë“œ
```
"RPSë‹¹ ë‹¨ê°€ ì‹¤ì‹œê°„ ì¶”ì "

ì„¤ê³„ ê³ ë¯¼:
â”œâ”€ ë¬¸ì œ: ë¹„ìš©ì´ ì–´ë””ì„œ ë‚˜ê°€ëŠ”ì§€ ëª¨ë¦„
â”‚   â”œâ”€ ì „ì²´ ì›” ë¹„ìš©: $2,000
â”‚   â”œâ”€ Gateway ë¹„ìš©? Reservation ë¹„ìš©?
â”‚   â”œâ”€ RPS ì¦ê°€ ì‹œ ë¹„ìš© ì–¼ë§ˆ?
â”‚   â””â”€ ìµœì í™” ìš°ì„ ìˆœìœ„?
â”‚
â”œâ”€ ìš”êµ¬ì‚¬í•­:
â”‚   â”œâ”€ ì„œë¹„ìŠ¤ë³„ ë¹„ìš© ì¶”ì 
â”‚   â”œâ”€ RPSë‹¹ ë‹¨ê°€ ê³„ì‚°
â”‚   â”œâ”€ ì‹¤ì‹œê°„ ê°€ì‹œì„± (ëŒ€ì‹œë³´ë“œ)
â”‚   â””â”€ ì•ŒëŒ (ë¹„ìš© ì´ˆê³¼ ì‹œ)
â”‚
â””â”€ ê³ ë¯¼: CloudWatch vs Kubecost vs ìì²´ êµ¬í˜„?

ì„ íƒ: íƒœê¹… + Prometheus + Grafana
â”œâ”€ ì„œë¹„ìŠ¤ë³„ ë¦¬ì†ŒìŠ¤ íƒœê¹… (AWS Cost Allocation Tags)
â”œâ”€ Prometheusë¡œ RPS ë©”íŠ¸ë¦­ ìˆ˜ì§‘
â”œâ”€ Grafanaë¡œ RPSë‹¹ ë‹¨ê°€ ê³„ì‚° ë° ì‹œê°í™”
â””â”€ AlertManagerë¡œ ë¹„ìš© ì´ˆê³¼ ì•ŒëŒ

êµ¬í˜„ íŠ¹ì§•:
â”œâ”€ ëª¨ë“  ë¦¬ì†ŒìŠ¤ì— ì„œë¹„ìŠ¤ íƒœê·¸ ì¶”ê°€
â”œâ”€ Custom Metric: cost_per_rps
â”œâ”€ ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ (Grafana)
â””â”€ ì›”ë³„ ë¹„ìš© ë¦¬í¬íŠ¸ ìë™ ìƒì„±
```

### ë©˜íŠ¸

**ì„¤ê³„ ë‹¨ê³„ ê³ ë¯¼:**

ë¹„ìš© ìµœì í™”ì˜ ì²« ë‹¨ê³„ëŠ” **ê°€ì‹œì„±**ì…ë‹ˆë‹¤.
- ì–´ë””ì„œ ë¹„ìš©ì´ ë‚˜ê°€ëŠ”ì§€ ëª¨ë¥´ë©´ ìµœì í™” ë¶ˆê°€ëŠ¥
- ì„œë¹„ìŠ¤ë³„ ë¹„ìš© ì¶”ì  í•„ìš”
- RPSë‹¹ ë‹¨ê°€ë¡œ íš¨ìœ¨ ì¸¡ì •

**ì´ˆê¸° ë¬¸ì œ:**
- AWS Cost Explorer:
  - ì›” ì´ ë¹„ìš©: $2,000
  - EC2: $1,500, RDS: $300, ê¸°íƒ€: $200
  - í•˜ì§€ë§Œ ì–´ë–¤ ì„œë¹„ìŠ¤(Gateway/Reservation)ê°€ ì–¼ë§ˆ?
  - RPS ì¦ê°€ ì‹œ ë¹„ìš© ì–¼ë§ˆ ì¦ê°€?
  - ì•Œ ìˆ˜ ì—†ìŒ!

**ê³ ë¯¼í•œ ì„ íƒì§€:**

**1. AWS Cost Explorer:**
- âœ… AWS ë„¤ì´í‹°ë¸Œ
- âŒ ì„œë¹„ìŠ¤ë³„ ë¶„ë¦¬ ì–´ë ¤ì›€
- âŒ RPS ë©”íŠ¸ë¦­ ì—†ìŒ
- âŒ í•˜ë£¨ ì§€ì—° (ì‹¤ì‹œê°„ ì•„ë‹˜)

**2. Kubecost:**
- âœ… Kubernetes ë„¤ì´í‹°ë¸Œ
- âœ… Pod/Namespaceë³„ ë¹„ìš©
- âŒ ë¹„ìŒˆ ($50/month +)
- âŒ AWS ì „ì²´ ë¹„ìš© í†µí•© ì–´ë ¤ì›€

**3. íƒœê¹… + Prometheus + Grafana (ì„ íƒ):**
- âœ… ì„œë¹„ìŠ¤ë³„ íƒœê¹…ìœ¼ë¡œ AWS ë¹„ìš© ë¶„ë¦¬
- âœ… Prometheusë¡œ RPS ë©”íŠ¸ë¦­ ìˆ˜ì§‘
- âœ… Grafanaë¡œ RPSë‹¹ ë‹¨ê°€ ê³„ì‚°
- âœ… ë¬´ë£Œ (ì˜¤í”ˆì†ŒìŠ¤)
- âš ï¸ ìˆ˜ë™ ì„¤ì • í•„ìš”

**ìš°ë¦¬ì˜ ì„ íƒ: íƒœê¹… + Prometheus + Grafana**

ì´ìœ :
- **ìœ ì—°ì„±**: Custom ë©”íŠ¸ë¦­ ììœ ë¡­ê²Œ ì¶”ê°€
- **í†µí•©**: AWS ë¹„ìš© + Kubernetes ë©”íŠ¸ë¦­
- **ë¬´ë£Œ**: ì˜¤í”ˆì†ŒìŠ¤ ìŠ¤íƒ
- **ì‹¤ì‹œê°„**: ì´ˆ ë‹¨ìœ„ ì—…ë°ì´íŠ¸

**ì‹¤ì œ êµ¬í˜„:**

**1. AWS Cost Allocation Tags:**

```yaml
# Gateway Deploymentì— íƒœê·¸ ì¶”ê°€
apiVersion: apps/v1
kind: Deployment
metadata:
  name: gateway-api
  labels:
    app: gateway-api
    service: gateway
    cost-center: traffic-tacos
    environment: production
spec:
  template:
    metadata:
      labels:
        app: gateway-api
        service: gateway
```

```hcl
# Terraformìœ¼ë¡œ ëª¨ë“  AWS ë¦¬ì†ŒìŠ¤ì— íƒœê·¸
resource "aws_instance" "gateway_node" {
  tags = {
    Name        = "gateway-node"
    Service     = "gateway"
    CostCenter  = "traffic-tacos"
    Environment = "production"
    ManagedBy   = "karpenter"
  }
}
```

**2. Prometheus Custom Metrics:**

```yaml
# ServiceMonitor: Gateway ë©”íŠ¸ë¦­ ìˆ˜ì§‘
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: gateway-api-metrics
spec:
  selector:
    matchLabels:
      app: gateway-api
  endpoints:
    - port: metrics
      interval: 15s
      path: /metrics
```

```go
// Gateway APIì—ì„œ ë©”íŠ¸ë¦­ ìƒì„±
import "github.com/prometheus/client_golang/prometheus"

var (
    // HTTP ìš”ì²­ ì´ ìˆ˜
    httpRequestsTotal = prometheus.NewCounterVec(
        prometheus.CounterOpts{
            Name: "http_requests_total",
            Help: "Total number of HTTP requests",
        },
        []string{"service", "method", "status"},
    )
    
    // í˜„ì¬ ë¹„ìš© (ìˆ˜ë™ ì—…ë°ì´íŠ¸ ë˜ëŠ” AWS API)
    serviceCostGauge = prometheus.NewGaugeVec(
        prometheus.GaugeOpts{
            Name: "service_cost_dollars_per_hour",
            Help: "Current hourly cost in dollars",
        },
        []string{"service"},
    )
)

// ë©”íŠ¸ë¦­ ë“±ë¡
func init() {
    prometheus.MustRegister(httpRequestsTotal)
    prometheus.MustRegister(serviceCostGauge)
}
```

**3. Grafana ëŒ€ì‹œë³´ë“œ:**

```json
// PromQL: RPSë‹¹ ë‹¨ê°€ ê³„ì‚°
{
  "expr": "rate(service_cost_dollars_per_hour{service=\"gateway\"}[5m]) / rate(http_requests_total{service=\"gateway\"}[5m]) * 3600",
  "legendFormat": "Cost per 1000 RPS ($/hour)"
}
```

```json
// Grafana Dashboard Panel
{
  "title": "Cost per 1000 RPS by Service",
  "targets": [
    {
      "expr": "(service_cost_dollars_per_hour / rate(http_requests_total[5m]) * 1000) * 3600",
      "legendFormat": "{{service}}"
    }
  ],
  "yaxes": [
    {
      "label": "$ per 1000 RPS",
      "format": "currencyUSD"
    }
  ]
}
```

**4. AlertManager ì•ŒëŒ:**

```yaml
# PrometheusRule: ë¹„ìš© ì´ˆê³¼ ì•ŒëŒ
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: cost-alerts
spec:
  groups:
    - name: cost_alerts
      interval: 5m
      rules:
        # ì‹œê°„ë‹¹ ë¹„ìš© $10 ì´ˆê³¼
        - alert: HourlyCostExceeded
          expr: sum(service_cost_dollars_per_hour) > 10
          for: 15m
          labels:
            severity: warning
          annotations:
            summary: "Hourly cost exceeded $10"
            description: "Current hourly cost: ${{ $value }}"
        
        # RPSë‹¹ ë‹¨ê°€ $0.01 ì´ˆê³¼
        - alert: CostPerRPSHigh
          expr: (service_cost_dollars_per_hour / rate(http_requests_total[5m]) * 1000) > 0.01
          for: 10m
          labels:
            severity: warning
          annotations:
            summary: "Cost per 1000 RPS > $0.01"
            description: "Service {{$labels.service}}: ${{ $value }}/1000 RPS"
```

**ìš´ì˜ ê²½í—˜ (ì‹¤ì œ ë°ì´í„°):**

**ì„œë¹„ìŠ¤ë³„ ë¹„ìš© ë¶„ì„ (ì›”ë³„):**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Service     â”‚ Cost/Month  â”‚ Avg RPS  â”‚ $/1000 RPS   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Gateway     â”‚ $450        â”‚ 5,000    â”‚ $0.0030      â”‚
â”‚ Reservation â”‚ $260        â”‚ 1,000    â”‚ $0.0087      â”‚
â”‚ Inventory   â”‚ $180        â”‚ 1,200    â”‚ $0.0050      â”‚
â”‚ Worker      â”‚ $90         â”‚ N/A      â”‚ N/A          â”‚
â”‚ Monitoring  â”‚ $60         â”‚ N/A      â”‚ N/A          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Total       â”‚ $1,040      â”‚ 7,200    â”‚ $0.0048      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ë¶„ì„:
- Gateway: ê°€ì¥ íš¨ìœ¨ì  ($0.003/1000 RPS)
- Reservation: ë¹„íš¨ìœ¨ì  ($0.0087/1000 RPS)
  â””â”€ ì›ì¸: Memory ì§‘ì•½ì , ìºì‹œ ë§ìŒ
  â””â”€ ìµœì í™” ëŒ€ìƒ: ìºì‹œ íš¨ìœ¨ ê°œì„  í•„ìš”

- ì „ì²´ í‰ê· : $0.0048/1000 RPS
  â””â”€ 30k RPS ì‹œ: $0.144/hour = $103/month (í”¼í¬)
```

**ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ í™œìš©:**

Grafana ëŒ€ì‹œë³´ë“œ êµ¬ì„±:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š Traffic Tacos FinOps Dashboard          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Current Hour Cost: $0.42                   â”‚
â”‚ Current RPS: 5,200                         â”‚
â”‚ Cost per 1000 RPS: $0.0027                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Service Breakdown:                         â”‚
â”‚  â–°â–°â–°â–°â–°â–°â–°â–°â–°â–° Gateway    $0.18 (43%)        â”‚
â”‚  â–°â–°â–°â–°â–°â–°     Reservation $0.12 (29%)       â”‚
â”‚  â–°â–°â–°â–°       Inventory   $0.08 (19%)       â”‚
â”‚  â–°â–°         Worker      $0.04 (9%)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Trend (24h):                               â”‚
â”‚  ğŸ’° Cost:  $8.2 â†’ $10.5 (+28%)            â”‚
â”‚  ğŸ“ˆ RPS:   4k â†’ 5.2k (+30%)               â”‚
â”‚  âœ… Efficiency: $0.0029 â†’ $0.0027 (+7%)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì‹¤ì œ ì‚¬ë¡€ 1: Reservation ìµœì í™”**
- ë°œê²¬: Grafanaì—ì„œ Reservationì˜ RPSë‹¹ ë‹¨ê°€ ë†’ìŒ ($0.0087)
- ì¡°ì‚¬:
  - Memory ì‚¬ìš©ë¥ : 80% (r5.large)
  - ìºì‹œ íˆíŠ¸ìœ¨: 60% (ë‚®ìŒ)
  - ì›ì¸: ìºì‹œ ì „ëµ ë¹„íš¨ìœ¨
- ì¡°ì¹˜:
  - ìºì‹œ ì•Œê³ ë¦¬ì¦˜ ê°œì„  (LRU â†’ LFU)
  - ìºì‹œ í¬ê¸° ì¡°ì • (8GB â†’ 12GB, r5.xlarge)
  - Redis ìºì‹œ ë ˆì´ì–´ ì¶”ê°€
- ê²°ê³¼:
  - ìºì‹œ íˆíŠ¸ìœ¨: 60% â†’ 85%
  - RPSë‹¹ ë‹¨ê°€: $0.0087 â†’ $0.0052 (40% ê°œì„ ) âœ…
  - ì›” ë¹„ìš©: $260 â†’ $156 ($104 ì ˆê°)

**ì‹¤ì œ ì‚¬ë¡€ 2: í”¼í¬ ì‹œê°„ ë¹„ìš© ëª¨ë‹ˆí„°ë§**
- ì‹œê°„: í‹°ì¼“íŒ… ì˜¤í”ˆ (30k RPS)
- ëŒ€ì‹œë³´ë“œ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§:
  - T+0min: RPS 5k â†’ 30k (6ë°° ì¦ê°€)
  - T+5min: ë¹„ìš© $0.42/hour â†’ $2.50/hour (6ë°° ì¦ê°€)
  - T+10min: Karpenter ë…¸ë“œ ì¦ê°€ (10 â†’ 50)
  - T+30min: RPS 30k â†’ 10k (í”¼í¬ ì¢…ë£Œ)
  - T+35min: ë¹„ìš© $2.50/hour â†’ $0.80/hour (Consolidation)
- ê²°ê³¼:
  - í”¼í¬ ë¹„ìš©: $1.25 (30ë¶„ Ã— $2.50/hour)
  - ì˜ˆìƒ ë²”ìœ„ ë‚´: âœ…
  - ì‹¤ì‹œê°„ í™•ì¸ìœ¼ë¡œ ì•ˆì‹¬

**ì‹¤ì œ ì‚¬ë¡€ 3: ë¹„ìš© ì´ˆê³¼ ì•ŒëŒ**
- ì‹œê°„: í‰ìƒì‹œ (ê°‘ìê¸° ë¹„ìš© ì¦ê°€)
- ì•ŒëŒ: "Hourly cost exceeded $10" (Slack ì•ŒëŒ)
- ì¡°ì‚¬:
  - Grafana í™•ì¸: Worker Pod 100ê°œ (ë¹„ì •ìƒ)
  - ì›ì¸: SQS ë©”ì‹œì§€ ë¬´í•œ ë£¨í”„ (ë²„ê·¸)
  - KEDAê°€ ê³„ì† Worker í™•ì¥ ì¤‘
- ì¡°ì¹˜:
  - Worker Deployment ì¦‰ì‹œ scale down (0)
  - ë²„ê·¸ ìˆ˜ì • (ë©”ì‹œì§€ Ack ëˆ„ë½)
  - ì¬ë°°í¬
- ê²°ê³¼:
  - ì¶”ê°€ ë¹„ìš©: $5 (30ë¶„ Ã— $10/hour)
  - ë¹ ë¥¸ ëŒ€ì‘ìœ¼ë¡œ í”¼í•´ ìµœì†Œí™” âœ…
  - ì•ŒëŒì´ ì—†ì—ˆìœ¼ë©´ ìˆ˜ì‹­ ë‹¬ëŸ¬ ì†ì‹¤

**ì›”ë³„ ë¹„ìš© ë¦¬í¬íŠ¸ ìë™í™”:**

```bash
#!/bin/bash
# cost_report.sh - ì›”ë³„ ë¹„ìš© ë¦¬í¬íŠ¸ ìƒì„±

# AWS Cost Explorer APIë¡œ íƒœê·¸ë³„ ë¹„ìš© ì¡°íšŒ
aws ce get-cost-and-usage \
  --time-period Start=$(date -d "1 month ago" +%Y-%m-01),End=$(date +%Y-%m-01) \
  --granularity MONTHLY \
  --metrics "UnblendedCost" \
  --group-by Type=TAG,Key=Service \
  --profile tacos \
  --output json > /tmp/aws_cost.json

# Prometheus APIë¡œ RPS ë©”íŠ¸ë¦­ ì¡°íšŒ
curl -G 'http://prometheus:9090/api/v1/query_range' \
  --data-urlencode 'query=rate(http_requests_total[1h])' \
  --data-urlencode "start=$(date -d '1 month ago' +%s)" \
  --data-urlencode "end=$(date +%s)" \
  --data-urlencode 'step=1h' > /tmp/rps_metrics.json

# Python ìŠ¤í¬ë¦½íŠ¸ë¡œ RPSë‹¹ ë‹¨ê°€ ê³„ì‚°
python3 calculate_cost_per_rps.py \
  --cost /tmp/aws_cost.json \
  --metrics /tmp/rps_metrics.json \
  --output /tmp/cost_report.md

# Slackìœ¼ë¡œ ë¦¬í¬íŠ¸ ì „ì†¡
curl -X POST https://slack.com/api/files.upload \
  -F file=@/tmp/cost_report.md \
  -F channels=finops \
  -H "Authorization: Bearer $SLACK_TOKEN"
```

**ìš´ì˜ ì´ìŠˆ & í•´ê²°:**

**Issue 1: íƒœê¹… ëˆ„ë½**
- ë¬¸ì œ: ì¼ë¶€ ë¦¬ì†ŒìŠ¤ íƒœê¹… ëˆ„ë½ (Karpenter ìë™ ìƒì„± ë…¸ë“œ)
- ì¦ìƒ: Cost Explorerì—ì„œ "Untagged" ë¹„ìš© ì¦ê°€
- í•´ê²°:
  - Karpenter NodeClassì— ê¸°ë³¸ íƒœê·¸ ì„¤ì •
  - Terraformìœ¼ë¡œ ëª¨ë“  ë¦¬ì†ŒìŠ¤ íƒœê·¸ ê°•ì œ
- ê²°ê³¼: íƒœê¹… 100% ë‹¬ì„±

**Issue 2: ë¹„ìš© ë°ì´í„° ì§€ì—°**
- ë¬¸ì œ: AWS Cost Explorer ë°ì´í„° í•˜ë£¨ ì§€ì—°
- ì¦ìƒ: ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œì™€ ì°¨ì´
- í•´ê²°:
  - AWS Cost & Usage Report (CUR) í™œì„±í™”
  - Athenaë¡œ ì‹¤ì‹œê°„ì— ê°€ê¹Œìš´ ì¡°íšŒ
  - Grafanaì— Athena ë°ì´í„° ì†ŒìŠ¤ ì¶”ê°€
- ê²°ê³¼: 4ì‹œê°„ ì§€ì—°ìœ¼ë¡œ ê°œì„ 

**êµí›ˆ:**
- ë¹„ìš© ê°€ì‹œì„±ì´ ìµœì í™”ì˜ ì‹œì‘ âœ…
- RPSë‹¹ ë‹¨ê°€ë¡œ ì„œë¹„ìŠ¤ íš¨ìœ¨ ì¸¡ì • ê°€ëŠ¥
- ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œë¡œ ì´ìƒ ì§•í›„ ë¹ ë¥´ê²Œ ê°ì§€
- ì•ŒëŒìœ¼ë¡œ ë¹„ìš© ì´ˆê³¼ ë°©ì§€ (ì›” ìˆ˜ì‹­ ë‹¬ëŸ¬ ì ˆê°)

---

## ğŸ“œ 3.5 í†µí•© FinOps ê²°ê³¼ ë° êµí›ˆ

### ìŠ¬ë¼ì´ë“œ
```
"ì›” $2,400 ì ˆê° ë‹¬ì„±"

ì „ëµë³„ ì ˆê° ìš”ì•½:
â”œâ”€ 3-Tier Spot ì „ëµ: $2,000/month
â”‚   â””â”€ On-demand 100% ($3,000) â†’ í˜¼í•© ($1,000)
â”‚
â”œâ”€ Karpenter ìµœì í™”: $520/month
â”‚   â””â”€ Bin-packing íš¨ìœ¨ (50% â†’ 80%)
â”‚   â””â”€ Consolidation (ìœ íœ´ ë…¸ë“œ ì œê±°)
â”‚
â”œâ”€ KEDA Scale to Zero: $80/month
â”‚   â””â”€ Worker Idle ì‹œ ë¹„ìš© ì œë¡œ
â”‚
â”œâ”€ ë¹„ìš© ê°€ì‹œì„± & ìµœì í™”: $100/month
â”‚   â””â”€ Reservation ìºì‹œ ê°œì„  ($104)
â”‚   â””â”€ ì•ŒëŒìœ¼ë¡œ ë¬´í•œ ë£¨í”„ ë°©ì§€ (ì›” í‰ê·  ì†ì‹¤ ë°©ì§€)
â”‚
â””â”€ Redis ì½”ë“œ ìµœì í™”: $500/month
    â””â”€ KEYS â†’ Position Index (ë…¸ë“œ ì¦ì„¤ ë¶ˆí•„ìš”)

ì´ ì ˆê°: $3,200/month
ìµœì¢… ì›” ë¹„ìš©: $1,040/month
ì´ˆê¸° ì˜ˆìƒ: $4,240/month
ì ˆê°ë¥ : 75% âœ…

ì¶”ê°€ ì„±ê³¼:
â”œâ”€ ë‹¤ìš´íƒ€ì„: 0ì´ˆ (Spot ì¤‘ë‹¨ ëŒ€ì‘)
â”œâ”€ ì„±ëŠ¥: 30k RPS ë‹¬ì„±
â”œâ”€ í™•ì¥ì„±: ìë™ í™•ì¥/ì¶•ì†Œ
â””â”€ ê°€ì‹œì„±: ì‹¤ì‹œê°„ ë¹„ìš© ì¶”ì 
```

### ë©˜íŠ¸

**í†µí•© FinOps ê²°ê³¼:**

ìš°ë¦¬ëŠ” ì„¤ê³„ ë‹¨ê³„ë¶€í„° ë¹„ìš©ì„ ê³ ë ¤í•˜ê³ ,
ì‹¤ì œ ìš´ì˜ì—ì„œ ì§€ì†ì ìœ¼ë¡œ ìµœì í™”í–ˆìŠµë‹ˆë‹¤.

**ì „ëµë³„ ì ˆê°:**

**1. 3-Tier Spot ì „ëµ: $2,000/month ì ˆê°**
- On-demand 100%: $3,000/month
- 3-Tier í˜¼í•© (70% Spot): $1,000/month
- ì ˆê°: $2,000 (67%)
- ë‹¤ìš´íƒ€ì„: 0 (Spot ì¤‘ë‹¨ ëŒ€ì‘)

**2. Karpenter ì›Œí¬ë¡œë“œ ìµœì í™”: $520/month ì ˆê°**
- Before: ê³ ì • ë…¸ë“œ, í™œìš©ë¥  50%, $1,200/month
- After: ë™ì  ë…¸ë“œ, í™œìš©ë¥  80%, $680/month
- ì ˆê°: $520 (43%)
- ì¶”ê°€ íš¨ê³¼: ë…¸ë“œ ìˆ˜ 40% ê°ì†Œ

**3. KEDA Scale to Zero: $80/month ì ˆê°**
- Before: Worker ìµœì†Œ 1 pod, $30/month ê³ ì •
- After: Idle ì‹œ 0 pods, í”¼í¬ë§Œ ë¹„ìš© ë°œìƒ
- ì›” í‰ê· : $50 (í”¼í¬ ì‹œê°„ë§Œ)
- ì ˆê°: $80 (Idle ë¹„ìš© ì œë¡œ + í”¼í¬ ìµœì í™”)

**4. ë¹„ìš© ê°€ì‹œì„± & ìµœì í™”: $100/month ì ˆê°**
- Reservation ìºì‹œ ê°œì„ : $104/month
- ì•ŒëŒìœ¼ë¡œ ë¬´í•œ ë£¨í”„ ì¡°ê¸° ë°œê²¬ (ì›” í‰ê·  ì†ì‹¤ $20 ë°©ì§€)
- ê¸°íƒ€ ìµœì í™”: $16/month

**5. Redis ì½”ë“œ ìµœì í™”: $500/month ì ˆê°**
- KEYS â†’ Position Index
- ë…¸ë“œ ì¦ì„¤ ë¶ˆí•„ìš”
- ì„±ëŠ¥ë„ 5ë°° í–¥ìƒ (CPU 100% â†’ 40%)

**ì´ ì ˆê°: $3,200/month (75%)**
**ìµœì¢… ë¹„ìš©: $1,040/month**

**ROI ë¶„ì„:**

ì´ˆê¸° íˆ¬ì:
- Karpenter: $0 (ì˜¤í”ˆì†ŒìŠ¤)
- KEDA: $0 (ì˜¤í”ˆì†ŒìŠ¤)
- Grafana/Prometheus: $0 (ì˜¤í”ˆì†ŒìŠ¤)
- ê°œë°œ ì‹œê°„: 2ì£¼ (ì„¤ì • ë° íŠœë‹)

ì›” ì ˆê°: $3,200
ì—° ì ˆê°: $38,400
**ROI: ë¬´í•œëŒ€ (íˆ¬ì ë¹„ìš© $0)**

**ì„±ëŠ¥ vs ë¹„ìš©:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì§€í‘œ         â”‚ Before  â”‚ After   â”‚ ë³€í™”     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ì²˜ë¦¬ëŸ‰       â”‚ 10k RPS â”‚ 30k RPS â”‚ +200%    â”‚
â”‚ ì›” ë¹„ìš©      â”‚ $4,240  â”‚ $1,040  â”‚ -75%     â”‚
â”‚ RPSë‹¹ ë‹¨ê°€   â”‚ $0.014  â”‚ $0.0012 â”‚ -91%     â”‚
â”‚ ë‹¤ìš´íƒ€ì„     â”‚ ê°€ë”    â”‚ 0       â”‚ ì™„ë²½     â”‚
â”‚ í™•ì¥ ì†ë„    â”‚ 5ë¶„     â”‚ < 1ë¶„   â”‚ 5ë°°     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

í•µì‹¬: ë¹„ìš©ì€ 75% ê°ì†Œ, ì„±ëŠ¥ì€ 3ë°° í–¥ìƒ âœ…
```

**êµí›ˆ:**

**1. ì„¤ê³„ ë‹¨ê³„ë¶€í„° ë¹„ìš© ê³ ë ¤:**
- ì•„í‚¤í…ì²˜ ì„ íƒë¶€í„° ë¹„ìš© ì˜í–¥ ë¶„ì„
- Trade-off ëª…í™•íˆ ì´í•´ (Spot vs On-demand)
- ì¤‘ìš”ë„ë³„ ì°¨ë³„í™” (3-Tier ì „ëµ)

**2. ìë™í™”ê°€ í•µì‹¬:**
- Karpenter: ìˆ˜ë™ ê´€ë¦¬ ë¶ˆê°€ëŠ¥
- KEDA: ì´ë²¤íŠ¸ ê¸°ë°˜ ìë™ í™•ì¥
- Consolidation: ìë™ ë¹„ìš© ì ˆê°

**3. ê°€ì‹œì„±ì´ ìµœì í™”ì˜ ì‹œì‘:**
- ì¸¡ì •í•  ìˆ˜ ì—†ìœ¼ë©´ ê°œì„ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤
- RPSë‹¹ ë‹¨ê°€ë¡œ íš¨ìœ¨ ì¸¡ì •
- ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œë¡œ ì´ìƒ ê°ì§€

**4. ì§€ì†ì  ìµœì í™”:**
- í•œ ë²ˆ ì„¤ì •í•˜ê³  ëì´ ì•„ë‹™ë‹ˆë‹¤
- ì›”ë³„ ë¦¬í¬íŠ¸ë¡œ ì¶”ì„¸ íŒŒì•…
- ë¹„íš¨ìœ¨ ë°œê²¬ ì‹œ ì¦‰ì‹œ ìµœì í™”

**5. ì˜¤í”ˆì†ŒìŠ¤ í™œìš©:**
- Karpenter, KEDA, Prometheus, Grafana ëª¨ë‘ ë¬´ë£Œ
- ìƒìš© ë„êµ¬ ëŒ€ë¹„ ìˆ˜ì‹­ë§Œ ì› ì ˆê°
- ì»¤ë®¤ë‹ˆí‹° ì§€ì› í™œë°œ

**ë‹¤ìŒ ëª©í‘œ:**

**1. FinOps ë¬¸í™” í™•ì‚°:**
- ê°œë°œìë„ ë¹„ìš© ì˜ì‹ (Cost-aware Development)
- Pull Requestì— ë¹„ìš© ì˜í–¥ ë¶„ì„ ì¶”ê°€
- ì›”ë³„ FinOps íšŒì˜

**2. ì¶”ê°€ ìµœì í™”:**
- Graviton3 ë…¸ë“œ (20% ì¶”ê°€ ì ˆê°)
- Fargate Spot (ì„œë²„ë¦¬ìŠ¤ + Spot í˜¼í•©)
- Reserved Instance (ì˜ˆì¸¡ ê°€ëŠ¥í•œ ì›Œí¬ë¡œë“œ)

**3. ML ê¸°ë°˜ ì˜ˆì¸¡:**
- íŠ¸ë˜í”½ íŒ¨í„´ í•™ìŠµ
- ì‚¬ì „ í™•ì¥ (Proactive Scaling)
- ë¹„ìš© ì˜ˆì¸¡ ìë™í™”

**ìµœì¢… ìš”ì•½:**

ìš°ë¦¬ì˜ FinOps ì „ëµì€ ë‹¨ìˆœíˆ **"ë¹„ìš© ì ˆê°"**ì´ ì•„ë‹™ë‹ˆë‹¤.

**"ì„±ëŠ¥ í–¥ìƒ + ë¹„ìš© ì ˆê° + ì•ˆì •ì„± ë³´ì¥"** ëª¨ë‘ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤.

- 30k RPS ì²˜ë¦¬: âœ…
- ì›” $1,040 ë¹„ìš©: âœ… (75% ì ˆê°)
- ë‹¤ìš´íƒ€ì„ ì œë¡œ: âœ…
- ìë™ í™•ì¥/ì¶•ì†Œ: âœ…
- ì‹¤ì‹œê°„ ê°€ì‹œì„±: âœ…

**FinOpsëŠ” ì¼íšŒì„± í”„ë¡œì íŠ¸ê°€ ì•„ë‹ˆë¼ ì§€ì†ì ì¸ ë¬¸í™”ì…ë‹ˆë‹¤.** âœ…

---

# ğŸ“Š Part 4: ê´€ì¸¡ì„± (Observability) - 5ë¶„

## ğŸ“œ 4.1 ë©”íŠ¸ë¦­ ìˆ˜ì§‘ & ë³‘ëª© ë°œê²¬

### ìŠ¬ë¼ì´ë“œ
```
"CloudWatch + pprofë¡œ ë³‘ëª© ì°¾ê¸°"

Step 1: CloudWatch ë©”íŠ¸ë¦­
AWS Console â†’ ElastiCache â†’ Redis Clusters
â†’ traffic-tacos-redis â†’ CloudWatch Metrics

í™•ì¸í•œ ë©”íŠ¸ë¦­:
â”œâ”€ EngineCPUUtilization: 100% ğŸ”´
â”œâ”€ CommandsProcessed: 10ë§Œ+ ê±´ (ë¹„ì •ìƒ)
â””â”€ NetworkBytesIn: ìˆ˜ì‹­ MB/s (ê³¼ë„)

ë¬¸ì œ ì¸ì‹: "íŠ¹ì • ëª…ë ¹ì–´ê°€ ê³¼ë„í•˜ê²Œ ì‹¤í–‰ë˜ê³  ìˆë‹¤"

Step 2: pprof í”„ë¡œíŒŒì¼ë§
Setup: app.Use(pprof.New())
ì‹¤í–‰: curl /debug/pprof/profile?seconds=30
ë¶„ì„: go tool pprof -top cpu.prof

ê²°ê³¼:
      flat  flat%   sum%
     2.1s 51.22%     calculateGlobalPosition
     0.8s 19.51%     redis.Keys

ë²”ì¸: Status APIì˜ KEYS ëª…ë ¹ì–´!
```

### ë©˜íŠ¸

ë³‘ëª©ì„ ì°¾ëŠ” ê³¼ì •ì„ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.

**Step 1: CloudWatch ë©”íŠ¸ë¦­ ë¶„ì„**

AWS ì½˜ì†”ì—ì„œ ElastiCache ë©”íŠ¸ë¦­ì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.
- `EngineCPUUtilization`: ì§€ì†ì  100% ğŸ”´
- `CommandsProcessed`: ì´ˆë‹¹ 10ë§Œ+ ê±´ (ì •ìƒ: 3-5ë§Œ)
- `NetworkBytesIn`: ìˆ˜ì‹­ MB/s (ë¹„ì •ìƒì )

ì´ê²ƒë§Œìœ¼ë¡œëŠ” "ë¬´ì—‡ì´ ë¬¸ì œì¸ì§€"ë§Œ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
"ì–´ë””ì„œ ë¬¸ì œê°€ ë°œìƒí•˜ëŠ”ì§€"ëŠ” ëª¨ë¦…ë‹ˆë‹¤.

**Step 2: pprof í”„ë¡œíŒŒì¼ë§**

Go ì• í”Œë¦¬ì¼€ì´ì…˜ì— pprofë¥¼ ì¼°ìŠµë‹ˆë‹¤.
```go
app.Use(pprof.New())
```

CPU í”„ë¡œíŒŒì¼ì„ ìˆ˜ì§‘í•˜ê³  ë¶„ì„í–ˆìŠµë‹ˆë‹¤.
```bash
curl http://gateway-api:8000/debug/pprof/profile?seconds=30 > cpu.prof
go tool pprof -top cpu.prof
```

**ë²”ì¸ ë°œê²¬:**
- `calculateGlobalPosition()`: CPUì˜ 51% ì°¨ì§€
- ê·¸ ì•ˆì˜ `redis.Keys()`: ëŒ€ë¶€ë¶„ì˜ ì‹œê°„ ì†Œë¹„
- Status APIê°€ ì´ˆë‹¹ 10,000ë²ˆ í˜¸ì¶œ

**ì´ê²ƒì´ ë³‘ëª©ì´ì—ˆìŠµë‹ˆë‹¤!**

---

## ğŸ“œ 4.2 ë¶„ì‚° ì¶”ì  & ë¡œê¹…

### ìŠ¬ë¼ì´ë“œ
```
"OpenTelemetry ê¸°ë°˜ ê´€ì¸¡ì„±"

ë¶„ì‚° ì¶”ì  (Tracing):
â”œâ”€ OpenTelemetry ê³„ì¸¡
â”œâ”€ Trace ID ì „íŒŒ (ëª¨ë“  ì„œë¹„ìŠ¤)
â”œâ”€ Span: Gateway â†’ Reservation â†’ Inventory
â””â”€ Jaeger ì‹œê°í™”

êµ¬ì¡°í™” ë¡œê¹…:
â”œâ”€ JSON í¬ë§·
â”œâ”€ Trace ID í¬í•¨
â”œâ”€ ë ˆë²¨ë³„ ë¶„ë¦¬ (INFO, WARN, ERROR)
â””â”€ CloudWatch Logs Insights

Prometheus ë©”íŠ¸ë¦­:
â”œâ”€ http_server_requests_total
â”œâ”€ http_server_requests_duration_seconds
â”œâ”€ backend_call_duration_seconds
â””â”€ Custom: queue_length, admission_rate
```

### ë©˜íŠ¸

**ë¶„ì‚° ì¶”ì :**
- OpenTelemetryë¡œ ëª¨ë“  ì„œë¹„ìŠ¤ ê³„ì¸¡
- Trace IDë¡œ ì „ì²´ ìš”ì²­ íë¦„ ì¶”ì 
- Jaegerë¡œ ì‹œê°í™”

**êµ¬ì¡°í™” ë¡œê¹…:**
- JSON í¬ë§·ìœ¼ë¡œ ì¼ê´€ì„±
- Trace ID í¬í•¨ìœ¼ë¡œ ì¶”ì  ê°€ëŠ¥
- CloudWatch Logs Insightsë¡œ ë¶„ì„

**Prometheus ë©”íŠ¸ë¦­:**
- í‘œì¤€ HTTP ë©”íŠ¸ë¦­
- ì»¤ìŠ¤í…€ ë¹„ì¦ˆë‹ˆìŠ¤ ë©”íŠ¸ë¦­ (ëŒ€ê¸°ì—´ ê¸¸ì´, ì…ì¥ë¥ )
- Grafana ëŒ€ì‹œë³´ë“œ

---

# ğŸ§ª Part 5: ë¶€í•˜í…ŒìŠ¤íŠ¸ (Load Testing) - 5ë¶„

## ğŸ“œ 5.1 í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ & ê²°ê³¼

### ìŠ¬ë¼ì´ë“œ
```
"ì ì§„ì  ë¶€í•˜ ì¦ê°€ ì „ëµ"

í…ŒìŠ¤íŠ¸ ë‹¨ê³„:
1ï¸âƒ£ 1k RPS: ê¸°ëŠ¥ ê²€ì¦
   â”œâ”€ ëª¨ë“  ì»´í¬ë„ŒíŠ¸ OK âœ…
   â””â”€ ì•„í‚¤í…ì²˜ ì‘ë™ í™•ì¸

2ï¸âƒ£ 5k RPS: ì´ˆê¸° í™•ì¥
   â”œâ”€ Gateway 3 pods â†’ 5 pods
   â””â”€ ì•ˆì •ì  ì²˜ë¦¬ âœ…

3ï¸âƒ£ 10k RPS: ë³‘ëª© ë°œê²¬
   â”œâ”€ Redis CPU 100% ğŸ”´
   â”œâ”€ Status API KEYS ëª…ë ¹ì–´
   â””â”€ ìµœì í™” í•„ìš”!

4ï¸âƒ£ ìµœì í™” í›„ 10k RPS:
   â”œâ”€ Position Index ì ìš©
   â”œâ”€ Redis CPU 40% âœ…
   â””â”€ ì—¬ìœ ë¡œì›€

5ï¸âƒ£ 20k RPS: í™•ì¥ ê²€ì¦
   â”œâ”€ Gateway 10 pods â†’ 20 pods
   â”œâ”€ Redis CPU 70% âœ…
   â””â”€ ì•ˆì •ì 

6ï¸âƒ£ 30k RPS: ëª©í‘œ ë‹¬ì„±
   â”œâ”€ Gateway 30 pods
   â”œâ”€ Redis CPU 90% âœ…
   â””â”€ ëª©í‘œ ë‹¬ì„±! ğŸ‰
```

### ë©˜íŠ¸

ë¶€í•˜ í…ŒìŠ¤íŠ¸ ì „ëµì€ ì ì§„ì  ì¦ê°€ì˜€ìŠµë‹ˆë‹¤.

**1k RPS:** ê¸°ëŠ¥ ê²€ì¦
- ëª¨ë“  API ì •ìƒ ì‘ë™
- ì•„í‚¤í…ì²˜ ê²€ì¦ ì™„ë£Œ

**5k RPS:** ì´ˆê¸° í™•ì¥
- Karpenterê°€ ìë™ìœ¼ë¡œ Gateway pods ì¦ê°€
- ì•ˆì •ì  ì²˜ë¦¬

**10k RPS:** ë³‘ëª© ë°œê²¬!
- Redis CPU 100%
- KEYS ëª…ë ¹ì–´ê°€ ë¬¸ì œ
- Position Indexë¡œ ìµœì í™”

**ìµœì í™” í›„:**
- 10k RPS: Redis CPU 40%
- 20k RPS: Redis CPU 70%
- **30k RPS: Redis CPU 90% - ëª©í‘œ ë‹¬ì„±!**

**ìµœì¢… ì„±ëŠ¥:**
- ì²˜ë¦¬ëŸ‰: 30k RPS
- Gateway CPU: 15%
- Backend CPU: < 5%
- ì—ëŸ¬ìœ¨: < 1%

---

## ğŸ“œ 5.2 Karpenter ìë™ í™•ì¥ ê²€ì¦

### ìŠ¬ë¼ì´ë“œ
```
"Karpenter í™•ì¥ ì„±ëŠ¥"

Scale-up í…ŒìŠ¤íŠ¸:
â”œâ”€ 1k â†’ 5k RPS (4k ì¦ê°€):
â”‚   â””â”€ 30ì´ˆë§Œì— 2 pods ì¶”ê°€ (3 â†’ 5)
â”‚
â”œâ”€ 5k â†’ 10k RPS (5k ì¦ê°€):
â”‚   â””â”€ 1ë¶„ë§Œì— 5 pods ì¶”ê°€ (5 â†’ 10)
â”‚
â”œâ”€ 10k â†’ 20k RPS (10k ì¦ê°€):
â”‚   â””â”€ 2ë¶„ë§Œì— 10 pods ì¶”ê°€ (10 â†’ 20)
â”‚
â””â”€ 20k â†’ 30k RPS (10k ì¦ê°€):
    â””â”€ 2ë¶„ë§Œì— 10 pods ì¶”ê°€ (20 â†’ 30)

Scale-down í…ŒìŠ¤íŠ¸:
â”œâ”€ 30k â†’ 10k RPS:
â”‚   â””â”€ 5ë¶„ë§Œì— 15 pods ì œê±° (30 â†’ 15)
â”‚
â””â”€ 10k â†’ 1k RPS:
    â””â”€ 10ë¶„ë§Œì— 10 pods ì œê±° (15 â†’ 5)

Spot Instance íš¨ê³¼:
â”œâ”€ Spot ë¹„ìœ¨: 70% (21/30 pods)
â”œâ”€ ì¤‘ë‹¨ìœ¨: < 2% (1ê°œì›” í‰ê· )
â””â”€ ë¹„ìš© ì ˆê°: $840/month
```

### ë©˜íŠ¸

Karpenterì˜ ìë™ í™•ì¥ ì„±ëŠ¥ì…ë‹ˆë‹¤.

**Scale-up (ë¹ ë¦„):**
- 5k RPS ì¦ê°€ ì‹œ: 30ì´ˆ ~ 1ë¶„
- 10k RPS ì¦ê°€ ì‹œ: 2ë¶„
- íŠ¸ë˜í”½ ì¦ê°€ì— ë¹ ë¥´ê²Œ ëŒ€ì‘

**Scale-down (ì•ˆì •ì ):**
- 5-10ë¶„ ëŒ€ê¸° í›„ ì œê±°
- íŠ¸ë˜í”½ ê°ì†Œ í™•ì¸ í›„ ì¶•ì†Œ
- ì•ˆì •ì„± ìš°ì„ 

**Spot Instance:**
- 70% Spot + 30% On-demand
- ì¤‘ë‹¨ìœ¨ < 2% (ë‹¤ì–‘í•œ íƒ€ì… ì‚¬ìš©)
- ì›” $840 ì ˆê°

**í•µì‹¬:**
- Gateway ë¶€í•˜ ì§‘ì¤‘ â†’ Karpenterë¡œ ëŒ€ì‘ ì„±ê³µ
- Trade-offë¥¼ ìë™í™”ë¡œ í•´ê²°

---

# ğŸ“ Part 6: Lesson Learned - 5ë¶„

## ğŸ“œ 6.1 ì„¤ê³„ ê³¼ì •ì˜ êµí›ˆ

### ìŠ¬ë¼ì´ë“œ
```
"ì„¤ê³„ë¶€í„° ìµœì í™”ê¹Œì§€ì˜ êµí›ˆ"

1ï¸âƒ£ ìš”êµ¬ì‚¬í•­ ë¨¼ì €
   "30ë§Œ ëª…, ì‹¤ì‹œê°„ í”¼ë“œë°±, ê³µì •ì„±"
   â†’ ì•„í‚¤í…ì²˜ê°€ ë”°ë¼ì˜´

2ï¸âƒ£ Trade-off ì¸ì •
   "Gateway ë¶€í•˜ ì§‘ì¤‘" â†’ ìˆ˜ìš©í•˜ê³  ìµœì í™”

3ï¸âƒ£ ì ì ˆí•œ ë„êµ¬ ì„ íƒ
   "ëŒ€ê¸°ì—´ = Redis ZSET" â†’ ë”± ë§ìŒ

4ï¸âƒ£ ì´ˆê¸° êµ¬í˜„ â‰  ìµœì¢…
   "ì¼ë‹¨ ì‘ë™í•˜ê²Œ, ê·¸ ë‹¤ìŒ ìµœì í™”"

5ï¸âƒ£ ëª¨ë‹ˆí„°ë§ í•„ìˆ˜
   "CloudWatch + pprof" â†’ ë³‘ëª© ë°œê²¬

6ï¸âƒ£ ì½”ë“œê°€ ë‹µ
   "ë…¸ë“œ ì¦ì„¤ < ì½”ë“œ ìµœì í™”"

7ï¸âƒ£ ê²€ì¦ ì¤‘ìš”
   "ì„¤ê³„ê°€ ë§ì•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸ë¡œ ì¦ëª…"
```

### ë©˜íŠ¸

ì´ë²ˆ ì—¬ì •ì—ì„œ ë°°ìš´ êµí›ˆë“¤ì„ ì •ë¦¬í•˜ê² ìŠµë‹ˆë‹¤.

**ì²«ì§¸, ìš”êµ¬ì‚¬í•­ì´ ë¨¼ì €ì…ë‹ˆë‹¤.**
"30ë§Œ ëª…ì„ ì²˜ë¦¬í•´ì•¼ í•œë‹¤" â†’ ê¸°ìˆ  ì„ íƒ
"ì‹¤ì‹œê°„ í”¼ë“œë°±ì´ í•„ìš”í•˜ë‹¤" â†’ Gateway íŒ¨í„´
"ê³µì •ì„±ì„ ë³´ì¥í•´ì•¼ í•œë‹¤" â†’ ëŒ€ê¸°ì—´ ê´€ë¦¬

ê¸°ìˆ ì´ ë¨¼ì €ê°€ ì•„ë‹ˆë¼, ìš”êµ¬ì‚¬í•­ì´ ë¨¼ì €ì…ë‹ˆë‹¤.

**ë‘˜ì§¸, Trade-offë¥¼ ì¸ì •í•´ì•¼ í•©ë‹ˆë‹¤.**
"Gatewayì— ë¶€í•˜ê°€ ì§‘ì¤‘ë  ê²ƒì´ë‹¤" â†’ ì•Œê³  ìˆì—ˆìŠµë‹ˆë‹¤.
í•˜ì§€ë§Œ ì´ê²Œ ìµœì„ ì´ë¼ê³  íŒë‹¨í–ˆìŠµë‹ˆë‹¤.
ê·¸ë¦¬ê³  ìµœì í™”ì— ì§‘ì¤‘í–ˆìŠµë‹ˆë‹¤.

**ì…‹ì§¸, ì ì ˆí•œ ë„êµ¬ë¥¼ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤.**
ëŒ€ê¸°ì—´ ê´€ë¦¬ = Redis ZSET
ì´ë§Œí¼ ë”± ë§ëŠ” ë„êµ¬ê°€ ì—†ì—ˆìŠµë‹ˆë‹¤.

**ë„·ì§¸, ì´ˆê¸° êµ¬í˜„ê³¼ ìµœì¢…ì€ ë‹¤ë¦…ë‹ˆë‹¤.**
"ì¼ë‹¨ ì‘ë™í•˜ê²Œ ë§Œë“¤ì" â†’ KEYS ì‚¬ìš©
"ì´ì œ ìµœì í™”í•˜ì" â†’ Position Index

ë¹ ë¥´ê²Œ ê²€ì¦í•˜ê³ , ì ì§„ì ìœ¼ë¡œ ê°œì„ í•˜ëŠ” ê²Œ ì¤‘ìš”í•©ë‹ˆë‹¤.

**ë‹¤ì„¯ì§¸, ëª¨ë‹ˆí„°ë§ì´ í•„ìˆ˜ì…ë‹ˆë‹¤.**
CloudWatch ì—†ì—ˆìœ¼ë©´, Redis CPU 100%ë¥¼ ëª°ëì„ ê²ë‹ˆë‹¤.
pprof ì—†ì—ˆìœ¼ë©´, KEYSê°€ ë¬¸ì œì¸ì§€ ëª°ëì„ ê²ë‹ˆë‹¤.

**ì—¬ì„¯ì§¸, ì½”ë“œê°€ ë‹µì…ë‹ˆë‹¤.**
"Redis ë…¸ë“œë¥¼ ëŠ˜ë¦´ê¹Œ?" â†’ ë¹„ìš© ì¦ê°€
"ì½”ë“œë¥¼ ìµœì í™”í•˜ì" â†’ ë¹„ìš© 0ì›

ëŒ€ë¶€ë¶„ì˜ ë¬¸ì œëŠ” ì½”ë“œ ìµœì í™”ë¡œ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ì¼ê³±ì§¸, ê²€ì¦ì´ ì¤‘ìš”í•©ë‹ˆë‹¤.**
"ì´ ì„¤ê³„ê°€ ë§ì„ê¹Œ?" â†’ ë¶€í•˜ í…ŒìŠ¤íŠ¸ë¡œ ì¦ëª…
"ì •ë§ 30k RPSë¥¼ ì²˜ë¦¬í• ê¹Œ?" â†’ ì‹¤ì œë¡œ ì²˜ë¦¬í•¨

ì„¤ê³„ê°€ ë§ì•˜ëŠ”ì§€ëŠ”, í…ŒìŠ¤íŠ¸ë¡œ ì¦ëª…í•´ì•¼ í•©ë‹ˆë‹¤.

---

## ğŸ“œ 6.2 ì‹¤ì „ íŒ

### ìŠ¬ë¼ì´ë“œ
```
"Redis ì‚¬ìš© ì‹œ ì£¼ì˜ì‚¬í•­"

ğŸš« ì ˆëŒ€ í•˜ì§€ ë§ì•„ì•¼ í•  ê²ƒë“¤:
1. KEYS ëª…ë ¹ì–´ ì‚¬ìš© (O(N) blocking)
   â†’ SCAN ë˜ëŠ” Index ì‚¬ìš©
   
2. ì‘ì€ Connection Pool (ê³ ë¶€í•˜ ëŒ€ë¹„ ì•ˆë¨)
   â†’ ìµœì†Œ 1000 ì´ìƒ ê¶Œì¥
   
3. ê¸°ë³¸ Timeout ì„¤ì • (Redis ì‘ë‹µ ëŒ€ê¸° í•„ìš”)
   â†’ 10s ì´ìƒ ì—¬ìœ ìˆê²Œ
   
4. Cluster Mode ë¬´ì‹œ (Hash tag í•„ìˆ˜)
   â†’ {key} í˜•ì‹ìœ¼ë¡œ ê°™ì€ slotì— ë§¤í•‘


âœ… ë°˜ë“œì‹œ í•´ì•¼ í•  ê²ƒë“¤:
1. ì ì ˆí•œ ìë£Œêµ¬ì¡° (ZSET for Index)
2. Lua Script (ì›ìì  ì—°ì‚°)
3. TTL ì„¤ì • (ìë™ ë§Œë£Œ)
4. Read Replica í™œìš© (ì½ê¸° ë¶„ì‚°)
5. CloudWatch ëª¨ë‹ˆí„°ë§ (CPU, Network)
6. pprof í”„ë¡œíŒŒì¼ë§ (ë³‘ëª© ì°¾ê¸°)
```

### ë©˜íŠ¸

ë§ˆì§€ë§‰ìœ¼ë¡œ, ì‹¤ì „ íŒë“¤ì„ ê³µìœ í•˜ê² ìŠµë‹ˆë‹¤.

**Redis ì‚¬ìš© ì‹œ ì ˆëŒ€ í•˜ì§€ ë§ì•„ì•¼ í•  ê²ƒ:**

1. **KEYS ëª…ë ¹ì–´ ì‚¬ìš©**
   - Productionì—ì„œ ì ˆëŒ€ ê¸ˆì§€
   - ëŒ€ì‹  SCANì´ë‚˜ Index ì‚¬ìš©
   - ìš°ë¦¬ì˜ êµí›ˆ: KEYS â†’ 100ë°° ëŠë¦¼

2. **ì‘ì€ Connection Pool**
   - ê¸°ë³¸ê°’ 100ì€ ë¶€ì¡±
   - ìµœì†Œ 1000 ì´ìƒ ê¶Œì¥
   - ê³ ë¶€í•˜ ëŒ€ë¹„ í•„ìˆ˜

3. **ì§§ì€ Timeout**
   - 2-3ì´ˆëŠ” ë¶€ì¡±
   - 10ì´ˆ ì´ìƒ ì—¬ìœ ìˆê²Œ
   - Redis ì‘ë‹µ ëŒ€ê¸° í•„ìš”

4. **Cluster Mode ë¬´ì‹œ**
   - Hash tag ì‚¬ìš© í•„ìˆ˜
   - `{eventID}` í˜•ì‹ìœ¼ë¡œ ê°™ì€ slot ë§¤í•‘
   - CROSSSLOT ì—ëŸ¬ ë°©ì§€

**ë°˜ë“œì‹œ í•´ì•¼ í•  ê²ƒ:**

1. **ì ì ˆí•œ ìë£Œêµ¬ì¡°**
   - ZSETìœ¼ë¡œ Index ë§Œë“¤ê¸°
   - O(log N) ì¡°íšŒ ë³´ì¥

2. **Lua Script**
   - ì›ìì  ì—°ì‚° ë³´ì¥
   - Race condition ë°©ì§€

3. **TTL ì„¤ì •**
   - ë¹„í™œì„± ë°ì´í„° ìë™ ë§Œë£Œ
   - ë©”ëª¨ë¦¬ ê´€ë¦¬

4. **Read Replica**
   - ì½ê¸° ë¶€í•˜ ë¶„ì‚°
   - `RouteByLatency: true`

5. **ëª¨ë‹ˆí„°ë§**
   - CloudWatch ë©”íŠ¸ë¦­ í™•ì¸
   - CPU/Network/Commands ì¶”ì 

6. **í”„ë¡œíŒŒì¼ë§**
   - pprofë¡œ ë³‘ëª© ì°¾ê¸°
   - CPU/Memory/Goroutine ë¶„ì„

---

## ğŸ“œ 6.3 ë§ˆë¬´ë¦¬

### ìŠ¬ë¼ì´ë“œ
```
"30ë§Œ ëª…ì˜ íŠ¸ë˜í”½, ì–´ë–»ê²Œ ì²˜ë¦¬í–ˆë‚˜?"

ì—¬ì • ìš”ì•½:
1ï¸âƒ£ ë¬¸ì œ ì •ì˜: 30ë§Œ ëª…, ì‹¤ì‹œê°„, ê³µì •ì„±
2ï¸âƒ£ ì„¤ê³„ ê³ ë¯¼: Direct vs Queue vs Gateway
3ï¸âƒ£ ìš°ë¦¬ì˜ ì„ íƒ: Gateway + Redis + ì…ì¥ ì œì–´
4ï¸âƒ£ ì™œ Redisì¸ê°€: ZSET, Lua, TTL, Cluster
5ï¸âƒ£ ì„¤ê³„ êµ¬ì¡°: ë°©íŒŒì œ ì•„í‚¤í…ì²˜
5ï¸âƒ£-1ï¸âƒ£ ìš©ëŸ‰ ì‚°ì •: ì™œ 1,000 RPSì¸ê°€?
6ï¸âƒ£ ì¸ìŠ¤í„´ìŠ¤ ì„ ì •: cache.m7g.xlarge Ã— 10
7ï¸âƒ£ êµ¬í˜„ ë° ê²€ì¦: 1k RPS â†’ ì‘ë™ í™•ì¸
8ï¸âƒ£ ë³‘ëª© ë°œê²¬: 10k RPS â†’ Redis CPU 100%
9ï¸âƒ£ ê·¼ë³¸ ì›ì¸: CloudWatch + pprof â†’ KEYS ëª…ë ¹ì–´
ğŸ”Ÿ í•´ê²°: Position Index (O(log N))
1ï¸âƒ£1ï¸âƒ£ ì„¸ë¶€ íŠœë‹: Pool, Memory, Probe
1ï¸âƒ£2ï¸âƒ£ ê²°ê³¼: 30k RPS, ë¹„ìš© 0ì›
1ï¸âƒ£3ï¸âƒ£ ì„¤ê³„ ê²€ì¦: ê°€ì„¤ ì¦ëª…, Trade-off í•´ê²°


í•µì‹¬ êµí›ˆ:
"ìš”êµ¬ì‚¬í•­ â†’ ì„¤ê³„ â†’ êµ¬í˜„ â†’ ê²€ì¦ â†’ ìµœì í™”"
"Trade-offë¥¼ ì¸ì •í•˜ê³ , ì§‘ì¤‘ íˆ¬ì"
"ë³‘ëª©ì€ ì˜ˆìƒ ë°–ì˜ ê³³ì—ì„œ, í•´ê²°ì±…ì€ ê°€ê¹Œìš´ ê³³ì—"


ë‹¤ìŒ ëª©í‘œ: 100k RPS? Multi-region? ğŸš€
```

### ë©˜íŠ¸

ì •ë¦¬í•˜ê² ìŠµë‹ˆë‹¤.

**"30ë§Œ ëª…ì˜ íŠ¸ë˜í”½, ì–´ë–»ê²Œ ì²˜ë¦¬í•  ê²ƒì¸ê°€?"**

ì´ ì§ˆë¬¸ì—ì„œ ì‹œì‘í–ˆìŠµë‹ˆë‹¤.

**ì„¤ê³„ ë‹¨ê³„:**
- 3ê°€ì§€ ì•„í‚¤í…ì²˜ íŒ¨í„´ì„ ë¹„êµí–ˆìŠµë‹ˆë‹¤
- Gateway + ì…ì¥ ì œì–´ë¥¼ ì„ íƒí–ˆìŠµë‹ˆë‹¤
- Redis ZSETìœ¼ë¡œ ëŒ€ê¸°ì—´ì„ ê´€ë¦¬í•˜ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤
- Trade-offë¥¼ ìˆ˜ìš©í•˜ê³ , ìµœì í™”ì— ì§‘ì¤‘í•˜ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤

**êµ¬í˜„ ë° ê²€ì¦:**
- 1,000 RPS í…ŒìŠ¤íŠ¸ â†’ ì‘ë™ í™•ì¸
- 10,000 RPS í…ŒìŠ¤íŠ¸ â†’ ë³‘ëª© ë°œê²¬ (Redis CPU 100%)
- pprof í”„ë¡œíŒŒì¼ë§ â†’ ê·¼ë³¸ ì›ì¸ ë°œê²¬ (KEYS ëª…ë ¹ì–´)

**í•´ê²° ë° ìµœì í™”:**
- Position Index ë„ì… (KEYS â†’ ZRANK)
- ì„±ëŠ¥ 100ë°° í–¥ìƒ (O(N) â†’ O(log N))
- ì„¸ë¶€ íŠœë‹ (Pool, Memory, Probe)

**ìµœì¢… ê²°ê³¼:**
- 30,000 RPS ë‹¬ì„±
- ì¶”ê°€ ë¹„ìš© 0ì›
- ì„¤ê³„ ê²€ì¦ ì™„ë£Œ

**í•µì‹¬ êµí›ˆ:**

1. **ìš”êµ¬ì‚¬í•­ì´ ë¨¼ì €**
   - ê¸°ìˆ ì´ ì•„ë‹Œ, ìš”êµ¬ì‚¬í•­ì´ ì„¤ê³„ë¥¼ ì´ë•ë‹ˆë‹¤

2. **Trade-offë¥¼ ì¸ì •**
   - ì™„ë²½í•œ ì„¤ê³„ëŠ” ì—†ìŠµë‹ˆë‹¤
   - Trade-offë¥¼ ìˆ˜ìš©í•˜ê³ , ì§‘ì¤‘ íˆ¬ìí•©ë‹ˆë‹¤

3. **ì ì§„ì  ê²€ì¦**
   - ë¹ ë¥´ê²Œ êµ¬í˜„í•˜ê³ , í…ŒìŠ¤íŠ¸ë¡œ ê²€ì¦í•©ë‹ˆë‹¤
   - ë³‘ëª©ì„ ì°¾ê³ , ìµœì í™”í•©ë‹ˆë‹¤

4. **ì½”ë“œê°€ ë‹µ**
   - ì¸í”„ë¼ ì¦ì„¤ë³´ë‹¤, ì½”ë“œ ìµœì í™”ê°€ ë¨¼ì €ì…ë‹ˆë‹¤

5. **ëª¨ë‹ˆí„°ë§ê³¼ í”„ë¡œíŒŒì¼ë§**
   - ë³‘ëª©ì€ ìˆ¨ì–´ ìˆìŠµë‹ˆë‹¤
   - ë„êµ¬ë¡œ ì°¾ì•„ì•¼ í•©ë‹ˆë‹¤

**ê·¸ë¦¬ê³  ë¬´ì—‡ë³´ë‹¤:**
ë³‘ëª©ì€ ì˜ˆìƒ ë°–ì˜ ê³³ì—ì„œ ë°œê²¬ë˜ê³ ,
í•´ê²°ì±…ì€ ì˜ì™¸ë¡œ ê°€ê¹Œìš´ ê³³ì— ìˆìŠµë‹ˆë‹¤.

ë‹¤ìŒ ëª©í‘œëŠ” 100k RPSì¼ê¹Œìš”?
ì•„ë‹ˆë©´ Multi-region ë°°í¬ì¼ê¹Œìš”?

ì—¬ëŸ¬ë¶„ì˜ ì‹œìŠ¤í…œì—ë„ ìˆ¨ê²¨ì§„ ë³‘ëª©ì´ ìˆì„ ê²ë‹ˆë‹¤.
ì°¾ì•„ì„œ í•´ê²°í•˜ëŠ” ê·¸ ê³¼ì •ì´,
ë°”ë¡œ ì—”ì§€ë‹ˆì–´ë§ì˜ ì¬ë¯¸ ì•„ë‹ê¹Œìš”?

ê°ì‚¬í•©ë‹ˆë‹¤! ğŸš€

---

## ğŸ“Š ë¶€ë¡: ê¸°ìˆ  ìŠ¤íƒ & ì„±ê³¼

### ê¸°ìˆ  ìŠ¤íƒ
```yaml
Architecture Pattern:
  - Gateway + Admission Control
  - Trade-off: Gateway ë¶€í•˜ ì§‘ì¤‘ ìˆ˜ìš©

Gateway (ë°©íŒŒì œ):
  - Go + Fiber
  - ElastiCache Redis Cluster (5 shards, 10 nodes)
  - Position Index (ZSET) - O(log N)
  - Admission Control (1,000 RPS)

Backend (ë³´í˜¸ë°›ëŠ” ì˜ì—­):
  - Reservation: Kotlin + Spring WebFlux
  - Inventory: Go + gRPC
  - Payment: Go + gRPC

Database:
  - DynamoDB (On-demand)
  - ElastiCache Redis

Monitoring & Profiling:
  - CloudWatch (CPU, Network, Commands)
  - Prometheus + Grafana
  - pprof (Go CPU/Memory profiling)

Infrastructure:
  - EKS (Kubernetes)
  - Karpenter (Auto-scaling)
  - ArgoCD (GitOps)
```

### ì„¤ê³„ ê²°ì • (Design Decisions)
```yaml
Why Gateway + Admission Control?
  âœ… ì‹¤ì‹œê°„ í”¼ë“œë°± (ìˆœë²ˆ ì¡°íšŒ)
  âœ… ë’·ë‹¨ ë³´í˜¸ (ì…ì¥ ì œì–´)
  âœ… ê³µì •ì„± ë³´ì¥ (ëŒ€ê¸°ì—´ ê´€ë¦¬)
  âŒ Gateway ë¶€í•˜ ì§‘ì¤‘ (ìˆ˜ìš©)

Why Redis?
  âœ… O(log N) ì¡°íšŒ (ZSET)
  âœ… ì›ìì  ì—°ì‚° (Lua Script)
  âœ… TTL ìë™ ë§Œë£Œ
  âœ… Cluster Mode (í™•ì¥ì„±)
  âœ… Read Replica (ì½ê¸° ë¶„ì‚°)
  âŒ DynamoDB: ë¹„ìš© ë†’ìŒ, ëŠë¦¼
  âŒ PostgreSQL: ë™ì‹œì„± ì œì–´ ì–´ë ¤ì›€

Why Position Index?
  âœ… O(log N) vs O(N) (100ë°° ë¹ ë¦„)
  âœ… Non-blocking (ZRANK)
  âœ… ê°„ë‹¨í•œ êµ¬í˜„
  âŒ KEYS: ì ˆëŒ€ ê¸ˆì§€
```

### ì„±ê³¼ ì§€í‘œ
```yaml
Performance:
  - ì²˜ë¦¬ëŸ‰: 10k â†’ 30k RPS (3ë°° í–¥ìƒ)
  - Redis CPU: 100% â†’ 40% (10k RPS ê¸°ì¤€)
  - Gateway CPU: 15% (ì—¬ìœ )
  - Backend CPU: 5% ë¯¸ë§Œ (ë§¤ìš° ì—¬ìœ )
  - Status API: 100ms â†’ <5ms
  
Optimization:
  - KEYS â†’ Index: ~100x faster
  - O(N) â†’ O(log N): ì‹œê°„ ë³µì¡ë„ ê°œì„ 
  - Memory: 200Mi â†’ 80Mi (idle)
  - Readiness: Pod ì‹œì‘ ì•ˆì •í™”
  
Cost:
  - ì¶”ê°€ ë¹„ìš©: 0ì›
  - ë…¸ë“œ ì¦ì„¤: ë¶ˆí•„ìš”
  - ì½”ë“œ ìµœì í™”ë§Œìœ¼ë¡œ ë‹¬ì„±
  - ElastiCache: cache.m7g.xlarge Ã— 10 (ìœ ì§€)
  
Reliability:
  - HPA scale-down: ì •ìƒí™”
  - Rolling update: ì•ˆì •í™”
  - Error rate: < 1%
  - Readiness probe failure: ì œê±°
```

### ì„¤ê³„ ê²€ì¦ ê²°ê³¼
```yaml
ê°€ì„¤:
  "Gateway + Redisê°€ ë°©íŒŒì œ ì—­í• ì„ í•  ê²ƒì´ë‹¤"

ê²€ì¦:
  âœ… 30ë§Œ ëª… íŠ¸ë˜í”½ ë°›ì•„ëƒ„
  âœ… ì…ì¥ ì œì–´ë¡œ ë’·ë‹¨ ë³´í˜¸
  âœ… Backend CPU < 5%
  âœ… DynamoDB 10% ì‚¬ìš©
  âœ… ë¹„ìš© 0ì› ì¶”ê°€
  âœ… 30k RPS ë‹¬ì„±

Trade-off í•´ê²°:
  "Gateway ë¶€í•˜ ì§‘ì¤‘" â†’ Position Index ìµœì í™”
  "Redis ë³‘ëª©" â†’ O(log N) ê°œì„ 

ì„¤ê³„ ì›ì¹™ ë‹¬ì„±:
  âœ… ì‹¤ì‹œê°„ í”¼ë“œë°±
  âœ… ë’·ë‹¨ ë³´í˜¸
  âœ… ê³µì •ì„± ë³´ì¥
  âœ… ë¹„ìš© íš¨ìœ¨ì„±
```

---

**ì‘ì„±**: Traffic Tacos Team  
**ì¼ì**: 2025-10-08  
**ë²„ì „**: 2.0 (ì„¤ê³„ ê³¼ì • ì¤‘ì‹¬ ì¬êµ¬ì„±)  
**ë³€ê²½**: ê²°ê³¼ ì¤‘ì‹¬ â†’ ì„¤ê³„ ê³ ë¯¼ ë° Trade-off ë¶„ì„ ì¶”ê°€
